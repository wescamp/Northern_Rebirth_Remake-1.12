#textdomain wesnoth-Northern_Rebirth_Remake

[scenario]
    id=12b_Return
    name= _ "Return"

    {SCENARIO_MUSIC "the_city_falls.ogg"}
    {EXTRA_SCENARIO_MUSIC "casualties_of_war.ogg"}
    {EXTRA_SCENARIO_MUSIC "vengeful.ogg"}

    [story]
        [part]
            story= _ "After meeting Hidel, Tallin received not only the information he wanted but also the gold meant as a ransom. Eryssa decided to support him in his efforts against the orcs. She sent the rest of the scouting group to carry the news about her to the elven kingdom. This turn of events suited Tallin's needs so he accepted it. With elves by his side, who were known for their animosity towards necromancy, the chances that his help would be accepted by humans and dwarves improved greatly."
            music=loyalists.ogg
        [/part]
        [part]
            story= _ "Hidel was most unhappy to hear his princess's orders. However the possibility that the Speaker held the legendary rod of justice, which can't be touched by the corrupted, roused doubts. The speaker might not be corrupted. He rescued the princess after all. Yet he was also more terrifying than his troops. Not because he could summon them at will, apparently without usage of magic of any kind, but because there was something ominous about him..."
        [/part]
        [part]
            story= _ "Everything seemed to be indifferent to him. Like something would sucked out any emotions this man could ever have. He talked about orcs the same way he'd talk about the past season's leaves. This applied to just about anything he was doing. His motivations could not be rationally explained. Even the honesty of the Speaker approached another, much more frightening dimension. He did not lie because he did not see any sense in doing so."
        [/part]
        [part]
            story= _ "Knowing what this man was going to do was utterly useless, since even an army would not be enough to stop him. The princess was fascinated by him, and an elvish marshal could not argue with a princess. So they attacked Rakshas who was besieging the dwarves."
        [/part]
    [/story]

    {DEFAULT_SCHEDULE}

    [time_area]
        {UNDERGROUND}       
        x=29-47,30-47,28-47,29-47,31-47,33,37-47,39-47,38-45,39-44,41-43,42
        y=0-1,2-3,4,5,6,7,7,8,9,10,11,12
    [/time_area]

    {TURNS4 50 48 46 44}
    next_scenario=Cutscene_Silence
    map_data="{~add-ons/Northern_Rebirth_Remake/maps/12b_Return.map}"

    #define KNALGAN_SIDE SIDE1 SIDE2
        [store_unit]
            [filter]
                side={SIDE1}
            [/filter]
            kill=yes
            variable=knalgan_units
        [/store_unit]

        {FOREACH knalgan_units i}

        {VARIABLE knalgan_units[$i].side {SIDE2}}

        [unstore_unit]
            variable=knalgan_units[$i]
        [/unstore_unit]

        {NEXT i}

        {CLEAR_VARIABLE knalgan_units}

        [capture_village]
            side={SIDE2}
            x=34,34,36,39,45,45
            y=1,3,5,1,4,6
        [/capture_village]        
    #enddef

    #define PUT_ORCISH_GUARD TYPE X Y
        [unit]
            type={TYPE}
            role=Personal guard
            [modifications]
                [object]
                    silent=yes
                    # Do not ever use replace if you want to have easy way to get back original state
                    [effect]
                        apply_to=movement_costs 
                        replace=false
                        [movement_costs]
                            flat=30
                            forest=30
                            shallow_water=30
                        [/movement_costs]
                    [/effect]
                [/object]
            [/modifications]
            x={X}
            y={Y}
            side=4
        [/unit]
    #enddef

    #define PUT_KNALGAN_GUARD TYPE X Y
        [unit]
            type={TYPE}
            role=Dwarven guard
            [modifications]
                [object]
                    silent=yes
                    # Do not ever use replace if you want to have easy way to get back original state
                    [effect]
                        apply_to=movement_costs 
                        replace=false
                        [movement_costs]
                            flat=30
                            cave=30
                            shallow_water=30
                            mountains=30
                            hills=30
                        [/movement_costs]
                    [/effect]
                [/object]
            [/modifications]
            x={X}
            y={Y}
            side=2
        [/unit]
    #enddef

    #define KNALGAN_IRON_TROOPS SWORDSMAN PIKEMAN JAVELINEER LONGBOWMAN OUTLAW STEELCLAD THUNDERGUARD PATHFINDER
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Swordsman" {SWORDSMAN}}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Pikeman" {PIKEMAN}}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Javelineer" {JAVELINEER}}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Longbowman" {LONGBOWMAN}}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Outlaw" {OUTLAW}}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Dwarvish Steelclad" {STEELCLAD}}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Dwarvish Thunderguard" {THUNDERGUARD}}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Dwarvish Pathfinder" {PATHFINDER}}
    #enddef

    #define REMOVE_UNIT X Y NAME
        [if]
            [have_unit]
                x={X}
                y={Y}
            [/have_unit]
        [then]
            [store_unit]
                [filter]
                    x={X}
                    y={Y}
                [/filter]
                kill=yes
                variable={NAME}
            [/store_unit]
        [/then]
        [/if]        
    #enddef

    #define RESTORE_UNIT NAME
        [unstore_unit]
            variable={NAME}
        [/unstore_unit]

        {CLEAR_VARIABLE {NAME}}
    #enddef

    #define MODIFY_ORCISH_GUARD X Y WML
        [store_unit]
            [filter]
                side=4
                x={X}
                y={Y}
            [/filter]
            kill=yes
            variable=orcish_warlord
        [/store_unit]

        {WML}

        {RESTORE_UNIT orcish_warlord}
    #enddef

    #define OBJECTIVES_RETURN CHARACTER_DEATH
        [objectives]
            side=1
            [objective]
                description= _ "Defeat the enemy leaders"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Tallin"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Eryssa"
                condition=lose
            [/objective]
            [objective]
                description={CHARACTER_DEATH}
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}
            {GOLD_CARRYOVER_DEFAULT yes}
        [/objectives]
    #enddef

    #define GUARD_MOBILIZE FILTER
        [object]
            silent=yes
            [filter]
                {FILTER}
            [/filter]
            [effect]
                apply_to=movement_costs
                replace=false
                [movement_costs]
                    flat=-30
                    forest=-30
                    shallow_water=-30
                [/movement_costs]
            [/effect]
        [/object]
    #enddef

    #define ORCISH_GUARDS_CHARGE MESSAGE
        [if]
            [variable]
                name=orcish_guards_charge
                less_than=1
            [/variable]
        [then]
            {SPEAKER_GENERIC (role=Sovereign) {MESSAGE}}

            [store_unit]
                [filter]
                    role=Personal guard
                [/filter]
                kill=no
                variable=guarding_units
            [/store_unit]

            {FOREACH guarding_units i}

            {GUARD_MOBILIZE (x,y=$guarding_units[$i].x,$guarding_units[$i].y)}

            {NEXT i}

            {VARIABLE orcish_guards_charge 1}

            {CLEAR_VARIABLE guarding_units}
        [/then]
        [/if]
    #enddef

    #define EMPEROR_GIVES_COMMAND
        [if]
            [variable]
                name=emperor_gives_command
                less_than=1
            [/variable]
        [then]
            [if]
                [variable]
                    name=dead_guard
                    equals=19
                [/variable]
            [then]
                {MODIFY_ORCISH_GUARD 21 22 (
                    {VARIABLE orcish_warlord.profile "portraits/orcs/transparent/grunt-2.png"}
                    {VARIABLE orcish_warlord.id "Warlord"}
                )}
                {MODIFY_ORCISH_GUARD 23 23 (
                    {VARIABLE orcish_warlord.role "Sovereign"}
                    {VARIABLE orcish_warlord.id "Sovereign"}
                    {VARIABLE orcish_warlord.canrecruit yes}
                )}
                {VARIABLE kill_position_x 22}
                {VARIABLE kill_position_y 22}
            [/then]
            [else]
                [if]
                    [variable]
                        name=dead_guard
                        equals=21
                    [/variable]
                [then]
                    {MODIFY_ORCISH_GUARD 23 23 (
                        {VARIABLE orcish_warlord.profile "portraits/orcs/transparent/grunt-2.png"}
                        {VARIABLE orcish_warlord.id "Warlord"}
                    )}
                    {MODIFY_ORCISH_GUARD 19 21 (
                        {VARIABLE orcish_warlord.role "Sovereign"}
                        {VARIABLE orcish_warlord.id "Sovereign"}
                        {VARIABLE orcish_warlord.canrecruit yes}
                    )}
                    {VARIABLE kill_position_x 22}
                    {VARIABLE kill_position_y 22}
                [/then]
                [else]
                    {MODIFY_ORCISH_GUARD 19 21 (
                        {VARIABLE orcish_warlord.profile "portraits/orcs/transparent/grunt-2.png"}
                        {VARIABLE orcish_warlord.id "Warlord"}
                    )}
                    {MODIFY_ORCISH_GUARD 21 22 (
                        {VARIABLE orcish_warlord.role "Sovereign"}
                        {VARIABLE orcish_warlord.id "Sovereign"}
                        {VARIABLE orcish_warlord.canrecruit yes}
                    )}
                    {VARIABLE kill_position_x 20}
                    {VARIABLE kill_position_y 21}
                [/else]
                [/if]
            [/else]
            [/if]

            [object]
                silent=yes
                [filter]
                    id=Rakshas
                [/filter]
                [effect]
                    apply_to=movement_costs
                    replace=false
                    [movement_costs]
                        castle=-30
                        flat=-30
                    [/movement_costs]
                [/effect]
            [/object]
            {GUARD_MOBILIZE (id=Sovereign)}

            {SPEAKER_GENERIC (speaker=Rakshas) ( _ "This is pathetic! We didn't even start fighting. I have better things to do then watching this!... You!")}
            {SPEAKER_GENERIC (id=Warlord) ( _ "Huh?")}
            {SPEAKER_GENERIC (speaker=Rakshas) ( _ "You are lucky today. You have the honor to lead my personal guard and show me how true combat looks!")}

            [if]
                [have_unit]
                    side=5
                    canrecruit=yes
                [/have_unit]
                [and]
                    [have_unit]
                        side=6
                        canrecruit=yes
                    [/have_unit]
                [/and]
            [then]
                {SPEAKER_GENERIC (id=Warlord) ( _ "But... but.. Great Master... Those deadlings just passed through our defenses...")}
            [/then]
            [else]
                {SPEAKER_GENERIC (id=Warlord) ( _ "But... but.. Great Master... Those deadlings just cut through our finest...")}
            [/else]
            [/if]

            {SPEAKER_GENERIC (speaker=Rakshas) ( _ "You will do better without your head.")}    
            {REMOVE_UNIT $kill_position_x $kill_position_y blocking_unit}
            {MOVE_UNIT id=Sovereign $kill_position_x $kill_position_y}
            {ANIMATE_UNIT Sovereign attack (
                [primary_attack]
                    range=melee
                [/primary_attack]

                hits=yes

                [facing]
                    [filter]
                        id=Warlord
                    [/filter]
                [/facing]
            )}

            [kill]
                id=Warlord
                animate=yes
            [/kill]

            [delay]
                time=400
            [/delay]

            {SPEAKER_GENERIC (id=Sovereign) ( _ "I will carry your word! MASTER!")}
            {SPEAKER_GENERIC (speaker=Rakshas) ( _ "Act with haste. I will send reinforcement shortly to see how <i>you</i> are using your head.")}

            [if]
                [have_unit]
                    side=5
                    canrecruit=yes
                [/have_unit]
            [then]
                {MOVE_UNIT id=Rakshas 1 10}
            [/then]
            [else]
                {MOVE_UNIT id=Rakshas 46 40}
            [/else]
            [/if]

            [kill]
                id=Rakshas
            [/kill]

            {MOVE_UNIT id=Sovereign 19 24}
            {RESTORE_UNIT blocking_unit}
            {SPEAKER_GENERIC (id=Sovereign) ( _ "GUARDS!!! ON POSITIONS! PREPARE FOR BATTLE!!!")}

            [if]
                [variable]
                    name=dead_guard
                    less_than=1
                [/variable]
            [then]
                {PUT_ORCISH_GUARD "Orcish Warlord" 19 21}
                {PUT_ORCISH_GUARD "Orcish Warlord" 21 22}
            [/then]
            [else]
                {PUT_ORCISH_GUARD "Orcish Warlord" 19 21}
                {PUT_ORCISH_GUARD "Orcish Warlord" 21 22}
                {PUT_ORCISH_GUARD "Orcish Warlord" 23 23}
            [/else]
            [/if]

            [gold]
    	        side=4
                amount=600
            [/gold]
            [allow_recruit]
                side=4
                type=Orcish Warlord,Orcish Slurbow
            [/allow_recruit]

            #ifdef EASY
                {LIMIT_RECRUITS 4 "Orcish Warlord" 3}
                {LIMIT_RECRUITS 4 "Orcish Slurbow" 1}
            #endif

            #ifdef NORMAL
                {LIMIT_RECRUITS 4 "Orcish Warlord" 4}
                {LIMIT_RECRUITS 4 "Orcish Slurbow" 2}
            #endif

            #ifdef HARD
                {LIMIT_RECRUITS 4 "Orcish Warlord" 6}
                {LIMIT_RECRUITS 4 "Orcish Slurbow" 2}
            #endif

            #ifdef NIGHTMARE
                {LIMIT_RECRUITS 4 "Orcish Warlord" 6}
                {LIMIT_RECRUITS 4 "Orcish Slurbow" 4}
            #endif

            {SPEAKER_GENERIC (id=Sovereign) ( _ "Oh, I will really enjoy this!")}

            {CLEAR_VARIABLE kill_position_x}
            {CLEAR_VARIABLE kill_position_y}
            {CLEAR_VARIABLE dead_guard}
            {VARIABLE emperor_gives_command 1}
        [/then]
        [/if]
    #enddef

    #define AI_ORCS AGGRESSION
        [ai]
            aggression={AGGRESSION}
            caution=-1.0
            leader_value=50
        [/ai]
    #enddef

    #define ORCISH_WARRIORS WARLORD
        recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Orcish Assassin,Troll Whelp,Orcish Warrior,Orcish Crossbowman,Troll,{WARLORD}
    #enddef

    #define ORCISH_IRON_TROOPS SIDE WARRIOR TROLL CROSSBOWMAN WARLORD STRENGTH
        {LIMIT_CONTEMPORANEOUS_RECRUITS {SIDE} "Orcish Warrior" {WARRIOR}}
        {LIMIT_CONTEMPORANEOUS_RECRUITS {SIDE} "Troll" {TROLL}}
        {LIMIT_CONTEMPORANEOUS_RECRUITS {SIDE} "Orcish Crossbowman" {CROSSBOWMAN}}
        {LIMIT_CONTEMPORANEOUS_RECRUITS {SIDE} {WARLORD} {STRENGTH}}
    #enddef

    #define ORCISH_CAMP_LOOT SIDE AMOUNT X Y
        [event]
            name=die

            [filter]
                side={SIDE}
                canrecruit=yes
            [/filter]

            {PLACE_IMAGE items/chest-plain-closed.png {X} {Y}}

            [if]
                [variable]
                    name=second_unit.side
                    less_than=2
                [/variable]
            [then]
                {FOUND_INFORMATION second_unit}

                [if]
                    [variable]
                        name=second_unit.race
                        not_equals=elf
                    [/variable]
                [then]
                    # This units are not directly depedent from Tallin
                    [if]
                        [variable]
                            name=second_unit.id
                            not_equals=Tallin
                        [/variable]
                    [then]
                        [if]
                            [variable]
                                name=second_unit.race
                                equals=human
                            [/variable]
                            [or]
                                [variable]
                                    name=second_unit.type
                                    equals=Lich
                                [/variable]
                            [/or]
                            [or]
                                [variable]
                                    name=second_unit.id
                                    equals=Abhai
                                [/variable]
                            [/or]
                        [then]
                            {SPEAKER_GENERIC (speaker=second_unit) ( _ "We have found some gold.")}
                        [/then]
                        [else]
                            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Gold... It can be a useful find.")}
                        [/else]
                        [/if]
                    [/then]
                    [else]
                        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Some gold.")}
                    [/else]
                    [/if]
                [/then]
                [else]
                    {SPEAKER_GENERIC (speaker=second_unit) ( _ "We were able to get some gold!")}
                [/else]
                [/if]
                # This is to not put macro in translatable string
                {VARIABLE gain_gold {AMOUNT}}

                [sound]
                    name=gold.ogg
                [/sound]
                [message]
                    speaker=narrator
                    message= _ "You have gained $gain_gold gold pieces"
                    image=items/gold-coins-large.png
                [/message]
            [/then]
            [else]
                {SPEAKER_GENERIC (speaker=second_unit) ( _ "Look! We have gained some gold!")}
                {SPEAKER_GENERIC (role=Commander) ( _ "Splendid!")}

                # This is to not put macro in translatable string
                {VARIABLE gain_gold {AMOUNT}}

                [sound]
                    name=gold.ogg
                [/sound]
                [message]
                    speaker=narrator
                    message= _ "Knalgans have gained $gain_gold gold pieces"
                    image=items/gold-coins-large.png
                [/message]
            [/else]
            [/if]

            [gold]
          	    side=$second_unit.side
      	        amount=$gain_gold
            [/gold]
            {CLEAR_VARIABLE gain_gold}
        [/event]
    #enddef

    #define CREATE_KNALGAN_SPEAKER TYPE ROLE X Y FILTER
        [if]
            [not]
                [have_unit]
                    side=2
                    role={ROLE}
                [/have_unit]
            [/not]
        [then]
            [role]
                side=2
                role={ROLE}
                {FILTER}
            [/role]
        [/then]
        [/if]

        [if]
            [not]
                [have_unit]
                    side=2
                    role={ROLE}
                [/have_unit]
            [/not]
        [then]
            {UNIT 2 {TYPE} {X} {Y} (
                role={ROLE}
            )}
        [/then]
        [/if]
    #enddef

    #define SOVEREIGN_KNIGHTS
        [if]
            [variable]
                name=sovereign_knights
                less_than=1
            [/variable]
        [then]
            {SPEAKER_GENERIC (role=Sovereign) ( _ "Not impressed yet? KNIGHTS!!")}

            {UNIT 4 "Direwolf Rider" 20 15 (
                id=Goblin Chieftain 
            )}
            {GENERIC_UNIT 4 "Goblin Knight" 21 16}
            {GENERIC_UNIT 4 "Goblin Knight" 22 16}
            {GENERIC_UNIT 4 "Goblin Knight" 19 16}
            {GENERIC_UNIT 4 "Goblin Knight" 20 16}
            {GENERIC_UNIT 4 "Goblin Knight" 21 17}
            {GENERIC_UNIT 4 "Goblin Knight" 26 18}
            {GENERIC_UNIT 4 "Goblin Knight" 27 19}
            {GENERIC_UNIT 4 "Goblin Knight" 28 19}
            {GENERIC_UNIT 4 "Goblin Knight" 25 19}
            {GENERIC_UNIT 4 "Goblin Knight" 26 19}
            {GENERIC_UNIT 4 "Direwolf Rider" 27 20}

            {SPEAKER_GENERIC (id=Goblin Chieftain) ( _ "HAHAHA! GOT YOU, SUCKERS!")}
            {SPEAKER_GENERIC (role=Sovereign) ( _ "Still not enough for you? No worries I will ensure that everyone will be properly killed on this battlefield! BRING REINFORCMENTS!!!")}
            {SPEAKER_GENERIC (speaker=Raurag) ( _ "HAHAHA! Oh, Yes. We are orcs! True warriors!")}
            {SPEAKER_GENERIC (speaker=Erirshak) ( _ "Yes, we will teach you what D-E-A-T-H means! HAHAHA!")}

            [gold]
                side=4
                {QUANTITY4 amount 250 350 450 550}
            [/gold]

            [if]
                [have_unit]
                    side=5
                    canrecruit=yes
                [/have_unit]
            [then]
                [gold]
                    side=5
                    {QUANTITY4 amount 250 350 450 550}
                [/gold]
            [/then]
            [/if]

            [if]
                [have_unit]
                    side=6
                    canrecruit=yes
                [/have_unit]
            [then]
                [gold]
                    side=6
                    {QUANTITY4 amount 250 350 450 550}
                [/gold]
            [/then]
            [/if]

            {VARIABLE sovereign_knights 1}
        [/then]
        [/if]
    #enddef

    [side]
        {PROTAGONIST_FORCES}
        gold=1500
        user_team_name={S_UNDEAD}
        {FLAG_VARIANT undead}
    [/side]

    [side]
        {PROTAGONIST_FORCES_ALLIED 2 ai knalgan}
        {INCOME4 20 15 7 0}
        no_leader=yes
        user_team_name=_"Knalgans"
        gold=0
    [/side]

    # Note: Not using AI_CONTROLLER is for a purpose
    #       Player should be focused on his own troops not exercising issuing commands to ai

    [side]
        side=3
        controller=ai
        no_leader=yes
        team_name=foe
        user_team_name=" "
        hidden=yes
        color=blue
        [ai]
            ai_algorithm=idle_ai
        [/ai]
        {FLAG_VARIANT knalgan}
    [/side]

    [side]
        side=4
        controller=ai
        type=Orcish Sovereign
        id=Rakshas
        profile=portraits/Rakshas.png
        name= _ "Rakshas"
        role=Sovereign
        canrecruit=yes
        {ORCISH_WARRIORS "Orcish Slayer"}
        {GOLD4 500 700 900 1100}
        {INCOME4 20 30 40 50}
        team_name=foe
        user_team_name={S_ORCS}
        {AI_ORCS 1.0}
        {FLAG_VARIANT ragged}
    [/side]

    [side]
        side=5
        controller=ai
        type=Orcish Warlord
        id=Erirshak
        name= _ "Erirshak"
        profile=portraits/orcs/transparent/grunt-4.png
        canrecruit=yes
        {ORCISH_WARRIORS "Troll Rocklobber"}
        {GOLD4 500 700 900 1100}
        {INCOME4 20 30 40 50}
        team_name=foe
        user_team_name={S_ORCS}
        {AI_ORCS 0.9}
        {FLAG_VARIANT ragged}
    [/side]

    [side]
        side=6
        controller=ai
        type=Orcish Warlord
        id=Raurag
        name= _ "Raurag"
        profile=portraits/orcs/transparent/grunt-5.png
        canrecruit=yes
        {ORCISH_WARRIORS "Goblin Pillager"}
        {GOLD4 500 700 900 1100}
        {INCOME4 20 30 40 50}
        team_name=foe
        user_team_name={S_ORCS}
        {AI_ORCS 0.9}
        {FLAG_VARIANT ragged}
    [/side]

    [event]
        name=prestart

        {BATTLEFIELD "{~add-ons/Northern_Rebirth_Remake/maps/Battlefield-06a+12b.mask}"}

        [terrain]
            x=31-32,40,41
            y=5,9,10
            terrain=Cud
        [/terrain]
        [terrain]
            x=30,40
            y=5,10
            terrain=Re
        [/terrain]
        [terrain]
            x=32
            y=4
            terrain=Uue
        [/terrain]
        [terrain]
            x=35
            y=5
            terrain=Ur
        [/terrain]
        [terrain]
            x=31
            y=6
            terrain=Hhd
        [/terrain]
        [terrain]
            x=32
            y=6
            terrain=Md
        [/terrain]

        [objectives]
            side=1
            [objective]
                description= _ "Defeat the enemy leaders"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Tallin"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Eryssa"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}
            {GOLD_CARRYOVER_DEFAULT yes}
        [/objectives]

        #ifdef EASY
            {ORCISH_IRON_TROOPS 4 3 3 6 "Orcish Slayer" 4}
            {ORCISH_IRON_TROOPS 5 3 3 6 "Troll Rocklobber" 4}
            {ORCISH_IRON_TROOPS 6 3 3 6 "Goblin Pillager" 4}
        #endif

        #ifdef NORMAL
            {ORCISH_IRON_TROOPS 4 4 4 7 "Orcish Slayer" 5}
            {ORCISH_IRON_TROOPS 5 4 4 7 "Troll Rocklobber" 5}
            {ORCISH_IRON_TROOPS 6 4 4 7 "Goblin Pillager" 5}
        #endif

        #ifdef HARD
            {ORCISH_IRON_TROOPS 4 5 5 8 "Orcish Slayer" 5}
            {ORCISH_IRON_TROOPS 5 5 5 8 "Troll Rocklobber" 5}
            {ORCISH_IRON_TROOPS 6 5 5 8 "Goblin Pillager" 5}
        #endif

        #ifdef NIGHTMARE
            {ORCISH_IRON_TROOPS 4 5 5 8 "Orcish Slayer" 6}
            {ORCISH_IRON_TROOPS 5 5 5 8 "Troll Rocklobber" 6}
            {ORCISH_IRON_TROOPS 6 5 5 8 "Goblin Pillager" 6}
        #endif

        {VARIABLE light_source 1}
    [/event]

    [event]
        name=start

        [if]
            [variable]
                name=assault_leader_killed
                equals=
            [/variable]
            [and]
                [variable]
                    name=camerin_dead
                    less_than=1
                [/variable]
            [/and]
        [then]
            {VARIABLE human_leader_name Camerin}

            {UNIT 2 "Great Mage" 41 1 (
                id=Camerin
                name= _ "Camerin"
                role=Commander
                profile=portraits/Camerin.png
                unrenamable=yes
                canrecruit=yes
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_STRONG}
                [/modifications]
            )}
        [/then]
        [else]
            [if]
                [variable]
                    name=assault_leader_killed
                    not_equals=
                [/variable]
            [then]
                {VARIABLE human_leader_name Dendrvan}

                {UNIT 2 "Halberdier" 41 1 (
                    id=Dendrvan
                    name= _ "Dendrvan"
                    role=Commander
                    unrenamable=yes
                    canrecruit=yes
                    [modifications]
                        {TRAIT_QUICK}
                        {TRAIT_RESILIENT}
                    [/modifications]
                )}
            [/then]
            [else]
                {VARIABLE human_leader_name Rhodry}

                {UNIT 2 "Royal Guard" 41 1 (
                    id=Rhodry
                    name= _ "Rhodry"
                    role=Commander
                    profile=portraits/humans/transparent/swordsman-2.png
                    unrenamable=yes
                    canrecruit=yes
                    [modifications]
                        {TRAIT_RESILIENT}
                        {TRAIT_STRONG}
                    [/modifications]
                )}
            [/else]
            [/if]
        [/else]
        [/if]

        {PUT_ORCISH_GUARD "Orcish Warlord" 19 21}
        {PUT_ORCISH_GUARD "Orcish Warlord" 21 22}
        {PUT_ORCISH_GUARD "Orcish Warlord" 23 23}

        {PUT_KNALGAN_GUARD "Dwarvish Stalwart" 30 4}
        {PUT_KNALGAN_GUARD "Dwarvish Stalwart" 31 5}
        {PUT_KNALGAN_GUARD "Dwarvish Stalwart" 32 5}
        {PUT_KNALGAN_GUARD "Dwarvish Stalwart" 40 9}
        {PUT_KNALGAN_GUARD "Dwarvish Stalwart" 41 10}
        {PUT_KNALGAN_GUARD "Dwarvish Stalwart" 42 10}

        {UNIT 2 "Swordsman" 34 3 (
            role=Lieutenant
            moves=0
        )}
        {UNIT 2 "Trapper" 31 4 (
            moves=0
        )}
        {UNIT 2 "Javelineer" 34 4 (
            moves=0
        )}

        {GENERIC_UNIT 4 "Goblin Knight" 35 11}
        {GENERIC_UNIT 5 "Orcish Archer" 29 5}
        {GENERIC_UNIT 5 "Orcish Grunt" 30 5}
        {GENERIC_UNIT 5 "Orcish Slurbow" 31 6}
        {GENERIC_UNIT 5 "Troll Whelp" 32 6}
        {GENERIC_UNIT 5 "Troll Rocklobber" 27 6}
        {GENERIC_UNIT 6 "Troll" 39 10}
        {GENERIC_UNIT 6 "Orcish Archer" 40 10}
        {GENERIC_UNIT 6 "Orcish Warrior" 41 11}
        {GENERIC_UNIT 6 "Goblin Pillager" 37 10}
        {GENERIC_UNIT 6 "Orcish Warrior" 39 12}

        [capture_village]
            side=2
            x=34,34,36,39,45,45
            y=1,3,5,1,4,6
        [/capture_village]

        {SPEAKER_TALLIN_ARMORED ( _ "Rakshas. Leave now and never return.")}
        {SPEAKER_GENERIC (speaker=Rakshas) ( _ "Pitiful mad man. Why do you think I would grant your request?")}
        {SPEAKER_TALLIN_ARMORED ( _ "I trust in your wisdom.")}
        {SPEAKER_GENERIC (speaker=Rakshas) ( _ "I rule by the power of my sword. And I do not speak with the dead! HAHAHA!")}
        {SPEAKER_TALLIN_ARMORED ( _ "As you wish.")}

        {MOVE_UNIT id=Tallin 8 36}

        [terrain]
            x=6,7,8,8-9,9,10
            y=35-36,35-38,36,37,38,36-37
            terrain=Ce
        [/terrain]

        [terrain]
            x=8
            y=36
            terrain=^Kov
            layer=overlay
        [/terrain]

        {PLACE_IMAGE scenery/tent-ruin-1.png 8 36}

        {UNIT 1 "Elvish Marshal" 14 37 (
            id=Hidel
            profile=portraits/Hidel.png
            name= _ "Hidel"
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT 1 "Elvish Avenger" 13 37 (
            id=Sisal
            name= _ "Sisal"
            profile=portraits/Sisal.png
            gender=female
            unrenamable=yes
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_DEXTROUS}
            [/modifications]
            {IS_LOYAL}
        )}

        [recall]
            id=Eryssa
        [/recall]

        {CREATE_ABYSS}

        {SPEAKER_GENERIC (speaker=Hidel) ( _ "That was really stupid. Now we can't be sure to kill him swiftly.")}
        {SPEAKER_TALLIN_ARMORED ( _ "I gave you a chance to change your mind. Everyone who lives deserves it. After all there is no difference between him and you, elf.")}
        {SPEAKER_GENERIC (speaker=Sisal) ( _ "No difference? I do not mind that you can't see the difference between orcs and elves but you just forbade me to kiss Rakshas for goodbye with my arrow. Now we will have to fight with his entire army. We could all die in this battle.")}
        {SPEAKER_TALLIN_ARMORED ( _ "No one can avoid the inevitable.")}
        {SPEAKER_GENERIC (speaker=Sisal) ( _ "Great, the inevitable... I presume that this is our success?")}
        {SPEAKER_TALLIN_ARMORED ( _ "It's the consequences of our decisions.")}
        {SPEAKER_GENERIC (speaker=Sisal) {WHISPER _"whisper^Princess he is a complete lunatic!"}}
        {SPEAKER_GENERIC (speaker=Eryssa) ( _ "(<i>With admiration</i>) No, he is just not from this world.")}
    [/event]

    [event]
        name=new turn
        first_time_only=no

        [if]
            [variable]
                name=light_source
                numerical_equals=2
            [/variable]
        [then]
            [if]
                [have_unit]
                    side=2
                    canrecruit=yes
                [/have_unit]
            [then]
                [terrain]
                    x=31-32,40,41
                    y=5,9,10
                    terrain=Cud^Ii
                [/terrain]
            [/then]
            [else]
                [terrain]
                    x=31-32,40,41
                    y=5,9,10
                    terrain=Cud^Xi
                [/terrain]
            [/else]
            [/if]

            [terrain]
                x=30,40
                y=5,10
                terrain=Re^Ii
            [/terrain]
            [terrain]
                x=32
                y=4
                terrain=Uue^Ii
            [/terrain]
            [terrain]
                x=35
                y=5
                terrain=Ur^Ii
            [/terrain]
            [terrain]
                x=31
                y=6
                terrain=Hhd^Ii
            [/terrain]
            [terrain]
                x=32
                y=6
                terrain=Md^Ii
            [/terrain]
        [/then]
        [/if]

        [if]
            [variable]
                name=light_source
                numerical_equals=4
            [/variable]
        [then]
            [if]
                [have_unit]
                    side=2
                    canrecruit=yes
                [/have_unit]
            [then]
                [terrain]
                    x=31-32,40,41
                    y=5,9,10
                    terrain=Cud
                [/terrain]
            [/then]
            [else]
                [terrain]
                    x=31-32,40,41
                    y=5,9,10
                    terrain=Cud^Xo
                [/terrain]
            [/else]
            [/if]

            [terrain]
                x=30,40
                y=5,10
                terrain=Re
            [/terrain]
            [terrain]
                x=32
                y=4
                terrain=Uue
            [/terrain]
            [terrain]
                x=35
                y=5
                terrain=Ur
            [/terrain]
            [terrain]
                x=31
                y=6
                terrain=Hhd
            [/terrain]
            [terrain]
                x=32
                y=6
                terrain=Md
            [/terrain]
        [/then]
        [/if]

        [if]
            [variable]
                name=light_source
                greater_than=6
            [/variable]
        [then]
            {VARIABLE light_source 1}
        [/then]
        [/if]

        {VARIABLE_OP light_source add 1}
    [/event]

    [event]
        name=turn 2

        {SPEAKER_GENERIC (speaker=Raurag) ( _ "Cursed elven necromancers find your own dwarfs to enslave!")}
        {SPEAKER_GENERIC (role=Lieutenant) ( _ "Look, over there, it seems that orcs are fighting the undead! That might be our chance to break the siege.")}
        {SPEAKER_GENERIC (role=Commander) ( _ "It might be a trap. Hold your positions, and stay alert.")}

        {KNALGAN_SIDE 2 3}

        [terrain]
            x=30,42
            y=4,10
            terrain=Cud^Xo
        [/terrain]
        [terrain]
            x=31-32,40,41
            y=5,9,10
            terrain=Cud^Xi
        [/terrain]
    [/event]

    [event]
        name=turn 3

        [object]
            silent=yes
            # Do not ever use replace if you want to have easy way to get back original state
            [filter]
               id=Rakshas
            [/filter]
            [effect]
                apply_to=movement_costs 
                replace=false
                [movement_costs]
                    castle=30
                    flat=30
                [/movement_costs]
            [/effect]
        [/object]
    [/event]

    [event]
        name=time over

        {SPEAKER_TALLIN_ARMORED ( _ "I failed yet again.")}
    [/event]

    [event]
        name=moveto

        [filter]
            side=1,2
            x=18,19,20
            y=23-24,23-25,23-24
        [/filter]

        {EMPEROR_GIVES_COMMAND}
    [/event]

    [event]
        name=moveto

        [filter]
            side=1,2
            x=19-24,17,18,19,20,21,22,25,26
            y=20-23,23-24,22-24,24-25,23-25,24-26,24-25,21-23,21-22
        [/filter]

        {SOVEREIGN_KNIGHTS}
    [/event]

    [event]
        name=moveto

        [filter]
            side=4,5,6
            x=34-46,39-46
            y=1-5,6-8
        [/filter]

        {CREATE_KNALGAN_SPEAKER Swordsman Lieutenant 39 1 (
            [not]
                id=$human_leader_name
            [/not]
        )}

        {SPEAKER_GENERIC (role=Lieutenant) ( _ "$human_leader_name! They have broken through!")}

        [if]
            [have_unit]
                side=2
                id=Camerin
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Camerin) ( _ "Come on, fall on them! Burn! Oh burn this disgusting filth! I love it!")}
        [/then]
        [else]
            {SPEAKER_GENERIC (role=Commander) ( _ "To arms! Victory will be ours!")}
        [/else]
        [/if]

        {SPEAKER_GENERIC (role=Lieutenant) ( _ "$human_leader_name! We can not hold out much longer!")}

        [gold]
    	    side=2
            amount=500
        [/gold]
    [/event]

    {FORCE_CHANCE_TO_HIT side=1 side=3 0 (
        [variable]
            name=false
            less_than=1
        [/variable]
    )}

    [event]
        name=attack

        [filter]
            side=1
        [/filter]
        [filter_second]
            side=3
        [/filter_second]

        {SPEAKER_TALLIN_ARMORED ( _ "We will not do any harm to them, even if they will harm us.")}
    [/event]

    [event]
        name=attack

        [filter]
            side=1,2
        [/filter]
        [filter_second]
            role=Sovereign
        [/filter_second]

        {ORCISH_GUARDS_CHARGE ( _ "GUARDS!!! PROTECT ME!")}
        {SOVEREIGN_KNIGHTS}
    [/event]

    [event]
        name=attack

        [filter]
            role=Sovereign
        [/filter]
        [filter_second]
            side=1,2
        [/filter_second]

        {ORCISH_GUARDS_CHARGE ( _ "GUARDS!!! COVER ME!")}
        {SOVEREIGN_KNIGHTS}
    [/event]

    [event]
        name=victory

        {CREATE_KNALGAN_SPEAKER Swordsman Lieutenant 39 1 (
            race=human
            [not]
                id=$human_leader_name
            [/not]
        )}
        {CREATE_KNALGAN_SPEAKER "Dwarvish Fighter" Admonisher 42 6 (
            race=dwarf
        )}

        {SPEAKER_GENERIC (role=Lieutenant) ( _ "Haha! Those bastards are fleeing! Now lets get on with those sorcerers!")}
        {SPEAKER_GENERIC (speaker=Eryssa) ( _ "Wait! Wait! We are here to help you fight orcs!")}
        {SPEAKER_GENERIC (role=Admonisher) ( _ "Step backward cursed witch! We don't want anything to do with you or those creations of yours!")}
        {SPEAKER_GENERIC (speaker=Hidel) ( _ "How you dare insult the princess of the Northern Elves spit beard!")}
        {SPEAKER_GENERIC (role=Commander) ( _ "Calm down! There is nothing wrong with hearing what they want.")}
        {SPEAKER_GENERIC (role=Admonisher) ( _ "Look out $human_leader_name it's an elven witch. She can easily charm any human. But do not worry. Luckily the beauty of our women is legendary so we dwarfs are immune to this kind of magic.")}
        {SPEAKER_GENERIC (speaker=Eryssa) ( _ "I am the elvish princess, Eryssa. I was rescued by this brave man, the Speaker, from orcish hands. He told us that he is on a mission to crush the orcs that are threatening the people of Dwarven Doors and the noble dwarfs that support them, so we decide to join him. All we wish for now is to discuss these matters with lord Hamel.")}

        [if]
            [have_unit]
                side=2
                id=Camerin
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Camerin) ( _ "Awww! Pity! If you do not want to fight I will take you to lord Hamel...")}
            {SPEAKER_GENERIC (speaker=Camerin) ( _ "But remember If you change your mind I will teleport you all to the place you came from! In flames! He! He!")}
        [/then]
        [else]
            {SPEAKER_GENERIC (role=Commander) ( _ "I will take you to lord Hamel...")}
            {SPEAKER_GENERIC (role=Commander) ( _ "But remember one false move... And you will see what we do with unwelcome guests!")}
        [/else]
        [/if]

        {CLEAR_VARIABLE orcish_guards_charge}
        {CLEAR_VARIABLE emperor_gives_command}
        {CLEAR_VARIABLE sovereign_knights}
        {CLEAR_VARIABLE light_source}
        {CLEAR_ROLE_ABYSS}
        {VICTORY_BONUS_DEFAULT yes}
    [/event]

    [event]
        name=last breath

        [filter]
            id=Camerin
        [/filter]

        {SPEAKER_GENERIC (speaker=Camerin) ( _ "What... how can this happen?")}
    [/event]

    [event]
        name=last breath

        [filter]
            id=Goblin Chieftain
        [/filter]

        {SPEAKER_GENERIC (speaker=unit) ( _ "This battle... Sucks!")}
    [/event]

    [event]
        name=last breath

        [filter]
            id=Hidel
        [/filter]

        {SPEAKER_GENERIC (speaker=Eryssa) ( _ "Hidel!...")}
        {SPEAKER_GENERIC (speaker=unit) ( _ "It's nothing serious... Really...")}
    [/event]

    [event]
        name=last breath

        [filter]
            id=Sisal
        [/filter]

        [if]
            [have_unit]
                side=1
                id=Hidel
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Eryssa) ( _ "Noooo! Sisal!")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=Eryssa) ( _ "Sisal! Noooo! Not you too!")}
        [/else]
        [/if]

        {SPEAKER_GENERIC (speaker=unit) ( _ "Worry not... Brave warriors never die.")}
    [/event]

    [event]
        name=last breath

        [filter]
            id=Eryssa
        [/filter]

        [if]
            [have_unit]
                side=1
                id=Hidel
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Hidel) ( _ "Princess!")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=Sisal) ( _ "Princess!")}
        [/else]
        [/if]
    [/event]

    {ORCISH_CAMP_LOOT 4 934 19 25}
    {ORCISH_CAMP_LOOT 5 869 9 14}
    {ORCISH_CAMP_LOOT 6 722 40 36}

    [event]
        name=die

        [filter]
            side=4,5,6
            canrecruit=yes
        [/filter]

        {EMPEROR_GIVES_COMMAND}

        [if]
            [variable]
                name=light_source
                less_than=4
            [/variable]
            [and]
                [variable]
                    name=light_source
                    greater_than=1
                [/variable]
            [/and]
        [then]
            [terrain]
                x=30,42
                y=4,10
                terrain=Cud
            [/terrain]
            [terrain]
                x=31-32,40,41
                y=5,9,10
                terrain=Cud^Ii
            [/terrain]
        [/then]
        [else]
            [terrain]
                x=30,31-32,40,41-42
                y=4,5,9,10
                terrain=Cud
            [/terrain]
        [/else]
        [/if]

        {KNALGAN_SIDE 3 2}

        [modify_side]
            side=2
            {GOLD4 1100 900 700 500}
            recruit=Spearman,Bowman,Footpad,Thug,Poacher,Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Scout,Javelineer,Swordsman,Pikeman,Longbowman,Outlaw,Dwarvish Steelclad,Dwarvish Thunderguard,Dwarvish Pathfinder
        [/modify_side]

        #ifdef EASY
            {KNALGAN_IRON_TROOPS 6 5 3 4 2 4 3 3}
        #endif

        #ifdef NORMAL
            {KNALGAN_IRON_TROOPS 5 3 3 3 2 3 2 3}
        #endif

        #ifdef HARD
            {KNALGAN_IRON_TROOPS 4 2 3 2 1 2 2 2}
        #endif

        #ifdef NIGHTMARE
            {KNALGAN_IRON_TROOPS 3 2 2 1 1 2 1 1}
        #endif

        [if]
            [have_unit]
                side=2
                id=Camerin
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Camerin) ( _ "Oh, it looks that undead are having a good time with the orcs. Let's join the FUN!!!")}
        [/then]
        [else]
            {SPEAKER_GENERIC (role=Commander) ( _ "It looks that the undead strike them hard. This is our chance. Fall on them now or we will be trapped here forever!")}
        [/else]
        [/if]

        {SPEAKER_GENERIC (role=Lieutenant) ( _ "Remember our main enemy are the orcs!")}

        [if]
            [variable]
                name=human_leader_name
                equals=Camerin
            [/variable]
        [then]
            {OBJECTIVES_RETURN ( _ "Death of Camerin")}
        [/then]
        [else]
            [if]
                [variable]
                    name=human_leader_name
                    equals=Rhodry
                [/variable]
            [then]
                {OBJECTIVES_RETURN ( _ "Death of Rhodry")}
            [/then]
            [else]
                {OBJECTIVES_RETURN ( _ "Death of Dendrvan")}
            [/else]
            [/if]
        [/else]
        [/if]
    [/event]

    {IMPORTANT_CHARACTER_DIED $human_leader_name}
    {IMPORTANT_CHARACTER_DIED Eryssa}

    [event]
        name=die

        [filter]
            role=Personal Guard
        [/filter]

        {VARIABLE dead_guard $unit.x}

        [kill]
            id=$unit.id
        [/kill]
    [/event]

    {LEADER_DEATH_ARMORED ( _ "So this is how it looks like...")}

    #undef KNALGAN_SIDE
    #undef MODIFY_ORCISH_GUARD
    #undef RESTORE_UNIT
    #undef REMOVE_UNIT
    #undef PUT_ORCISH_GUARD
    #undef PUT_KNALGAN_GUARD
    #undef KNALGAN_IRON_TROOPS
    #undef OBJECTIVES_RETURN
    #undef GUARD_MOBILIZE
    #undef ORCISH_GUARDS_CHARGE
    #undef AI_ORCS
    #undef ORCISH_WARRIORS
    #undef ORCISH_IRON_TROOPS
    #undef EMPEROR_GIVES_COMMAND
    #undef ORCISH_CAMP_LOOT
    #undef CREATE_KNALGAN_SPEAKER
    #undef SOVEREIGN_KNIGHTS
[/scenario]
