#textdomain wesnoth-Northern_Rebirth_Remake

[scenario]
    id=08b_Song_of_Blood
    name= _ "Song of Blood"

    {SCENARIO_MUSIC "revelation.ogg"}
    {EXTRA_SCENARIO_MUSIC "suspense.ogg"}
    {EXTRA_SCENARIO_MUSIC "casualties_of_war.ogg"}

    turns=-1
    victory_when_enemies_defeated="no"
    {DEFAULT_SCHEDULE}
    next_scenario=09b_Judgment

    [time_area]
        {UNDERGROUND}
        x=6-61,2,4-61,0-61
        y=0-2,3,3,4-49
    [/time_area]

    [story]
        [part]
            story= _ "Tallin was drowning in thoughts darker than the empty caves of Knalga that he was walking through. The purpose was lost... He was cheated of everything. His victory. His glory. His death. Stolen... For nothing..."
            music=revelation.ogg
        [/part]
        [part]
            story= _ "A drop of insight on the desert of his mind makes things clearer... For a moment. Now he saw what he really was. A wicked parody of himself. He doesn't care about anything. Besides the purpose... Destruction."
        [/part]
        [part]
            story= _ "He realizes that the only way to win is to lose. He knows that he will not be alone for long. The force... The curse is within him. He can almost hear the sweet song of blood again. A call to wage endless war. No one can stop him because the hero is dead. So, he quickly moves forward to fulfill his purpose... At last..."
        [/part]
    [/story]

    map_data="{~add-ons/Northern_Rebirth_Remake/maps/08b_Song_of_Blood.map}"

    #define VICTIMS_ABOUT
        [message]
            speaker=narrator
            message= _ "In this scenario if you exterminate too many living beings you will lose and Tallins mind will fall into dreams about betrayal, war and glory. 
This factor is reflected in points of blood. If at any moment of scenario it drops below zero you will lose. 
There is one exception from this rule. If you have <i>Abhai</i> you can use one point more. 
The death of each encountered enemy faction leader reduces this score by one unless otherwise noted. 
Some actions also can lower the points of blood. You will be informed when it will happen. 
IMPORTANT: <i>Number of points is lower than available targets!</i>
 
<span color='#ff0000'>Remaining points of blood: $bloodpoints</span>"
            image=wesnoth-icon.png
        [/message]
    #enddef

    #define PUT_TENTACLE X Y
        [unit]
            type=Tentacle of the Deep
            role=Tentacle
            side=4
            x={X}
            y={Y}
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_STRONG}
            [/modifications] 
        [/unit]
    #enddef

    #define PUT_GUARDIAN SIDE TYPE X Y
        [unit]
            type={TYPE}
            x={X}
            y={Y}
            side={SIDE}
            ai_special=guardian
        [/unit]
    #enddef

    #define PUT_RUNIC_BLADE_GUARD ID TYPE X Y
        [unit]
            id={ID}
            role=Runic Blade Dancer
            type={TYPE}
            x={X}
            y={Y}
            side=5
            [modifications]
                [object]
                    silent=yes
                    duration=scenario
                    [effect]
                        apply_to=attack
                        range=melee
                        set_type=arcane
                    [/effect]
                    [effect]
                        apply_to=movement_costs 
                        replace=false
                        [movement_costs]
                            flat=30
                            shallow_water=30
                            deep_water=30
                        [/movement_costs]
                    [/effect]
                [/object]
            [/modifications]
            ai_special=guardian
        [/unit]   
    #enddef

    #define SPAWN_BAT X Y
        [store_locations]
            variable=bat_tunnel
            x={X}
            y={Y}
            [filter]
                x={X}
                y={Y}
            [/filter]
        [/store_locations]

        [if]
            [variable]
                name=bat_tunnel.x
                equals=
            [/variable]
            [and]
                [variable]
                    name=spawn_bat
                    less_than=$spawn_bat_max
                [/variable]
            [/and]
        [then]
            [if]
                [variable]
                    name=spawn_bat_phase
                    numerical_equals=$spawn_bat_blood
                [/variable]
            [then]
                [unit]
                    type=Blood Bat
                    role="Vile Flayer"
                    side=3
                    x={X}
                    y={Y}
                [/unit]
            [/then]
            [else]
                [unit]
                    type=Vampire Bat
                    role="Vile Flayer"
                    side=3
                    x={X}
                    y={Y}
                [/unit]
            [/else]
            [/if]

            {VARIABLE_OP spawn_bat add 1}
        [/then]
        [else]
            {CLEAR_VARIABLE bat_tunnel}
        [/else]
        [/if]
    #enddef

    #define DRAGON_SPEAK
        [if]
            [variable]
                name=dragon_speak
                less_than=1
            [/variable]
        [then]
            {SPEAKER_GENERIC (speaker=Adart'han) ( _ "Did the ground spit you out that you dare to come here!")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "The Rod of Justice... Give it...")}

            [if]
                [variable]
                    name=drake_lair[0]
                    greater_than=0
                [/variable]
                [or]
                    [variable]
                        name=drake_lair[1]
                        greater_than=0
                    [/variable]
                [/or]
            [then]
                {SPEAKER_GENERIC (speaker=Adart'han) ( _ "You destroy my property... You kill my guards. Murdered even their offspring. And demand the most precious of my treasures!!!")}
            [/then]
            [else]
                {SPEAKER_GENERIC (speaker=Adart'han) ( _ "You destroy my property... You kill my guards. And demand the most precious of my treasures!!!")}
            [/else]
            [/if]

            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Purpose...")}
            {SPEAKER_GENERIC (speaker=Adart'han) ( _ "What are you wailing about? Why did I even bother talking to... a Thing like you?")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Purpose!...")}
            {SPEAKER_GENERIC (speaker=Adart'han) ( _ "You are nothing but insolence! I will burn you to ashes!")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Swallow their souls! (<i>Laugh</i>)")}

            [message]
                speaker=narrator
                message= _ "Killing a dragon does not affect the points of blood."
                image=wesnoth-icon.png
            [/message]

            {VARIABLE dragon_speak 1}
        [/then]
        [/if]
    #enddef

    #define DANCER_SPEAK
        [if]
            [variable]
                name=dancer_speak
                less_than=1
            [/variable]
        [then]
            {SPEAKER_GENERIC (id=Runic Blade Guard 2) ( _ "I smell the shadow of death.")}
            {SPEAKER_GENERIC (id=Runic Blade Guard 1) ( _ "I feel it too.")}
            {SPEAKER_GENERIC (id=Runic Blade Guard 2) ( _ "Damned can't get passsst us.")}
            {SPEAKER_GENERIC (id=Runic Blade Guard 1) ( _ "We are the dancers of the runic blade.")}
            {SPEAKER_GENERIC (id=Runic Blade Guard 2) ( _ "They will not passss.")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "How pathetic! Whomever possesses even the smallest and most worthless crumbs of magic knowledge starts to believe that he can face anything that crosses his way.")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Fortunately we do not have to deal with them. It is possible to take a walk along the bottom of the lake and remain undetected.")}

            [if]
                [have_unit]
                    side=1
                    race=human
                [/have_unit]
            [then]
                {SPEAKER_NECROMANCER ( _ "My lord please excuse my boldness but we are alive and can't do that...")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Ah this temporary issue can be easily fixed.")}
            [/then]
            [/if]

            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Anyway why bother trying rescue them before their own bumptiousness if no one wants to live?... It's equally good to use this just to our advantage in the incoming onslaught.")}

            #ifdef NIGHTMARE
                {VARIABLE missing_dancers 2}
            #else
                {VARIABLE missing_dancers 1}
            #endif

            #ifdef EASY
                {VARIABLE missing_dancers 0}
            #endif

            {VARIABLE dancer_speak 1}
        [/then]
        [/if]
    #enddef

    #define TREASON_SPEAK TURN MESSAGE
        [event]
            name=turn {TURN}

            [if]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
                [and]
                    [variable]
                        name=warning_traitor
                        not_equals=1
                    [/variable]
                [/and]
            [then]
                {SPEAKER_WHISPER {MESSAGE}}
            [/then]
            [/if]
        [/event]
    #enddef

    #define FOUND_GOLD UNIT SIZE AMOUNT
        [if]
            [variable]
                name={UNIT}.id
                not_equals=Tallin
            [/variable]
        [then]
            # This units are not directly depedent from Tallin
            [if]
                [variable]
                    name={UNIT}.race
                    equals=human
                [/variable]
                [or]
                    [variable]
                        name={UNIT}.type
                        equals=Lich
                    [/variable]
                [/or]
                [or]
                    [variable]
                        name={UNIT}.id
                        equals=Abhai
                    [/variable]
                [/or]
            [then]
                {SPEAKER_GENERIC (speaker={UNIT}) ( _ "We have found some gold.")}
            [/then]
            [else]
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Ah... We have found some gold...")}
            [/else]
            [/if]
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Ah... Some gold...")}
        [/else]
        [/if]

        # This is to not put macro in translatable string
        {VARIABLE gain_gold {AMOUNT}}

        [sound]
            name=gold.ogg
        [/sound]
        [message]
            speaker=narrator
            message= _ "You have gained $gain_gold gold pieces"
            image=items/gold-coins-{SIZE}.png
        [/message]
        [gold]
    	    side=1
	        amount=$gain_gold
        [/gold]

        {CLEAR_VARIABLE gain_gold}
    #enddef

    #define FOUND_FLAYER UNIT
        [kill]
            id=${UNIT}.id
        [/kill]

        [unit]
            id=Messenger
            type=Vampire Bat
            side=1
            [modifications]
                {TRAIT_FERAL_MUSTHAVE}
                {TRAIT_LOYAL}
            [/modifications]
            {IS_LOYAL}
            x=$x1
            y=$y1
        [/unit]

        [sound]
            name=bat-hit-1.ogg
        [/sound]
        {SPEAKER_GENERIC (id=Messenger) ( _ "Neep")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Are you lost little flier? Hear the call of blood! Bring our message to the world!...")}
        [allow_recruit]
            side=1
            type=Vampire Bat
        [/allow_recruit]
        [message]
            speaker=narrator
            message= _ "Now you can recruit bats."
            image=wesnoth-icon.png
        [/message]
    #enddef

    #define VICTIMS_UPDATE
        [message]
            speaker=narrator
            message= _ "<span color='#ff0000'>Remaining points of blood: $bloodpoints</span>"
            image=wesnoth-icon.png
        [/message]
    #enddef

    #define VICTIMS_EFFECT
        # Running out of bloodpoints
        [if]
            [variable]
                name=bloodpoints
                numerical_equals=$bloodpoints_low
            [/variable]
        [then]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "I want to live...")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "If I would bathe in blood... Would I be whole again?...")}
            {SPEAKER_NECROMANCER ( _ "My lord... Forgive me but I did not understand you.")}

            [if]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [then]
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "Tallin are you all right? You really are behaving odd my boy.")}
                # wmllint: no spellcheck
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Actually I never felt sooo goood...")}
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "It seems that the shadows around you are darkening, you know?")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "No. It's bright as day here. Some more revelations?")}
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "Tallin I've been watching you and I think this is because of all these creatures you kill. I would advise to do it only when it's really necessary. Since it seems to have some kind of bad influence on you...")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Yours drivel do not concern me.")}
            [/then]
            [/if]

            {SPEAKER_GENERIC (speaker=Tallin) ( _ "I sense... Life...")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Lets move...")}
        [/then]
        [/if]

        # Last bloodpoint
        [if]
            [variable]
                name=bloodpoints
                numerical_equals=1
            [/variable]
        [then]
            # wmllint: local spelling huuungeeer
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "We feel huuungeeer!...")}

            [if]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [then]
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "Tallin now I'm sure of it. Something bad is happening to you when you are killing.")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Tallin? Who is that?")}
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "That's you remember?")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Tallin is dead. I'm the lord.")}
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "As you wish... Lord I'm just saying that It would be wise to kill only those you need to find the Rod.")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "And why should we spare the ill-natured?")}
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "Because our... Purpose is to find the Rod of Justice not wipe out all that is alive in this area.")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "I am the executor of the purpose...")}
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "Tallin do not sleep! The Trail has no lord! If you shed to much blood you will end up dreaming about your past with the rest of your... Troops.")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Failure of Malifor, do not bother with things that are beyond you...")}
            [/then]
            [/if]

            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Eternal dreams await...")}
        [/then]
        [/if]

        # Awake (It occurs later that's why I check for it first)
        [if]
            [variable]
                name=bloodpoints
                numerical_equals=0
            [/variable]
            [and]
                [variable]
                    name=warning_traitor
                    numerical_equals=1
                [/variable]
            [/and]
        [then]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Wait...")}
            {SPEAKER_ABYSS ( _ "My lord...")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "That item the traitor was looking for... The Rod of Justice... May have something to deal with the purpose... We must find it to learn the truth. And we have to stop eliminating the ill-natured for now... Their weakness is suspicious... They may try to realize some hidden plot against us...")}
            {SPEAKER_ABYSS ( _ "My lord. How we can be sure about this if we do not bring them justice?")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Oh... They shouldn't disappear in the meantime... So even if this is the case we can learn the truth later from their entrails...")}
        [/then]
        [/if]

        # No bloodpoints left
        [if]
            [variable]
                name=bloodpoints
                numerical_equals=0
            [/variable]
            [and]
                [variable]
                    name=warning_traitor
                    not_equals=1
                [/variable]
            [/and]
        [then]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "The End is coming...")}
            # wmllint: local spelling Soooon
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Soooon!...")}

            [if]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [then]
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "No Tallin do not sleep. Not yet. I will not allow this to happen.")}
                {SPEAKER_WHISPER ( _ "Watch him my lord he may want to betray you now... He is just waiting for a moment to strike first...")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "I know what you are thinking...")}
            [/then]
            [/if]

            # Although this variable is used for something else we reuse it for marking this event as used.
            {VARIABLE warning_traitor 1}
        [/then]
        [/if]

        # Dream!!!
        [if]
            [variable]
                name=bloodpoints
                less_than=0
            [/variable]
        [then]
            [if]
                # This condition is neccessery since we can spend more bloodpoints in turn than one and Abhai will decide to part ways in his turn
                [variable]
                    name=bloodpoints
                    less_than=-1
                [/variable]
                [or]
                    [not]
                        [have_unit]
                            side=1
                            id=Abhai
                        [/have_unit]
                    [/not]
                [/or]
            [then]
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Is it time?...")}

                [if]
                    [variable]
                        name=bloodpoints
                        less_than=-1
                    [/variable]
                [then]
                    {SPEAKER_GENERIC (speaker=Tallin) ( _ "Leave the traitor... Only the purpose counts...")}
                [/then]    
                [/if]

                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Friends... Brothers in arms... We came here seeking Justice... But true justice can be found only in a pure spirit... Do we not have it already?... We who were betrayed and despised by those for whom we sacrificed everything we had on this world... We have... So lets share it... Lets bring it to all the ill-natured... First to Knalga... (<i>Laugh</i>)")}

                [endlevel]
                    result=defeat
                [/endlevel]
            [/then]
            [/if]
        [/then]
        [/if]
    #enddef

    #define DRAKE_LAIR SIDE OWNER X Y
        [event]
            name=moveto

            [filter]
                side=1
                x={X}
                y={Y}
            [/filter]

            [if]
                [variable]
                    name=drake_lair[{OWNER}]
                    less_than=1
                [/variable]
            [then]
                [sound]
                    name=drake-hit-1.ogg
                [/sound]
                [delay]
                    time=300
                [/delay]
                [sound]
                    name=torch.ogg
                [/sound]
                [delay]
                    time=300
                [/delay]
                [sound]
                    name=cave-in.ogg
                [/sound]

                [terrain]
                    x={X}
                    y={Y}
                    terrain=Rr^Dr
                [/terrain]

                [modify_side]
                    side={SIDE}
                    income=40
                [/modify_side]

                {VARIABLE drake_lair[{OWNER}] 1}
                {VARIABLE_OP bloodpoints sub 1}

                [message]
                    speaker=narrator
                    message= _ "Income of an enemy was reduced by 31 gold pieces."
                    image=wesnoth-icon.png
                [/message]

                {VICTIMS_UPDATE}
                {VICTIMS_EFFECT}
            [/then]
            [else]
                [sound]
                    name=drake-hit-1.ogg
                [/sound]
                [delay]
                    time=300
                [/delay]
                [sound]
                    name=torch.ogg
                [/sound]
                [delay]
                    time=300
                [/delay]
                [sound]
                    name=cave-in.ogg
                [/sound]

                [terrain]
                    x={X}
                    y={Y}
                    terrain=Rr^Dr
                [/terrain]

                [modify_side]
                    side={SIDE}
                    income=10
                [/modify_side]

                {VARIABLE_OP bloodpoints sub 1}

                [message]
                    speaker=narrator
                    message= _ "Income of an enemy was reduced by 31 gold pieces."
                    image=wesnoth-icon.png
                [/message]

                {VICTIMS_UPDATE}
                {VICTIMS_EFFECT}
            [/else]
            [/if]
        [/event]
    #enddef

    #define ASSEMBLE_ARMY SIDE RECRUITS EASY_GOLD NORMAL_GOLD HARD_GOLD NIGHTMARE_GOLD
        # This is to guarantee that starting gold is not affected by game factors
        [modify_side]
            side={SIDE}
            {GOLD4 {EASY_GOLD} {NORMAL_GOLD} {HARD_GOLD} {NIGHTMARE_GOLD}}        
            recruit={RECRUITS}        
         [/modify_side]
    #enddef

    #define ASSEMBLE_RUNIC_BLADE_DANCERS
        [if]
            [variable]
                name=naga_dancers_assembled
                not_equals=1
            [/variable]
        [then]
            {SPEAKER_GENERIC (role=Runic Blade Dancer) ( _ "The damned are coming!!!")}

            [store_unit]
                [filter]
                    role=Runic Blade Dancer
                [/filter]
                kill=no
                variable=guarding_units
            [/store_unit]

            # Creating a loop is not a complete must here. There are only two guarding units, but I don't have to create macro to achieve that in low line count
            {FOREACH guarding_units i}

            [object]
                silent=yes
                [filter]
                    x,y=$guarding_units[$i].x,$guarding_units[$i].y
                [/filter]
                [effect]
                    apply_to=movement_costs
                    replace=false
                    [movement_costs]
                        flat=-30
                        shallow_water=-30
                        deep_water=-30
                    [/movement_costs]
                [/effect]
            [/object]

            {NEXT i}

            {CLEAR_VARIABLE guarding_units}

            {ASSEMBLE_ARMY 5 "Naga Fighter" 125 150 200 250}

            {VARIABLE naga_dancers_assembled 1}
        [/then]
        [/if]
    #enddef

    #define DWARVEN_ENCOUNTER
        [if]
            [variable]
                name=dwarven_encounter
                numerical_equals=1
            [/variable]
        [then]
            [unit]
                side=4
                type=Dwarvish Lord
                id=Haffel
                name= _ "Haffel"
                x=19
                y=30
            [/unit]
            [unit]
                side=4
                type=Dwarvish Dragonguard
                id=Hekkna
                name= _ "Hekkna"
                x=18
                y=30
            [/unit]

            {GENERIC_UNIT 4 "Dwarvish Steelclad" 17 32}
            {GENERIC_UNIT 4 "Dwarvish Steelclad" 20 30}
            {GENERIC_UNIT 4 "Dwarvish Thunderguard" 18 31}
            {GENERIC_UNIT 4 "Dwarvish Thunderguard" 21 31}
        [/then]
        [else]
            [unit]
                side=4
                type=Dwarvish Lord
                id=Haffel
                name= _ "Haffel"
                x=35
                y=6
            [/unit]
            [unit]
                side=4
                type=Dwarvish Dragonguard
                id=Hekkna
                name= _ "Hekkna"
                x=37
                y=6
            [/unit]

            {GENERIC_UNIT 4 "Dwarvish Steelclad" 37 7}
            {GENERIC_UNIT 4 "Dwarvish Steelclad" 38 7}
            {GENERIC_UNIT 4 "Dwarvish Thunderguard" 36 3}
            {GENERIC_UNIT 4 "Dwarvish Thunderguard" 36 5}
        [/else]
        [/if]

        {SPEAKER_GENERIC (speaker=Haffel) ( _ "Watcha boys! Before us is evidence o' how good Hamel ha' cleared Knalga from undead...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Hamel... Do you belong to his clan?")}
        {SPEAKER_GENERIC (speaker=Hekkna) ( _ "It speaks! It speaks! Amazing for something that carries only air in its skull. Or perhaps one or two worms! Har har har!")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "Ye are so funny skel! So since you were too stupid to learn that when ye where alive we will forgive ye offense and tell ye now.")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "We are real dwarfs from the Iron fist clan, Not ruled by some false dwarf. Now watcha rottie it's important. Ye watcha? I do not know ye watcha because ye ha' no eyes but let assume ye do. Hamel is not a dwarf at all! He is a progeny o' an foul orc and some elven woman. A stunted human! If there is something worse than that it's only a human that refuses to die. That's ye rottie. Which is why we can honestly talk about it. But lets continue...")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "He drunk a lot to make himself talk like a dwarf. His clan was drinking too since they otherwise would find out that he is no dwarf! Drinking made his clan weak and poor. So they stop drinking for a while since they ran out o' gold and in a meantime killed Khazag Black-Duck. Some says that he was Black-Tusk, but I don't believe that since he was known from quacking around all tha time. But he has drunk luck. He met some group o' human outcasts who offered to help... They did that because he is a human! Har har! Ye see.")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "Anyway they join forces and moved to the haunted part o' Knalga. When ye drinking to much ye can see many things... No worries rottie ye will never find out that. Har har. There they discovered a huge booze cellar so they immediately start drinking. Humans and dwarfs. Many o' them died during this heroic mission because o' overdosing liquor. One o' them in drunken stupor just got lost in 'em caves. When he recovered he has learned that lich - if any was there - was gone! So he returned and informed Hamel about that. He did it right in time since they managed to finish all tha booze.")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "And now he claims that all o' Knalga belongs to him! That little human drinker! Do not understand me wrong I really appreciate that he founded out that there is no lich. However since the lies about his victory are wide spread even among dwarfs we true dwarfs can't do much about that besides rescuing the treasures o' Knalga before all o' them will be spent on booze!")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "You found it... The Rod... Of Justice... Where is it!?...")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "Ye actually know who we are and ye are still here? I guess ye are not very smart?")}
        {SPEAKER_GENERIC (speaker=Hekkna) ( _ "Hey bro who is the smartest in this group o' undead?")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "I do not know bro! Throw.")}
        {SPEAKER_GENERIC (speaker=Hekkna) ( _ "Some lost worm in one o' their bodies!")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "Har har har! Those are the dumbest I ever seen!")}
        {SPEAKER_GENERIC (speaker=Hekkna) ( _ "Nothing strange look at their bodies they have no flesh. The last worm must have died a long time ago!")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "Har har har! Rottie since ye are such an entertaining puppet and ye started to speak in so funny manner like ye couldn't breath. We will throw ye the truth and then be so nice and get back to tha grave ye ha' crawled out.")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "We ha' retrieve it from a cold hands of a thief and gave it to tha great goon and his goonish guards...")}
        {SPEAKER_GENERIC (speaker=Hekkna) ( _ "Dragon and drakes... I just wanna to explain that for rottie so he would know.")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "I'm sure rottie appreciates that. Anyway it was a good trade since in this part o' caves all creatures know tha goon and no one dares to cross his word. But even if tha goon will get choked with ye for ye and your master this item is useless, since it will surely destroy ye. Now get dig your self unless ye have some information that could interest us.")}
        {SPEAKER_GENERIC (speaker=Hekkna) ( _ "Common rottie or we ha' to enlighten your dark mind with dragon stick or hammer.")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "It's time!...")}
        {SPEAKER_GENERIC (speaker=Haffel) ( _ "Know your place underground rottie!")}

        {VARIABLE dwarven_encounter 2}
    #enddef

    [side]
        {PROTAGONIST_FORCES}
        {GOLD4 300 250 200 150}
        user_team_name={S_UNDEAD}
        shroud=yes
        fog=no
        {FLAG_VARIANT undead}
    [/side]

    [side]
        type=Irdya Dragon
        id=Adart'han
        name= _ "Adart'han"
        canrecruit=yes
        side=2
        team_name=foe
        user_team_name=" "
        controller=ai
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_STRONG}
        [/modifications]
        gold=0
        income=70
        [ai]
            aggression=1.0
            caution=-1.0
            grouping="offensive"
            recruitment_ignore_bad_combat=yes
            recruitment_pattern=archer,archer,archer,fighter,mixed fighter
        [/ai]
    [/side]

    [side]
        no_leader=yes
        side=3
        team_name=foe
        user_team_name=" "
        controller=ai
        {GOLD4 100 150 200 250}
        {INCOME4 4 8 12 16}
        recruit=Vampire Bat,Blood Bat
        [ai]
            simple_targeting=yes
            recruitment_ignore_bad_combat=yes
            aggression=1.0
            caution=-5.0
            leader_value=50.0
            villages_per_scout=0.0
            recruitment_pattern=scout
            [goal]
                [criteria]
                    id=Tallin
                [/criteria]
                value=500
            [/goal]
        [/ai]
    [/side]

    [side]
        no_leader=yes
        side=4
        team_name=foe
        user_team_name=" "
        controller=ai
        income=-2
        hidden=yes
        [ai]
            village_value=0.0
            caution=0.5
            aggression=1.0
            grouping="offensive"
            [goal]
                [criteria]
                    id=Tallin
                [/criteria]
                value=500
            [/goal]
        [/ai]
    [/side]

    [side]
        type=Naga Myrmidon
        id=Xnamoros
        name= _ "Xnamoros"
        side=5
        team_name=foe
        user_team_name=" "
        controller=ai
        [modifications]
            {TRAIT_STRONG}
            {TRAIT_RESILIENT}
        [/modifications]
        gold=0
        [ai]
            caution=0.6
            grouping="defensive"
            recruitment_pattern=fighter
        [/ai]
    [/side]

    [side]
        type=Troll Warrior
        id=Zuggah
        name= _ "Zuggah"
        canrecruit=yes
        side=6
        team_name=foe
        user_team_name=" "
        controller=ai
        [modifications]
            {TRAIT_QUICK}
            {TRAIT_RESILIENT}
        [/modifications]        
        recruit=Troll Whelp,Troll,Troll Rocklobber
        {GOLD4 20 60 100 150}
        [ai]
            aggression=0.6
            recruitment_ignore_bad_combat=yes
        [/ai]
    [/side]

    [side]
        type=Drake Flameheart
        id=Gart’Ihn
        name= _ "Gart’Ihn"
        canrecruit=yes
        side=7
        team_name=foe
        user_team_name=" "
        controller=ai
        [modifications]
            {TRAIT_INTELLIGENT}
            {TRAIT_QUICK}
        [/modifications]
        gold=0
        income=70
        [ai]
            aggression=0.8
            caution=0.0
            grouping="defensive"
            recruitment_ignore_bad_combat=yes
            recruitment_pattern=archer,archer,fighter
            [goal]
                name=protect_location
                [criteria]
                    x=3
                    y=11
                [/criteria]
                protect_radius=2
                value=10
            [/goal]
            [goal]
                name=protect_location
                [criteria]
                    x=3
                    y=16
                [/criteria]
                protect_radius=2
                value=10
            [/goal]
            [goal]
                name=protect_location
                [criteria]
                    x=13
                    y=19
                [/criteria]
                protect_radius=2
                value=10
            [/goal]
            [goal]
                name=protect_location
                [criteria]
                    x=18
                    y=19
                [/criteria]
                protect_radius=2
                value=10
            [/goal]
        [/ai]
    [/side]

    [event]
        name=prestart

        [set_menu_item]
            id=08b_help
            description= _ "About victims"
            [show_if]
                [have_unit]
                    side=1
                    x,y=$x1,$y1
                    canrecruit=yes
                [/have_unit]
            [/show_if]
            [command]
                {VICTIMS_ABOUT}
            [/command]
        [/set_menu_item]

        [objectives]
            side=1
            [objective]
                condition=win
                description= _ "Find the Rod of Justice"
            [/objective]
            [objective]
                condition=lose
                description= _ "Destruction of Tallin"
            [/objective]
            [objective]
                condition=lose
                description= _ "Too many victims" +{OBJECTIVE_FOOTNOTE _"(Right-click on Tallin during your turn to get information about victims)"}
            [/objective]

            {GOLD_CARRYOVER_DEFAULT no}
        [/objectives]

        [switch]
            variable=cavern_shape
            [case]
                value="1"
                {VARIABLE bat_leader_x 51}
                {VARIABLE bat_leader_y 13}
                {VARIABLE bat_tunnel_x1 29}
                {VARIABLE bat_tunnel_y1 26}
                {VARIABLE bat_tunnel_x2 2}
                {VARIABLE bat_tunnel_y2 40}
                {VARIABLE bat_tunnel_x3 42}
                {VARIABLE bat_tunnel_y3 42}
                {VARIABLE bat_tunnel_x4 3}
                {VARIABLE bat_tunnel_y4 46}
                {VARIABLE bat_tunnels_x "29-30,29,1-2,1,41-42,4,3-4"}
                {VARIABLE bat_tunnels_y "26,27,40,41,42-43,45,46"}
                {VARIABLE tunnel_walls_x "28,28-31,2,1-2,40-41,38-39,2,2-4,3-4"}
                {VARIABLE tunnel_walls_y "24,25,41,42-43,41,42,46,47,48"}
            [/case]
            [case]
                value="2"
                {VARIABLE bat_leader_x 28}
                {VARIABLE bat_leader_y 24}
                {VARIABLE bat_tunnel_x1 53}
                {VARIABLE bat_tunnel_y1 12}
                {VARIABLE bat_tunnel_x2 2}
                {VARIABLE bat_tunnel_y2 40}
                {VARIABLE bat_tunnel_x3 42}
                {VARIABLE bat_tunnel_y3 42}
                {VARIABLE bat_tunnel_x4 3}
                {VARIABLE bat_tunnel_y4 46}
                {VARIABLE bat_tunnels_x "53-54,1-2,1,41-42,4,3-4"}
                {VARIABLE bat_tunnels_y "12-13,40,41,42-43,45,46"}
                {VARIABLE tunnel_walls_x "50-52,51,53,2,1-2,40-41,38-39,2,2-4,3-4"}
                {VARIABLE tunnel_walls_y "12-13,14,14,41,42-43,41,42,46,47,48"}
            [/case]
            [case]
                value="3"
                {VARIABLE bat_leader_x 1}
                {VARIABLE bat_leader_y 43}
                {VARIABLE bat_tunnel_x1 53}
                {VARIABLE bat_tunnel_y1 12}
                {VARIABLE bat_tunnel_x2 29}
                {VARIABLE bat_tunnel_y2 26}
                {VARIABLE bat_tunnel_x3 42}
                {VARIABLE bat_tunnel_y3 42}
                {VARIABLE bat_tunnel_x4 3}
                {VARIABLE bat_tunnel_y4 46}
                {VARIABLE bat_tunnels_x "53-54,29-30,29,41-42,4,3-4"}
                {VARIABLE bat_tunnels_y "12-13,26,27,42-43,45,46"}
                {VARIABLE tunnel_walls_x "50-52,51,53,28,28-31,40-41,38-39,2,2-4,3-4"}
                {VARIABLE tunnel_walls_y "12-13,14,14,24,25,41,42,46,47,48"}
            [/case]
            [case]
                value="4"
                {VARIABLE bat_leader_x 38}
                {VARIABLE bat_leader_y 42}
                {VARIABLE bat_tunnel_x1 53}
                {VARIABLE bat_tunnel_y1 12}
                {VARIABLE bat_tunnel_x2 29}
                {VARIABLE bat_tunnel_y2 26}
                {VARIABLE bat_tunnel_x3 2}
                {VARIABLE bat_tunnel_y3 40}
                {VARIABLE bat_tunnel_x4 3}
                {VARIABLE bat_tunnel_y4 46}
                {VARIABLE bat_tunnels_x "53-54,29-30,29,1-2,1,4,3-4"}
                {VARIABLE bat_tunnels_y "12-13,26,27,40,41,45,46"}
                {VARIABLE tunnel_walls_x "50-52,51,53,28,28-31,2,1-2,2,2-4,3-4"}
                {VARIABLE tunnel_walls_y "12-13,14,14,24,25,41,42-43,46,47,48"}
            [/case]
            [else]
                {VARIABLE bat_leader_x 2}
                {VARIABLE bat_leader_y 47}
                {VARIABLE bat_tunnel_x1 53}
                {VARIABLE bat_tunnel_y1 12}
                {VARIABLE bat_tunnel_x2 29}
                {VARIABLE bat_tunnel_y2 26}
                {VARIABLE bat_tunnel_x3 2}
                {VARIABLE bat_tunnel_y3 40}
                {VARIABLE bat_tunnel_x4 42}
                {VARIABLE bat_tunnel_y4 42}
                {VARIABLE bat_tunnels_x "53-54,29-30,29,1-2,1,41-42"}
                {VARIABLE bat_tunnels_y "12-13,26,27,40,41,42-43"}
                {VARIABLE tunnel_walls_x "50-52,51,53,28,28-31,2,1-2,40-41,38-39"}
                {VARIABLE tunnel_walls_y "12-13,14,14,24,25,41,42-43,41,42"}
            [/else]
        [/switch]

        {VARIABLE missing_tentacles 0}
        {VARIABLE spawn_bat 0}
        {VARIABLE spawn_bat_phase 1}
        {VARIABLE light_source 1}
        {VARIABLE abyss_whisper 1}

        #ifdef EASY
            {VARIABLE bloodpoints 6}
            {VARIABLE spawn_bat_blood 5}
            {VARIABLE spawn_bat_max 24}
            {VARIABLE bloodpoints_low 3}
        #endif

        #ifdef NORMAL
            {VARIABLE bloodpoints 5}
            {VARIABLE spawn_bat_blood 4}
            {VARIABLE spawn_bat_max 28}
            {VARIABLE bloodpoints_low 3}
        #endif

        #ifdef HARD
            {VARIABLE bloodpoints 4}
            {VARIABLE spawn_bat_blood 4}
            {VARIABLE spawn_bat_max 36}
            {VARIABLE bloodpoints_low 2}
        #endif

        #ifdef NIGHTMARE
            {VARIABLE bloodpoints 3}
            {VARIABLE spawn_bat_blood 3}
            {VARIABLE spawn_bat_max 40}
            {VARIABLE bloodpoints_low 2}
        #endif

        [terrain]
            x=3
            y=4
            terrain=Re
        [/terrain]
        [terrain]
            x=18
            y=9
            terrain=Ch
        [/terrain]
        [terrain]
            x=9,10,12,42
            y=23,16,16,42
            terrain=Qxu
        [/terrain]
        [terrain]
            x=1,3
            y=41,46
            terrain=Uu
        [/terrain]
        [terrain]
            x=29-30
            y=26
            terrain=Ww
        [/terrain]
        [terrain]
            x=11,20
            y=4,23
            terrain=Kud
        [/terrain]
        [terrain]
            x=12,11,13,7,9,5,1,2,12,14,19,20,18
            y=4,5,8,9,9,10,12,14,17,20,21,24,25
            terrain=Cud
        [/terrain]
        [terrain]
            x=53-54,53,21
            y=12,13,24
            terrain=Wo
        [/terrain]
        [terrain]
            x=21,10,17
            y=4,23,25
            terrain=Uh
        [/terrain]
        [terrain]
            x=22-23,25,8,7
            y=5,7,16,17
            terrain=Rd
        [/terrain]
        [terrain]
            x=2,5,3,10,11,12,13,15,18
            y=11,11,14-15,15,16,15,16-18,19,20-21
            terrain=Rr
        [/terrain]
        [terrain]
            x=8-10,9-10,12,9-11,14,8,9,7,9,14,9,14,19,9,18
            y=4,5,5,6,7,8-9,10,16,16-17,17,19,19,20,24,24
            terrain=Dd
        [/terrain]
        [terrain]
            x=20,22,26,25-27,16-17,25,16-19,17-18,2
            y=3-4,4,7,8,9,9,10,11,40
            terrain=Ql
        [/terrain]
        [terrain]
            x=11,20-21,54,29
            y=15,5,13,27
            terrain=Uu^Uf
        [/terrain]
    [/event]

    [event]
        name=start

        {PLACE_IMAGE items/ankh-necklace.png 51 39}
        {PLACE_IMAGE items/gold-coins-medium.png 29 3}
        {PLACE_IMAGE items/gold-coins-medium.png 29 4}
        {PLACE_IMAGE items/gold-coins-medium.png 30 2}
        {PLACE_IMAGE items/gold-coins-medium.png 30 3}
        {PLACE_IMAGE items/gold-coins-medium.png 31 3}
        {PLACE_IMAGE items/gold-coins-medium.png 31 4}
        {PLACE_IMAGE items/gold-coins-medium.png 32 3}
        {PLACE_IMAGE items/staff.png 30 3}

        [terrain]
            x=$tunnel_walls_x
            y=$tunnel_walls_y
            terrain=Xu
        [/terrain]

        [unit]
            type=Dread Bat
            id="Vile Bat"
            side=3
            canrecruit=yes
            [modifications]
                {TRAIT_FERAL_MUSTHAVE}
                {TRAIT_RESILIENT}
            [/modifications]
            x=$bat_leader_x
            y=$bat_leader_y
        [/unit]

        {PUT_GUARDIAN 2 "Drake Arbiter" 4 5}
        {PUT_GUARDIAN 2 "Drake Arbiter" 6 6}
        {PUT_GUARDIAN 2 "Drake Enforcer" 7 9}
        {PUT_GUARDIAN 2 "Drake Enforcer" 9 9}
        {PUT_GUARDIAN 2 "Drake Enforcer" 13 8}
        {PUT_GUARDIAN 2 "Drake Enforcer" 15 8}
        {PUT_GUARDIAN 2 "Drake Arbiter" 7 14}
        {PUT_GUARDIAN 2 "Drake Arbiter" 9 14}

        {PUT_GUARDIAN 2 "Drake Arbiter" 2 9}
        {PUT_GUARDIAN 2 "Drake Thrasher" 5 10}
        {PUT_GUARDIAN 2 "Drake Arbiter" 1 12}
        {PUT_GUARDIAN 2 "Drake Thrasher" 4 12}
        {PUT_GUARDIAN 2 "Drake Thrasher" 2 14}
        {PUT_GUARDIAN 2 "Drake Thrasher" 5 15}
        {PUT_GUARDIAN 2 "Drake Arbiter" 1 17}
        {PUT_GUARDIAN 2 "Drake Arbiter" 4 17}
        {PUT_GUARDIAN 7 "Drake Arbiter" 12 17}
        {PUT_GUARDIAN 7 "Drake Thrasher" 15 18}
        {PUT_GUARDIAN 7 "Drake Arbiter" 11 20}
        {PUT_GUARDIAN 7 "Drake Thrasher" 14 20}
        {PUT_GUARDIAN 7 "Drake Arbiter" 17 18}
        {PUT_GUARDIAN 7 "Drake Arbiter" 20 18}
        {PUT_GUARDIAN 7 "Drake Thrasher" 16 20}
        {PUT_GUARDIAN 7 "Drake Thrasher" 19 21}

        {PUT_GUARDIAN 2 "Drake Warden" 7 23}
        [+unit]
            role=Drake Domain Guard
        [/unit]
        {PUT_GUARDIAN 2 "Drake Warden" 8 26}
        [+unit]
            role=Drake Domain Guard
        [/unit]
        {PUT_GUARDIAN 7 "Drake Warden" 20 23}
        [+unit]
            role=Drake Domain Guard
        [/unit]
        {PUT_GUARDIAN 7 "Drake Warden" 18 26}
        [+unit]
            role=Drake Domain Guard
        [/unit]

        #ifdef EASY
            {PUT_RUNIC_BLADE_GUARD "Runic Blade Guard 1" "Naga Fighter" 39 19}
        #else
            {PUT_RUNIC_BLADE_GUARD "Runic Blade Guard 1" "Naga Warrior" 39 19}
        #endif

        #ifdef NIGHTMARE
            {PUT_RUNIC_BLADE_GUARD "Runic Blade Guard 2" "Naga Warrior" 39 21}
        #else
            {PUT_RUNIC_BLADE_GUARD "Runic Blade Guard 2" "Naga Fighter" 39 21}
        #endif

        # Village capturing could be moved to different events since those sides do not need them at this stage
        [capture_village]
            side=2
            x=3,3
            y=11,16
        [/capture_village]

        [capture_village]
            side=5
            x=36,32
            y=14,16
        [/capture_village]

        [capture_village]
            side=7
            x=13,18
            y=19,19
        [/capture_village]

        {UNIT 1 "Wraith" 59 9 (
            [modifications]
                {TRAIT_UNDEAD}
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
            {IS_LOYAL}
            id=Abhai
            name= _ "Abhai"
            unrenamable=yes
            #profile=Abhai.png
        )}

        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Stand where you are! All you shall find here will be your own destruction!")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Really?... Lets find out... whether you are able... To serve your purpose...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Malifor sent you? I knew it when I sensed you in a passage! (<i>Swings with blade.</i>) Do you know what this is?")}
        {SPEAKER_GENERIC (speaker=Tallin) (_ "It is broken?...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "No... It can't be broken.")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "So what's the point?...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Are you even dimly aware what I am?")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Possibly... One of Malifors early creations... Since its destruction you're purposeless...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Well... Wait. He is destroyed? Dead?")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "I have already... Given you an answer...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "But I still exist... Hey what are you going to do now?")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "I have no will... I had a purpose...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "What is your purpose then?")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Destruction... I sense something... In this lake... That may be of use... To fulfill it...")}
        {MOVE_UNIT id=Tallin 58 8}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Wait a moment. Don't be so impatient. You have a lot of time to fulfill your... Purpose. I just want to talk.")}
        {MOVE_UNIT id=Abhai 57 9}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Right... It doesn't make... Any difference...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Could you stop whizzing...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Whizzing?... What do you mean?...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "The way you speak. Your voice sounds like whizzing of wind in cracks. It makes each of your words heavy like they where crafted in stone. It's good when you want to be heard far and wide. And it's pretty scary... It really stresses me out.")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "I suppose it should be... This way then... Since I am... a Really... Bad... Being...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Stop speaking like you have constant problems with breathing!")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Some time ago... Someone told me... That I caught a bad cold...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "You are skeleton! You don't have to breathe. You have no lungs!")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Heh... That's true... And I'm not breathing. But as you pointed out... Without... Lungs... It's pretty... Damn... Hard... To get enough air... To speak..")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "For death's sake! Were you always  that smart or is it just one of your better days? Damn instead of rattling with your jaw use your skull! YOU ARE a SKELETON! You have no muscles but you can move. You don't eat but you keep your strength. Your body is dead but it heals. The point is that whatever is sustaining your existence is not from this world. To speak you don't have to take a breath. Finally got it?!")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Thanks. I really didn't realize that being alive is so addictive. Habit from the past. (<i>Laugh</i>)")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Don't laugh either. It sounds like bunch of rocks falling into bottomless pit. There is no joy in it.")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Lately I have no reason to. It was a fine talk but, now I will put my purpose to end. So get lost in darkness...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Wait, wait. Now I finally got it too. You are seeking your own destruction. And your... Reason for that is?")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "I am a very dangerous tool. Too dangerous to wander around. It will be good if I finally get to rest.")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "It's hard to argue when I do not even know the brief version of your story...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Why not? I was once leading my people in revolution against orcish warlords. But I was proud. I never turned away from a challenge. And this is the cause of my current state. I failed and was raised by Malifor to slay my... Allies.")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "No offense but that's ridiculous. To blame yourself for things that happened after your death. I see no fault in your courage and it was ill luck that some necromancers grabbed your remains.")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Easy to say. But acting as an extension of someone else's will is... an interesting experience. Everything you think or do is right. And best of all...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Yes?")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Just leave me wraith.")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Nice you noticed, I am Abhai. And you are?")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Tallin the brave.")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Lets talk about your purpose then... Destruction... Certain destruction! Total! Absolute!")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Go on.")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "The destruction of your body is not enough. There are some necromancers wandering here... They could fix and use you... However there is an other way to accomplish this task. Somewhere around here is an artifact known as the Rod of Justice. It's incredibly old. They say it was crafted by the Great Gods themselves, and given to the first true Ruler of Men to ensure peace, harmony and above all — justice. I thought that if I could somehow reach the Rod, I would be able to destroy Malifor and be free of this state. When I was king - I was a king you know?")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Entertaining...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "I wielded the Rod of Justice. It contains such power that no creature that I have ever encountered can dare stand before it. The most interesting quality of this item for you is, that if a person who grasps the staff is a criminal, or has a heart full of darkness and evil, then the staff will smite them.")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Well if thats not enough for your quest of destruction, you can still go for those necromancers I mentioned too. Probably you have heard about place called the 'Prison of Souls'?")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "No.")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "It's a place where they study the dark arts. Where the vilest and most powerful undead are created. Probably it's the place where you where made too... This narrow passage heading on north leads there.")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "That rod sounds good...")}
        {MOVE_UNIT id=Tallin 53 9}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Wait, wait don't you hear it?")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Hear what?")}
        {MOVE_UNIT id=Abhai 56 8}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Those whispers: Tallin avenge us! Avenge!")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "What's this about now?")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "I sense it. You have a blood trail... Something that attracts restless souls and simple blood-seeking creatures to you. We can say that you are a speaker of the dead, vengeful spirit, whatever. Just use your gift and we are good to go...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Listen, Master of the Dark Arts, I have this curse, yes, and I tell you this: I can summon them but their hate becomes mine...")}
        {SPEAKER_GENERIC (speaker=Abhai) ( _ "Ah, it can't be that bad... You want find this rod right?")}
        {MOVE_UNIT id=Tallin 57 9}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "As you wish. But whatever happens remember: Between you and them only I am...")}

        {VICTIMS_ABOUT}
    [/event]

    [event]
        name=new turn
        first_time_only=no

        [if]
            [variable]
                name=light_source
                numerical_equals=2
            [/variable]
        [then]
            [terrain]
                x=3
                y=4
                terrain=Re^Ii
            [/terrain]
            [terrain]
                x=18
                y=9
                terrain=Ch^Ii
            [/terrain]
            [terrain]
                x=9,10,12,42
                y=23,16,16,42
                terrain=Qxu^Ii
            [/terrain]
            [terrain]
                x=1,3
                y=41,46
                terrain=Uu^Ii
            [/terrain]
            [terrain]
                x=29-30
                y=26
                terrain=Ww^Ii
            [/terrain]
            [terrain]
                x=11,20
                y=4,23
                terrain=Kud^Ii
            [/terrain]
            [terrain]
                x=12,11,13,7,9,5,1,2,12,14,19,20,18
                y=4,5,8,9,9,10,12,14,17,20,21,24,25
                terrain=Cud^Ii
            [/terrain]
            [terrain]
                x=53-54,53,21
                y=12,13,24
                terrain=Wo^Ii
            [/terrain]
            [terrain]
                x=21,10,17
                y=4,23,25
                terrain=Uh^Ii
            [/terrain]
            [terrain]
                x=22-23,25,8,7
                y=5,7,16,17
                terrain=Rd^Ii
            [/terrain]
            [terrain]
                x=2,5,3,10,11,12,13,15,18
                y=11,11,14-15,15,16,15,16-18,19,20-21
                terrain=Rr^Ii
            [/terrain]
            [terrain]
                x=8-10,9-10,12,9-11,14,8,9,7,9,14,9,14,19,9,18
                y=4,5,5,6,7,8-9,10,16,16-17,17,19,19,20,24,24
                terrain=Dd^Ii
            [/terrain]
            [terrain]
                x=20,22,26,25-27,16-17,25,16-19,17-18,2
                y=3-4,4,7,8,9,9,10,11,40
                terrain=Ql^Ii
            [/terrain]
            [terrain]
                x=11,20-21,54,29
                y=15,5,13,27
                terrain=Uu^Ufi
            [/terrain]
        [/then]
        [/if]

        [if]
            [variable]
                name=light_source
                numerical_equals=4
            [/variable]
        [then]
            [terrain]
                x=3
                y=4
                terrain=Re
            [/terrain]
            [terrain]
                x=18
                y=9
                terrain=Ch
            [/terrain]
            [terrain]
                x=9,10,12,42
                y=23,16,16,42
                terrain=Qxu
            [/terrain]
            [terrain]
                x=1,3
                y=41,46
                terrain=Uu
            [/terrain]
            [terrain]
                x=29-30
                y=26
                terrain=Ww
            [/terrain]
            [terrain]
                x=11,20
                y=4,23
                terrain=Kud
            [/terrain]
            [terrain]
                x=12,11,13,7,9,5,1,2,12,14,19,20,18
                y=4,5,8,9,9,10,12,14,17,20,21,24,25
                terrain=Cud
            [/terrain]
            [terrain]
                x=53-54,53,21
                y=12,13,24
                terrain=Wo
            [/terrain]
            [terrain]
                x=21,10,17
                y=4,23,25
                terrain=Uh
            [/terrain]
            [terrain]
                x=22-23,25,8,7
                y=5,7,16,17
                terrain=Rd
            [/terrain]
            [terrain]
                x=2,5,3,10,11,12,13,15,18
                y=11,11,14-15,15,16,15,16-18,19,20-21
                terrain=Rr
            [/terrain]
            [terrain]
                x=8-10,9-10,12,9-11,14,8,9,7,9,14,9,14,19,9,18
                y=4,5,5,6,7,8-9,10,16,16-17,17,19,19,20,24,24
                terrain=Dd
            [/terrain]
            [terrain]
                x=20,22,26,25-27,16-17,25,16-19,17-18,2
                y=3-4,4,7,8,9,9,10,11,40
                terrain=Ql
            [/terrain]
            [terrain]
                x=11,20-21,54,29
                y=15,5,13,27
                terrain=Uu^Uf
            [/terrain]
        [/then]
        [/if]

        [if]
            [variable]
                name=light_source
                greater_than=6
            [/variable]
        [then]
            {VARIABLE light_source 1}
        [/then]
        [/if]

        {VARIABLE_OP light_source add 1}
    [/event]

    [event]
        name=turn 2

        # Advantage of time spawned units over moveto is that they do not allow setting up battle even if player knows about them
        [sound]
            name=water-blast.wav
        [/sound]

        {PUT_TENTACLE 49 9}
        {PUT_TENTACLE 50 8}
        {PUT_TENTACLE 51 8}
        {PUT_TENTACLE 52 7}
        {PUT_TENTACLE 53 7}

        #ifdef NORMAL
            {PUT_TENTACLE 50 7}
            {PUT_TENTACLE 52 6}
        #endif

        #ifdef HARD
            {PUT_TENTACLE 49 8}
            {PUT_TENTACLE 50 7}
            {PUT_TENTACLE 51 7}
            {PUT_TENTACLE 52 6}
            {PUT_TENTACLE 53 6}
        #endif

        #ifdef NIGHTMARE
            {PUT_TENTACLE 49 8}
            {PUT_TENTACLE 50 7}
            {PUT_TENTACLE 51 7}
            {PUT_TENTACLE 52 6}
            {PUT_TENTACLE 53 6}
            {PUT_TENTACLE 50 6}
            {PUT_TENTACLE 52 5}
        #endif

        [event]
            name=new turn
            first_time_only=no

            [if]
                [have_unit]
                    side=3
                    canrecruit=yes
                [/have_unit]
            [then]
                {SPAWN_BAT $bat_tunnel_x1 $bat_tunnel_y1}
                {SPAWN_BAT $bat_tunnel_x2 $bat_tunnel_y2}
                {SPAWN_BAT $bat_tunnel_x3 $bat_tunnel_y3}
                {SPAWN_BAT $bat_tunnel_x4 $bat_tunnel_y4}

                [if]
                    [not]
                        [variable]
                            name=spawn_bat_phase
                            less_than=$spawn_bat_blood
                        [/variable]
                    [/not]
                [then]
                    {VARIABLE spawn_bat_phase 1}
                [/then]
                [else]
                    {VARIABLE_OP spawn_bat_phase add 1}
                [/else]
                [/if]
            [/then]
            [/if]

            [if]
                [variable]
                    name=missing_tentacles
                    greater_than=0
                [/variable]
                [and]
                    [have_unit]
                        side=4
                        role=Tentacle
                    [/have_unit]
                [/and]
            [then]
                [store_locations]
                    variable=spawn_tentacle
                    x=50
                    y=4
                    [filter]
                        x=50
                        y=4
                    [/filter]
                [/store_locations]

                # Naturaly it is possible to just spawn tentacle, but this method could lead to situation where tentacles would be spawned in inapriopriate places like walls and non water terrain
                [if]
                    [variable]
                        name=spawn_tentacle.x
                        equals=
                    [/variable]
                [then]
                    {PUT_TENTACLE 50 4}

                    {VARIABLE_OP missing_tentacles sub 1}
                [/then]
                [else]
                    {CLEAR_VARIABLE spawn_tentacle}
                    {VARIABLE current_radius 1}

                    [while]
                        [variable]
                            name=spawn_point.length
                            equals=0
                        [/variable]
                        [and]
                            [variable]
                                name=current_radius
                                less_than=8
                            [/variable]
                        [/and]
                    [do]
                        [store_locations]
                            variable=spawn_point
                            [and]
                                [filter]
                                    x=50
                                    y=4
                                [/filter]
                                radius=$current_radius
                            [/and]
                            # Exclude hexes with units on them and non-water terrain and flooded terain non existing in our lake
                            [and]
                                [not]
                                    [filter]
                                    [/filter]
                                [/not]
                                terrain=Wo,Ww,Chw
                            [/and]
                        [/store_locations]
                        {VARIABLE_OP current_radius add 1}
                    [/do]
                    [/while]

                    [store_locations]
                        variable=spawn_tentacle
                        x=$spawn_point.x
                        y=$spawn_point.y
                        [filter]
                            x=$spawn_point.x
                            y=$spawn_point.y
                        [/filter]
                    [/store_locations]

                    [if]
                        [variable]
                            name=spawn_tentacle.x
                            equals=
                        [/variable]
                    [then]
                        {PUT_TENTACLE $spawn_point.x $spawn_point.y}

                        {VARIABLE_OP missing_tentacles sub 1}
                    [/then]
                    [else]
                        {CLEAR_VARIABLE spawn_tentacle}
                    [/else]
                    [/if]

                    {CLEAR_VARIABLE current_radius}
                    {CLEAR_VARIABLE spawn_point}
                [/else]
                [/if]
            [/then]
            [/if]
        [/event]

        # There is really no need to check this early in a game since at this stage this event can be met only in debug mode
        [event]
            name=side 4 turn
            first_time_only=no

            [if]
                [variable]
                    name=bloodpoints
                    less_than=0
                [/variable]
                [and]
                    [have_unit]
                        side=1
                        id=Abhai
                    [/have_unit]
                [/and]
            [then]
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "How could I forget about the purpose... We can't permit traitors and thieves to triumph. We must free Knalga from them...")}
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "No Tallin this is just all wrong! You should destroy yourself not try to become a dreamer! A Mindless killer from wildest nightmares! I will stop you as I should've done when I first saw you!")}

                [store_unit]
                    [filter]
                        id=Abhai
                    [/filter]
                    variable=traitor
                    kill=yes
                [/store_unit]

                {VARIABLE traitor.side 4}

                [unstore_unit]
                    variable=traitor
                [/unstore_unit]

                {CLEAR_VARIABLE traitor}

                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Destroy it...")}
                {SPEAKER_ABYSS ( _ "With pleasure!")}
            [/then]
            [/if]
        [/event]

        [event]
            name=moveto

            [filter]
                id=Tallin
            [/filter]

            [if]
                [variable]
                    name=darkness_gaze
                    numerical_equals=1
                [/variable]
            [then]
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>Gazes into darkness...</i>)")}

                {VARIABLE current_radius 1}

                [while]
                    [variable]
                        name=spawn_point.length
                        equals=0
                    [/variable]
                [do]
                    [store_locations]
                        variable=spawn_point
                        [and]
                            [filter]
                                id=Tallin
                            [/filter]
                            radius=$current_radius
                        [/and]
                        # Exclude hexes with units on them and impassable terrain
                        [and]
                            [not]
                                [filter]
                                [/filter]
                            [/not]
                            [not]
                                terrain=Wo,*^Xm,X*,Q*
                            [/not]
                        [/and]
                    [/store_locations]
                    {VARIABLE_OP current_radius add 1}
                [/do]
                [/while]

                [unit]
                    side=1
                    id=Abyss
                    type=Ghost
                    [modifications]
                        [object]
                            silent=yes
                            duration=forever
                            [effect]
                                apply_to=attack
                                range=melee
                                increase_damage=1
                            [/effect]
                        [/object]
                    [/modifications]
                    x,y=$spawn_point.x,$spawn_point.y
                [/unit]

                {CLEAR_VARIABLE current_radius}
                {CLEAR_VARIABLE spawn_point}
                {CLEAR_VARIABLE darkness_gaze}

                {SPEAKER_GENERIC (id=Abyss) ( _ "(<i>Darkness met his gaze...</i>)")}
            [/then]
            [/if]
        [/event]
    [/event]

    [event]
        name=turn 3

        {GENERIC_UNIT 3 "Vampire Bat" 50 17}
        {GENERIC_UNIT 3 "Vampire Bat" 51 17}
        {GENERIC_UNIT 3 "Vampire Bat" 51 18}

        #ifdef NORMAL
            {GENERIC_UNIT 3 "Blood Bat" 52 17}
        #endif

        #ifdef HARD
            {GENERIC_UNIT 3 "Vampire Bat" 52 16}
            {GENERIC_UNIT 3 "Blood Bat" 52 17}
        #endif

        #ifdef NIGHTMARE
            {GENERIC_UNIT 3 "Blood Bat" 52 16}
            {GENERIC_UNIT 3 "Blood Bat" 52 17}
        #endif
    [/event]

    {TREASON_SPEAK 25 ( _ "There is a traitor among us...")}
    {TREASON_SPEAK 45 ( _ "He desires your destruction...")}
    {TREASON_SPEAK 60 ( _ "Do not allow him to hide in your shadow...")}
    {TREASON_SPEAK 80 ( _ "Send him away... He can not be trusted...")}

    [event]
        name=prerecruit
        first_time_only=no

        [filter]
            side=5
        [/filter]

        [if]
            [variable]
                name=missing_dancers
                greater_than=0
            [/variable]
        [then]
            [role]
                id=$unit.id
                role=Runic Blade Dancer
            [/role]
            [object]
                silent=yes
                duration=scenario
                [filter]
                    id=$unit.id
                [/filter]
                [effect]
                    apply_to=attack
                    range=melee
                    set_type=arcane
                [/effect]
            [/object]

            {VARIABLE_OP missing_dancers sub 1}
        [/then]
        [/if]
    [/event]

    {DRAKE_LAIR 2 0 3 11}
    {DRAKE_LAIR 2 0 3 16}
    {DRAKE_LAIR 7 1 13 19}
    {DRAKE_LAIR 7 1 18 19}

    {LEADER_DEATH ( _ "Death is mine... At last...")}

    [event]
        # Unfortunately sighted event is not reliable so it's safer to back it up with moveto event
        name=sighted

        [filter]
            race=naga
        [/filter]

        {DANCER_SPEAK}
    [/event]

    [event]
        name=moveto
   
        [filter]
            side=1
      
            [filter_location]
                [filter]
                    id=Runic Blade Guard 1
                [/filter]
         
                radius=4
            [/filter_location]
       [/filter]

       {DANCER_SPEAK}
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            [not]
                type=Ghost,Wraith,Spectre,Shadow,Nightgaunt,Skeleton,Deathblade,Revenant,Draug,Death Knight,Skeleton Archer,Bone Shooter,Banebow,Lich,Skeleton NR,Revenant NR
            [/not]
            x=31-34,35-37,38,39-40,41
            y=12-22,10-24,10-22,11-22,13-22
        [/filter]

        {ASSEMBLE_RUNIC_BLADE_DANCERS}
    [/event]

    # This is separated to another event just to reduce trigger and run tactic using ghosts
    [event]
        name=moveto
        [filter]
            side=1
            type=Ghost,Wraith,Spectre
            x=31-34,35-37,38,39-40,41
            y=12-22,10-24,10-22,11-22,13-15
        [/filter]

        {ASSEMBLE_RUNIC_BLADE_DANCERS}
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            type=Skeleton,Deathblade,Revenant,Draug,Death Knight,Skeleton Archer,Bone Shooter,Banebow,Lich,Skeleton NR,Revenant NR
            x=31-32,33,33,34,35,36,36,37,37,37,37,38,38,39,39,39,40,40,40,41
            y=12-22,13,15-22,12-22,11-24,10-15,20-21,11-14,17,20-21,23,10-14,19-22,11-13,16,19-22,11-12,15,19-21,19-22
        [/filter]

        {ASSEMBLE_RUNIC_BLADE_DANCERS}
    [/event]

    [event]
        name=attack

        [filter]
            side=1
            type=Shadow,Nightgaunt,Skeleton,Deathblade,Revenant,Draug,Death Knight,Skeleton Archer,Bone Shooter,Banebow,Lich,Skeleton NR,Revenant NR
            x=31-34,35-37,38,39-40,41
            y=12-22,10-24,10-22,11-22,13-22
        [/filter]

        {ASSEMBLE_RUNIC_BLADE_DANCERS}
    [/event]

    [event]
        name=attack
        [filter_second]
            side=1
            type=Shadow,Nightgaunt,Skeleton,Deathblade,Revenant,Draug,Death Knight,Skeleton Archer,Bone Shooter,Banebow,Lich,Skeleton NR,Revenant NR
            x=31-34,35-37,38,39-40,41
            y=12-22,10-24,10-22,11-22,13-22
        [/filter_second]

        {ASSEMBLE_RUNIC_BLADE_DANCERS}
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=44,45,42,43-44,43,40-42,44,46,41-47,43,45-47
            y=26,27,27-28,27-28,29,29-30,30,30,31,32,32
        [/filter]

        {FOUND_INFORMATION unit}

        [if]
            [variable]
                name=unit.id
                equals=Tallin
            [/variable]
            [or]
                [variable]
                    name=unit.id
                    equals=Abhai
                [/variable]
            [/or]
        [then]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Hmm... I sense power, it seems to be radiating from that direction.")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Yes I sense I too, it seemed to be radiating from that direction.")}
        [/else]
        [/if]

        [redraw]
            side=1
        [/redraw]

        {SCROLL_TO 44 31}
        [delay]
            time=800
        [/delay]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "It's similar to us, familiar, friendly.")}

        [if]
            [have_unit]
                side=1
                id=Abhai
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Abhai) ( _ "I doubt it's the rod... But it would be wise to check it out. However I advise to proceed with caution. Maybe it's some dark sorceror?")}
            {SPEAKER_WHISPER ( _ "Lord as you hear this despicable creature is overusing your benevolence. How dare it form sentences without your approval?")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Lets find out if it is a master in death! (<i>Laugh</i>)")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Maybe it's some dark sorceror? Lets find out whether it is a master in death! (<i>Laugh</i>)")}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=48-50,54,48-51,44-59,42-59,45-59
            y=33,33,34,35-37,38-40,41-48
        [/filter]

        {GENERIC_UNIT 4 "Giant Spider" 54 33}
        {GENERIC_UNIT 4 "Giant Spider" 44 35}
        {GENERIC_UNIT 4 "Giant Spider" 57 35}
        {GENERIC_UNIT 4 "Giant Spider" 42 38}
        {GENERIC_UNIT 4 "Giant Spider" 57 40}
        {GENERIC_UNIT 4 "Giant Spider" 46 44}
        {GENERIC_UNIT 4 "Giant Spider" 54 45}
        {GENERIC_UNIT 4 "Giant Spider" 45 46}

        [sound]
            name=hiss-big.wav
        [/sound]
        # wmllint: no spellcheck
        {SPEAKER_GENERIC (type=Giant Spider) ( _ "HISSSS")}
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=51
            y=39
            race=bats
        [/filter]

        [if]
            [variable]
                name=found_amulet
                less_than=1
            [/variable]
        [then]
            {FOUND_INFORMATION unit}
            {VARIABLE found_amulet 1}

            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Some magic item...")}
        [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=1
            x=51
            y=39
            [not]
                race=bats
            [/not]
        [/filter]

        [if]
            [variable]
                name=found_amulet
                less_than=1
            [/variable]
        [then]
            {FOUND_INFORMATION unit}
        [/then]
        [/if]

        [if]
            [variable]
                name=icy_tear_taken
                not_equals=1
            [/variable]
        [then]
            [if]
                [variable]
                    name=unit.race
                    not_equals=undead
                [/variable]
            [then]
                [message]
                    speaker=narrator
                    caption= _ "Icy Tear"
                    image=items/ankh-necklace.png
                    message= _ "<span color='#fff21f'>Properties: 
+3 melee damage, +8 hitpoints, 30 fire resistance, 20 arcane resistance 
Special: 
Only for undead</span>"
                [/message]

                [if]
                    [variable]
                        name=found_amulet
                        greater_than=0
                    [/variable]
                [then]
                    [allow_undo][/allow_undo]
                [/then]
                [else]
                    {VARIABLE found_amulet 1}
                [/else]
                [/if]
            [/then]
            [else]
                [message]
                    speaker=narrator
                    caption= _ "Icy Tear"
                    image=items/ankh-necklace.png
                    message= _ "<span color='#fff21f'>Properties: 
+3 melee damage, +8 hitpoints, 30 fire resistance, 20 arcane resistance 
Special: 
Only for undead</span> 

Should this unit use Icy Tear?"
                    [option]
                        message= _ "(<i>Take it</i>)"
                        [command]
                            {VARIABLE found_amulet 1}

                            [if]
                                [variable]
                                    name=unit.id
                                    equals=Tallin
                                [/variable]
                            [then]
                                {SPEAKER_GENERIC (speaker=Tallin) ( _ "It's a powerful artifact, but since I will be the one who will touch the Rod this item surely will be destroyed along with me.")}
                                [message]
                                    speaker=narrator
                                    caption= _ "Icy Tear"
                                    image=items/ankh-necklace.png
                                    message= _ "Tallin can use this item only to the end of this level!"
                                    [option]
                                        message= _ "(<i>Take it</i>)"
                                        [command]
                                            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Let it perish with me.")}
                                            {VARIABLE icy_tear_taken 1}
                                        [/command]
                                    [/option]
                                    [option]
                                        message= _ "(<i>Leave it</i>)"
                                        [command]
                                            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Nah... It will be better if someone from my troops will take it.")}
                                        [/command]
                                    [/option]
                                [/message]
                            [/then]
                            [else]
                                {VARIABLE icy_tear_taken 1}
                            [/else]
                            [/if]

                            [if]
                                [variable]
                                    name=icy_tear_taken
                                    numerical_equals=1
                                [/variable]
                            [then]
                                [remove_item]
                                    x=51
                                    y=39
                                [/remove_item]

                                [object]
                                    id=icy_tear
                                    name= _ "Icy Tear"
                                    image=attacks/iceball.png
                                    duration=forever
                                    description= _ "Attached to the simple silver neck chain there is strange tear shaped gem in color of ice. However it's impossible to recognize what kind of gem it is. Nevertheless, it undeniably grants great power to any undead being that will wear it."
                                    [filter]
                                        id=$unit.id
                                    [/filter]
                                    [effect]
                                        apply_to=attack
                                        range=melee
                                        increase_damage=3
                                    [/effect]
                                    [effect]
                                        apply_to=hitpoints
                                        increase_total=8
                                        heal_full=yes
                                    [/effect]
                                    [effect]
                                        apply_to=resistance
                                        replace=true
                                        [resistance]
                                            fire=70
                                            arcane=80
                                        [/resistance]
                                    [/effect]
                                [/object]

                                {SPEAKER_ART ( _ "My lord. About this item only legends were whispered among the wesfolk. They said that once was a lord of the green isle that wanted to increase his domain. He invaded the lands of the wesfolk. When he took over the power there, he formed an army using local men and sent them to war, simply to get rid off any possible trouble makers. At the manor of this new ruler of the land came a mother to ask him to return her only son. Unfortunately he was already killed in one of the countless battles so officials crudely told her off...")}
                                {SPEAKER_ART ( _ "So she went away. However her despair after her son's loss was so great that her son returned. According to this legend he wiped her tears from her cheek. One of them froze under his cold touch. So he used it as an amulet and moved to get rid of the foul invaders. No one could stop him. The common folk like this kind of ridiculous story... Ah my lord if creating such an artifact would be as simple as making some old women cry we already would rule all the world.")}
                            [/then]
                            [/if]
                        [/command]
                    [/option]
                    [option]
                        message= _ "(<i>Leave it</i>)"
                        [command]
                            [if]
                                [variable]
                                    name=found_amulet
                                    greater_than=0
                                [/variable]
                            [then]
                                [allow_undo][/allow_undo]
                            [/then]
                            [else]
                                {VARIABLE found_amulet 1}
                            [/else]
                            [/if]
                        [/command]
                    [/option]
                [/message]
            [/else]
            [/if]
        [/then]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=36-37,34-37,38,38-40,36-37,31-35,31
            y=34,35-38,31,35-37,39-40,40-45,46
        [/filter]

        [redraw]
            side=1
        [/redraw]

        [if]
            [not]
                [have_unit]
                    x=36
                    y=35
                [/have_unit]
            [/not]
        [then]
            {GENERIC_UNIT 6 "Troll Whelp" 36 35}
        [/then]
        [else]
            {GENERIC_UNIT 6 "Troll Whelp" 34 38}
        [/else]
        [/if]

        [if]
            [not]
                [have_unit]
                    x=38
                    y=35
                [/have_unit]
            [/not]
        [then]
            {GENERIC_UNIT 6 "Troll Whelp" 38 35}
        [/then]
        [else]
            {GENERIC_UNIT 6 "Troll Whelp" 40 36}
        [/else]
        [/if]

        [unit]
            side=6
            type=Troll
            x=39
            y=37
            id=Troll
        [/unit]

        {SPEAKER_GENERIC (id=Troll) ( _ "Bah! Dead in our cave. Alert chief!")}

        [modify_side]
            side=6
            {GOLD4 250 300 375 450}
        [/modify_side]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=34-43,33,31-32,28-30
            y=1-8,7-10,8-10,9-12
        [/filter]

        [if]
            [variable]
                name=dwarven_encounter
                less_than=2
            [/variable]
        [then]
            {DWARVEN_ENCOUNTER}
        [/then]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=16-19,20-24,25-26
            y=30-36,30-35,30-33
        [/filter]

        [if]
            [variable]
                name=dwarven_encounter
                less_than=2
            [/variable]
        [then]
            {VARIABLE dwarven_encounter 1}
            {DWARVEN_ENCOUNTER}
        [/then]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=1-6,7-11,12,17-23,24,25
            y=24-26,22-26,20-25,22-28,22-26,24-26
        [/filter]

        {FOUND_INFORMATION unit}

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "There is a lot of holes in the cave roof. At day time some places might be illuminated, but it really doesn't matter as long as we will complete the purpose fast...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "However more important is that we have arrived at the drakes' domain...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "I feel the warmth of new life... It seems to be concentrated in these points...")}
        [remove_shroud]
            side=1
            x=2,3-4,2,3-4,12,13-14,17-18,19
            y=10,11,15,16,18,19,19,20
        [/remove_shroud]
        [redraw]
            side=1
        [/redraw]
        {SCROLL_TO 4 13}
        [delay]
            time=1000
        [/delay]
        {SCROLL_TO 16 19}
        [delay]
            time=1000
        [/delay]
        {SPEAKER_ABYSS ( _ "My lord. These are drake nests. They are the source of power for those ill-natured creatures. If you destroy them they will be unable to replace their looses quickly enough to defend themselves. As you can feel my lord at this moment they started gathering forces to stop you.")}
        [if]
            [have_unit]
                side=1
                id=Abhai
            [/have_unit]
        [then]
            # Only Tallin can hear whisper so any other character then him should react as it wouldn't hear it if no one speaks loudly.
            [if]
                {DO_SPEAK_ABYSS_LOUD}
            [then]
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "Tallin do not even consider such a plan! If we will stop killing their guards the effect will be similar.")}
            [/then]
            [else]
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "Tallin these are possibly drake nests! There is no point in destroying them! If we will stop killing their guards the effect will be similar.")}
            [/else]
            [/if]
        [/then]
        [/if]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Agreed... (<i>Laugh</i>)")}
        [message]
            speaker=narrator
            message= _ "Capture a village to destroy a drake nest. The destruction of each drake nest will reduce the income of the drakes by 31 gold pieces and will cost you one point of blood.

<span color='#ff0000'>Remaining points of blood: $bloodpoints</span>"
            image=wesnoth-icon.png
        [/message]

        {ASSEMBLE_ARMY 7 "Drake Clasher,Drake Burner,Drake Fighter" 300 350 400 450}
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=12-14,15,16-22,23-24,25-27
            y=8-13,8-15,1-16,2-13,2-10
        [/filter]

        {FOUND_INFORMATION unit}

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Yes it seems as if this is a lair of the dragon... I sense its life force...")}

        [if]
            [have_unit]
                side=1
                id=Abhai
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Abhai) ( _ "You are right. I feel that the Rod of Justice is extremely close now.")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "And something more... The purpose... The Rod...")}
        [/else]
        [/if]

        {ASSEMBLE_ARMY 2 "Fire Drake,Drake Flare,Drake Warrior" 0 50 100 150}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=$bat_tunnels_x
            y=$bat_tunnels_y
        [/filter]

        {FOUND_INFORMATION unit}

        #This information is valuable only if player didn't handle annoying flayers problem yet
        [if]
            [have_unit]
                side=3
                canrecruit=yes
            [/have_unit]
        [then]
            # Abhai is ordinary loyal unit so he can be destroyed but if he is around he is used to say something instead of Tallin
            [if]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [then]
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "It's just a dead end. There are a lot of small cracks in the walls and roof that the bats use to get there. Unfortunately we can't do much about it except using some of our forces to block the passage...")}
            [/then]
            [else]
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "A Blind end with a lot of small cracks in the walls and roof that those creatures use to get here... Unfortunately we can't do much about it right now except leaving someone here to block the passage...")}
            [/else]
            [/if]

            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Unless we find their source...")}
        [/then]
        [else]
            [if]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [then]
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "It's just a dead end. Nothing interesting there.")}
            [/then]
            [else]
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Yes, nice dead end. Nothing interesting there...")}
            [/else]
            [/if]
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=1-6
            y=4-8
        [/filter]

        {FOUND_INFORMATION unit}

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Yes, it seemed this passage leads to the surface...")}

        [if]
            [have_unit]
                side=1
                id=Abhai
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Abhai) ( _ "But we do not seek the surface, we seek the Rod of Justice. I see no gain from exploring this passage any further.")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "But only the purpose is important and we need that little item to fulfill it...")}
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
   
        [filter]
            side=1
      
            [filter_location]
                [filter]
                    id=Adart'han
                [/filter]
         
                radius=3
            [/filter_location]
      
            [or]
                id=Adart'han
      
                [filter_location]
                    [filter]
                        side=1
                    [/filter]
            
                    radius=3
                [/filter_location]
            [/or]
       [/filter]

       {DRAGON_SPEAK}
    [/event]

    [event]
        name=sighted

        [filter]
            id=Adart'han
        [/filter]

        {DRAGON_SPEAK}
    [/event]

    # This is to not get lich with Necromancer role
    {UPDATE_ROLE_LICH}

    {LEADER_EXPERIENCE_DEAD}

    [event]
        name=last breath

        [filter]
            side=4
            id=Hekkna
        [/filter]

        [if]
            [have_unit]
                side=4
                id=Haffel
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Haffel) ( _ "Hekkna! No!... I will smash your bones into pieces rottie!!! You hear!!!")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=unit) ( _ "Oh... Why do heroes have no luck... Only drunkards...")}
        [/else]
        [/if]
    [/event]

    [event]
        name=last breath

        [filter]
            side=4
            id=Haffel
        [/filter]

        [if]
            [have_unit]
                side=4
                id=Hekkna
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Hekkna) ( _ "Haffel! No!... Now ye will see from what a real dwarf is made of!!!")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=unit) ( _ "Oh... Why do heroes have no luck... Only drunkards...")}
        [/else]
        [/if]
    [/event]

    [event]
        name=last breath

        [filter]
            side=2
            canrecruit=yes
        [/filter]

        {SPEAKER_GENERIC (speaker=Adart'han) ( _ "How can it be?... Killed by nameless remains...")}
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            id=Tallin
            x=30
            y=3
        [/filter]

        # Since Tallin is so obsessed with a purpose he can take the rod only if dragon is dead and his score in point of blood is not negative
        [if]
            [have_unit]
                side=1
                id=Abhai
            [/have_unit]
            [and]
                [variable]
                    name=bloodpoints
                    less_than=0
                [/variable]
            [/and]
        [then]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "No... It's just to simple... I can't just take it... The ill-natured will certainly start to act...")}
        [/then]
        [/if]

        [if]
            [not]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [/not]
            [and]
                [variable]
                    name=bloodpoints
                    less_than=0
                [/variable]
            [/and]
        [then]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Before I will take it we have to bring justice to that traitor...")}
        [/then]
        [/if]

        [if]
            [have_unit]
                side=2
                canrecruit=yes
            [/have_unit]
            [and]
                [variable]
                    name=bloodpoints
                    greater_than=-1
                [/variable]
            [/and]
        [then]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Dragon must be exterminated... because the purpose is the most important...")}
        [/then]
        [/if]

        [if]
            [not]
                [have_unit]
                    side=2
                    canrecruit=yes
                [/have_unit]
            [/not]
            [and]
                [variable]
                    name=bloodpoints
                    greater_than=-1
                [/variable]
            [/and]
        [then]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>He moved his hand to pick the rod then he hesitate.</i>)")}
            {SPEAKER_ABYSS ( _ "Lord do not touch this item. It is evil, harmful. It was created by powers that hate us and would glad to get rid of us. You can't allow to be destroyed by it. With you all hope for the north will perish!")}
            {SPEAKER_ABYSS ( _ "You do not need this gewgaw to accomplish your most noble mission. You must campaign against crime, deception and evil. We, the true executors of your will, will carry your word far and wide.")}
            {SPEAKER_ABYSS ( _ "Do not reject this power. You can not only save all the north, but the whole continent or even more... Because of your honorable character that couldn't be broken, you as an eternal ruler will ensure peace, harmony and justice - above all. Wiping out all ill-natured. Your rules will be so perfect that no one will be able to say or even think something against it. This will be an age of silence.")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "I do not doubt that... However the purpose is more important... The rod will fulfill it.")}

            [if]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [then]
                {SPEAKER_ABYSS ( _ "As you command... My lord... At least let us get rid of the traitor. Do not allow him to harvest the fruits of his poisoning thoughts.")}

                [if]
                    {DO_SPEAK_ABYSS_LOUD}
                [then]
                    {SPEAKER_GENERIC (speaker=Abhai) ( _ "I did not betray anyone.")}
                    {SPEAKER_ABYSS ( _ "You've heard, my lord! You've waited enough. It's high time to act! Let us feast on the essence of this scum...")}
                [/then]
                [else]
                    {SPEAKER_ABYSS ( _ "Let us feast on the essence of this scum...")}
                [/else]
                [/if]

                {SPEAKER_GENERIC (speaker=Tallin) ( _ "No...")}
            [/then]
            [/if]

            {SPEAKER_ABYSS ( _ "My lord... You know that no thoughts trouble us that do not belonging to you.")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Yes, and the only thing that counts is... The Purpose... (<i>He takes the rod slowly</i>)")}

            [sound]
                name=lich-hit-1.ogg
            [/sound]
            [delay]
                time=100
            [/delay]

            [store_unit]
                [filter]
                    id=Tallin
                [/filter]
                variable=hero
                kill=yes
            [/store_unit]

            [if]
                [variable]
                    name=level_max
                    greater_than=0
                [/variable]
            [then]
                {VARIABLE level_total $level_max}

                [if]
                    [variable]
                        name=level_toughness
                        greater_than=0
                    [/variable]
                [then]
                    {VARIABLE_OP level_total add $level_toughness}
                [/then]
                [/if]
            [/then]
            [else]
                {VARIABLE level_total $hero.level}
            [/else]
            [/if]

            {VARIABLE_OP hero.experience divide $hero.max_experience}

            [if]
                [variable]
                    name=level_total
                    less_than=2
                [/variable]
            [then]
                {VARIABLE leader "Sergeant"}
                {VARIABLE_OP hero.experience multiply 26}
            [/then]
            [/if]

            [if]
                [variable]
                    name=level_total
                    numerical_equals=2
                [/variable]
            [then]
                {VARIABLE leader "Lieutenant"}
                {VARIABLE_OP hero.experience multiply 64}
            [/then]
            [/if]

            [if]
                [variable]
                    name=level_total
                    numerical_equals=3
                [/variable]
            [then]
                {VARIABLE leader "General"}
                {VARIABLE_OP hero.experience multiply 144}
            [/then]
            [/if]

            [if]
                [variable]
                    name=level_total
                    greater_than=3
                [/variable]
            [then]
                {VARIABLE leader "Grand Marshal"}
                {VARIABLE_OP hero.experience multiply 160}
            [/then]
            [/if]

            [remove_item]
                x=$hero.x
                y=$hero.y
            [/remove_item]

            {PLACE_IMAGE items/gold-coins-medium.png $hero.x $hero.y}

            {UNIT 1 $leader $hero.x $hero.y (
                id=Tallin
                name= _ "Tallin"
                experience=$hero.experience
                canrecruit=yes
                unrenamable=yes
                profile=portraits/Tallin.png
                [modifications]
                    {TRAIT_FEARLESS}
                    {TRAIT_RESILIENT}
                    {ROD_OF_JUSTICE Tallin yes}
                    [object]
                        silent=yes
                        duration=scenario
                        [effect]
                            apply_to=new_animation

	                        [extra_anim]
		                        flag=resurrection

                                halo_auto_vflip=false
                                [halo_frame]
                                    duration=730
                                    halo="halo/holy/light-beam-[1~7,6~1].png:[30*6,130,70*6]"
                                [/halo_frame]
                            [/extra_anim]
                        [/effect]
                    [/object]
                [/modifications]
            )}

            {TEAM_COLOR_OVERRIDE id=Tallin black}

            [sound]
                name=magic-holy-1.ogg
            [/sound]
            {ANIMATE_UNIT Tallin resurrection ()}

            # Clear variables used for character convertion
            {CLEAR_LEADER_LEVEL}
            {CLEAR_VARIABLE level_total}
            {CLEAR_VARIABLE hero}
            {CLEAR_VARIABLE leader}

            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Damn!")}

            [if]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [then]
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "What happened!")}
            [/then]
            [/if]

            {SPEAKER_GENERIC (speaker=Tallin) ( _ "I've cut myself! This item must have some sharp edges. I didn't get hurt for along time...")}

            [if]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [then]
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "Tallin you are alive! Don't you see! You did it!")}
            [/then]
            [else]
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Oh damn it! I'm alive...")}

                # When you go out from river you can't hear fishes unless they speak loud... So Tallin will have to
                [if]
                    {DO_SPEAK_ABYSS_LOUD}
                [then]
                    {SPEAKER_ABYSS ( _ "My lord. You did it! You have struggled with the powers of this item! You are weakened but you have won!")}
                [/then]
                [/if]
            [/else]
            [/if]

            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Yeah... Unfortunately...")}

            [if]
                [not]
                    [have_unit]
                        side=1
                        id=Abhai
                    [/have_unit]
                [/not]
                [and]
                    [not]
                        [have_unit]
                            side=1
                            role=Trailer
                        [/have_unit]
                    [/not]
                [/and]
                [and]
                    [not]
                        [have_unit]
                            side=1
                            role=Dreamer
                        [/have_unit]
                    [/not]
                [/and]
            [then]
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>Gazes into darkness</i>)")}
            [/then]
            [/if]

            [if]
                [not]
                    [have_unit]
                        side=1
                        id=Abhai
                    [/have_unit]
                [/not]
            [then]
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "And besides that not much has changed. The curse is with me even now. Although a bit different. I see part of me in you and part of you in me. But who or what am I? Yes you know, so I grudge you this certainty.")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Surely I will never learn whether the gods did this or the item itself? Is it proof of my innocence or is it my punishment?")}
            [/then]
            [/if]

            [if]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [then]
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "Why you do seem to not be pleased by this fact? Do you not understand? The gods themselves declare that you are innocent!")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Oh really? Then something must be wrong with my perception because I didn't notice it. Or maybe they declared it to you? Or them?")}
                {SPEAKER_GENERIC (speaker=Abhai) ( _ "Oh come on! And your talent?")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>Shudders</i>) I feel it different but it is all mine...")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "So maybe it's just the item that did this. Or maybe its just a sort of punishment to face the consequences of all I did rather than escape them.")}
            [/then]
            [/if]

            # Clear level variables
            {CLEAR_VARIABLE missing_tentacles}
            {CLEAR_VARIABLE missing_dancers}
            {CLEAR_VARIABLE spawn_bat}
            {CLEAR_VARIABLE spawn_bat_phase}
            {CLEAR_VARIABLE spawn_bat_blood}
            {CLEAR_VARIABLE spawn_bat_max}
            {CLEAR_VARIABLE light_source}
            {CLEAR_VARIABLE drake_lair}
            {CLEAR_VARIABLE found_amulet}
            {CLEAR_VARIABLE icy_tear_taken}
            {CLEAR_VARIABLE naga_dancers_assembled}
            {CLEAR_VARIABLE warning_traitor}
            {CLEAR_VARIABLE bloodpoints}
            {CLEAR_VARIABLE bloodpoints_low}
            {CLEAR_VARIABLE dwarven_encounter}
            {CLEAR_VARIABLE killed_guards}
            {CLEAR_VARIABLE dragon_speak}
            {CLEAR_VARIABLE dancer_speak}
            {CLEAR_VARIABLE abyss_whisper}

            {CLEAR_VARIABLE bat_leader_x}
            {CLEAR_VARIABLE bat_leader_y}
            {CLEAR_VARIABLE bat_tunnel_x1}
            {CLEAR_VARIABLE bat_tunnel_y1}
            {CLEAR_VARIABLE bat_tunnel_x2}
            {CLEAR_VARIABLE bat_tunnel_y2}
            {CLEAR_VARIABLE bat_tunnel_x3}
            {CLEAR_VARIABLE bat_tunnel_y3}
            {CLEAR_VARIABLE bat_tunnel_x4}
            {CLEAR_VARIABLE bat_tunnel_y4}
            {CLEAR_VARIABLE bat_tunnels_x}
            {CLEAR_VARIABLE bat_tunnels_y}
            {CLEAR_VARIABLE tunnel_walls_x}
            {CLEAR_VARIABLE tunnel_walls_y}
            {CLEAR_VARIABLE cavern_shape}

            # Clear role since they are scenario wide not game wide
            {CLEAR_ROLE_ART}
            {CLEAR_ROLE_ABYSS}

            [set_menu_item]
                id=08b_help
                [show_if]
                    [not]
                    [/not]
                [/show_if]
            [/set_menu_item]

            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Nevertheless it's done. But we did not finish here yet. Since the gods sentence was not so gracious, let us find out what those who claim that control powers beyond this world can say on this matter.")}

            {VICTORY_BONUS_DEFAULT no}
        [/then]
        [/if]
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            role=Tentacle
        [/filter]

        {VARIABLE_OP missing_tentacles add 1}
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            role=Vile Flayer
        [/filter]

        {VARIABLE_OP spawn_bat sub 1}
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            role=Drake Domain Guard
        [/filter]

        [if]
            [variable]
                name=killed_guards
                less_than=4
            [/variable]
        [then]
            [if]
                [variable]
                    name=killed_guards
                    numerical_equals=3
                [/variable]
            [then]
                {FOUND_INFORMATION second_unit}
                {FOUND_GOLD second_unit small 117}

                {VARIABLE killed_guards 4}
            [/then]
            [/if]

            [if]
                [variable]
                    name=killed_guards
                    numerical_equals=2
                [/variable]
            [then]
                {FOUND_INFORMATION second_unit}
                {FOUND_GOLD second_unit small 81}

                {VARIABLE killed_guards 3}
            [/then]
            [/if]

            [if]
                [variable]
                    name=killed_guards
                    numerical_equals=1
                [/variable]
            [then]
                {FOUND_INFORMATION second_unit}
                {FOUND_GOLD second_unit small 57}

                {VARIABLE killed_guards 2}
            [/then]
            [/if]

            [if]
                [variable]
                    name=killed_guards
                    less_than=1
                [/variable]
            [then]
                {FOUND_INFORMATION second_unit}
                {FOUND_GOLD second_unit small 45}

                {VARIABLE killed_guards 1}
            [/then]
            [/if]
        [/then]
        [/if]
    [/event]

    [event]
        name=die

        [filter]
            side=2
            canrecruit=yes
        [/filter]

        {FOUND_INFORMATION second_unit}
        {FOUND_GOLD second_unit large 1187}

        [if]
            [have_unit]
                side=3
                canrecruit=yes
            [/have_unit]
        [then]
            {FOUND_FLAYER unit}
        [/then]
        [/if]

        [if]
            [have_unit]
                side=1
                id=Abhai
            [/have_unit]
            [and]
                [variable]
                    name=bloodpoints
                    greater_than=-1
                [/variable]
            [/and]
        [then]
            {SPEAKER_GENERIC (speaker=Abhai) ( _ "Tallin! You did it! The Rod of Justice is yours! I am sure that you can find it among the treasures in the dragon's lair.")}
        [/then]
        [else]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Ah... The rod of Justice is among the treasures in the dragon's lair... I will handle it...")}
        [/else]
        [/if]
    [/event]

    [event]
        name=die

        [filter]
            side=3
            canrecruit=yes
        [/filter]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Those little vermin shouldn't trouble us any more.")}

        {FOUND_INFORMATION second_unit}
        {FOUND_GOLD second_unit medium 223}

        [if]
            [have_unit]
                side=2
                canrecruit=yes
            [/have_unit]
        [then]
            {FOUND_FLAYER unit}
        [/then]
        [/if]

        {VARIABLE_OP bloodpoints sub 1}
        {VICTIMS_UPDATE}
        {VICTIMS_EFFECT}
    [/event]

    [event]
        name=die

        [filter]
            side=4
            id=Abhai
        [/filter]

        [message]
            speaker=narrator
            message= _ "When the traitor was finally destroyed, Tallin could felt his suffering, sadness and even... Compassion for him."
            image=misc/empty.png
        [/message]

        {VARIABLE_OP bloodpoints add 1}
        {VICTIMS_UPDATE}
        {VICTIMS_EFFECT}
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            side=4
            race=dwarf
        [/filter]

        [if]
            [not]
               [have_unit]
                   side=4
                   race=dwarf
                   [not]
                       id=$unit.id
                   [/not]
                [/have_unit]
            [/not]
            [and]
                [variable]
                    name=dwarven_encounter
                    numerical_equals=2
                [/variable]
            [/and]
            [and]
                [have_unit]
                    side=1
                    id=Abhai
                [/have_unit]
            [/and]
        [then]
            {SPEAKER_GENERIC (speaker=Abhai) ( _ "I think you really should hone your diplomacy skills...")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Nah... They are sharp enough... They looked totally convinced to me...")}

            {VARIABLE dwarven_encounter 3}
        [/then]
        [/if]
    [/event]

    [event]
        name=die

        [filter]
            side=5
            canrecruit=yes
        [/filter]

        {FOUND_INFORMATION second_unit}
        {FOUND_GOLD second_unit medium 328}

        {VARIABLE_OP bloodpoints sub 1}
        {VICTIMS_UPDATE}
        {VICTIMS_EFFECT}
    [/event]

    [event]
        name=die

        [filter]
            side=6
            canrecruit=yes
        [/filter]

        {FOUND_INFORMATION second_unit}
        {FOUND_GOLD second_unit large 419}

        {VARIABLE_OP bloodpoints sub 1}
        {VICTIMS_UPDATE}
        {VICTIMS_EFFECT}
    [/event]

    [event]
        name=die

        [filter]
            side=7
            canrecruit=yes
        [/filter]

        {FOUND_INFORMATION second_unit}
        {FOUND_GOLD second_unit medium 301}

        {VARIABLE_OP bloodpoints sub 1}
        {VICTIMS_UPDATE}
        {VICTIMS_EFFECT}
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            role=Runic Blade Dancer
        [/filter]

        #ifdef NORMAL
            # This means that player need to kill both dancers at a time since ai can recruit one dancer dempendless of this it has one or none of them at all
            {VARIABLE missing_dancers 1}
        #endif

        #ifdef HARD
            {VARIABLE_OP missing_dancers add 1}
        #endif

        #ifdef NIGHTMARE
            {VARIABLE_OP missing_dancers add 1}
        #endif
    [/event]

    #undef DRAGON_SPEAK
    #undef DANCER_SPEAK
    #undef TREASON_SPEAK
    #undef VICTIMS_ABOUT
    #undef PUT_TENTACLE
    #undef PUT_GUARDIAN
    #undef PUT_RUNIC_BLADE_GUARD
    #undef SPAWN_BAT
    #undef FOUND_GOLD
    #undef FOUND_FLAYER
    #undef VICTIMS_UPDATE
    #undef DRAKE_LAIR
    #undef ASSEMBLE_ARMY
    #undef DWARVEN_ENCOUNTER
[/scenario]
