#textdomain wesnoth-Northern_Rebirth_Remake

[scenario]
    id=07b_Weight_of_Revenge
    name= _ "Weight of Revenge"

    {SCENARIO_MUSIC "into_the_shadows.ogg"}
    {EXTRA_SCENARIO_MUSIC "the_king_is_dead.ogg"}
    {EXTRA_SCENARIO_MUSIC "weight_of_revenge.ogg"}

    {UNDERGROUND}
    turns=21
    next_scenario=08b_Song_of_Blood

    [story]
        [part]
            story= _ "When it was done Tallin's mind was drowning in an ocean of sorrows which soon fermented and lit a fire of pure hate that could only be suppressed in a sea of blood. Burning all his thoughts to ashes of madness."
        [/part]
        [part]
            story= _ "However, the will that pushed him to this point caught his attention. It was an urgent call to return, a strange experience... as if... his master was aghast of something."
        [/part]
        [part]
            story= _ "Tallin returned fast. Led by a sweet song of blood promising that a few drops would cool down his thoughts and allow him to rest... for a while. When he arrived Malifor was besieged in one of his side keeps."
        [/part]
    [/story]

    map_data="{~add-ons/Northern_Rebirth_Remake/maps/07b_Weight_of_Revenge.map}"

    #define PUT_GUARDIAN SIDE TYPE X Y
        [unit]
            type={TYPE}
            x={X}
            y={Y}
            side={SIDE}
            ai_special=guardian
        [/unit]
    #enddef

    #define PUT_KNALGAN_GUARD TYPE X Y
        [unit]
            type={TYPE}
            role=Guard
            [modifications]
                [object]
                    silent=yes
                    # Do not ever use replace if you want to have easy way to get back original state
                    [effect]
                        apply_to=movement_costs 
                        replace=false
                        [movement_costs]
                            flat=30
                        [/movement_costs]
                    [/effect]
                [/object]
            [/modifications]
            x={X}
            y={Y}
            side=3
        [/unit]
    #enddef

    #define CAMERIN_DEAD TRUE FALSE
        [if]
            [variable]
                name=camerin_dead
                numerical_equals=1
            [/variable]
        [then]
            {TRUE}
        [/then]
        [else]
            {FALSE}
        [/else]
        [/if]
    #enddef

    #define KNALGAN_REINFORCEMENTS
        [if]
            [variable]
                name=reinforcements
                less_than=1
            [/variable]
        [then]
            {CAMERIN_DEAD (
                {SPEAKER_GENERIC (speaker=Rhodry) ( _ "No, Tallin. I just can't allow myself to be defeated by an empty skulled menace like you...")}
            ) (
                {SPEAKER_GENERIC (speaker=Camerin) ( _ "No, Tallin. I just can't allow myself to be defeated by an empty skulled menace like you. Burn!")}
            )}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Always those empty promises!...")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "You claim to be my friends!... But you came here... and just beg...")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Stop!... Stop!... Killing us!... Selfishly dying... Like you wouldn't know that...")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "I AM THE BANE...")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "GIVE ME BACK MY DEATH...")}
            {SPEAKER_GENERIC (role=Commander) ( _ "Shut up! Shut up you abyssal rattle-box! Will you!")}

            [gold]
                side=3
                amount=1000
            [/gold]

            [allow_recruit]
                side=3
                type=Bandit
            [/allow_recruit]
            {VARIABLE reinforcements 1}
        [/then]
        [/if]
    #enddef

    #define KNALGAN_GUARDS_CHARGE
        [store_unit]
            [filter]
                role=Guard
            [/filter]
            kill=no
            variable=guarding_units
        [/store_unit]

        {FOREACH guarding_units i}

        [object]
            silent=yes
            [filter]
                x,y=$guarding_units[$i].x,$guarding_units[$i].y
            [/filter]
            [effect]
                apply_to=movement_costs
                replace=false
                [movement_costs]
                    flat=-30
                [/movement_costs]
            [/effect]
        [/object]

        {NEXT i}

        {CLEAR_VARIABLE guarding_units}
    #enddef

    #define TALLIN_INSANE_SPEAK
        [if]
            [variable]
                name=tallin_insane_speak
                not_equals=1
            [/variable]
        [then]
            {SPEAKER_GENERIC (role=Commander) ( _ "(<i>With abhorrence</i>) Tallin... Worms just messed up your brain.")}
            {CAMERIN_DEAD (
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "If you don't like the show... Why don't you just go?...(<i>Laugh</i>)")}
            ) (
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "You are my idol Camerin... You are able to be... Unbalanced without worms in your head...")}
            )}
            {VARIABLE tallin_insane_speak 1}
        [/then]
        [/if]
    #enddef

    #define TALLIN_FRIEND_SPEAK SPEAKER
        [if]
            [variable]
                name=tallin_friend_speak
                not_equals=1
            [/variable]
        [then]
            {SPEAKER_GENERIC (speaker={SPEAKER}) ( _ "Gods of light it's $friend_name!")}
            {CAMERIN_DEAD (
                {SPEAKER_GENERIC (speaker=Rhodry) ( _ "You perverted servant of darkness! Be cursed for eternity!")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "I AM... (<i>Laugh</i>)")}
            ) (
                {SPEAKER_GENERIC (speaker=Camerin) ( _ "It is not him! This is just his corpse! Destroy it!")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>Laugh</i>)")}
            )}
            {VARIABLE tallin_friend_speak 1}
        [/then]
        [/if]
    #enddef

    #define RHODRY_SPEAK COMMANDER
        [if]
            [variable]
                name={COMMANDER}.id
                equals=Rhodry
            [/variable]
        [then]
            [if]
                [variable]
                    name=rhodry_speak
                    not_equals=1
                [/variable]
            [then]
                {RANDOM 1..2}

                {SPEAKER_GENERIC (speaker=Tallin) ( _ "A divine knight!... Are you enjoy being in my place?... (<i>Laugh</i>)")}

                [if]
                    [variable]
                        name=random
                        numerical_equals=1
                    [/variable]
                [then]
                    {SPEAKER_GENERIC (speaker=Rhodry) ( _ "Where you failed I will succeed.")}
                    {SPEAKER_GENERIC (speaker=Tallin) ( _ "Cool... I will paint that on the walls of this cave... With the blood of those you couldn't save...")}
                [/then]
                [else]
                    {SPEAKER_GENERIC (speaker=Rhodry) ( _ "I trust the gods.")}
                    {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>Laugh</i>) Ya... They're just waiting to rob you of your dreams...")}
                [/else]
                [/if]

                {VARIABLE rhodry_speak 1}
                {CLEAR_VARIABLE random}
            [/then]
            [/if]
        [/then]
        [/if]
    #enddef

    #define DUST_ATTACK ATTACKER DEFENDER RANGE WEAPON HIT DAMAGE TYPE ALIGNMENT
        {VARIABLE dust_hit {HIT}}

        {ANIMATE_UNIT {ATTACKER} attack (
            [primary_attack]
                range={RANGE}
                name={WEAPON}
            [/primary_attack]

            hits=$dust_hit
            [facing]
                [filter]
                    id={DEFENDER}
                [/filter]
            [/facing]
        )}
        {ANIMATE_UNIT {DEFENDER} defend (
            hits=$dust_hit
            [facing]
                [filter]
                    id={ATTACKER}
                [/filter]
            [/facing]
        )}

        [if]
            [variable]
                name=dust_hit
                equals=yes
            [/variable]
        [then]
            [harm_unit]
                [filter]
                    id={DEFENDER}
                [/filter]

                amount={DAMAGE}
                alignment={ALIGNMENT}
                damage_type={TYPE}
                kill=no
            [/harm_unit]
        [/then]
        [/if]

        {CLEAR_VARIABLE dust_hit}
    #enddef

    [side]
        {PROTAGONIST_FORCES}
        gold=100
        recruit=Walking Corpse,Skeleton,Skeleton Archer
        user_team_name=_"Minions"
        color=teal
        # Since village number in this scenario is greatly reduced basic income increased by 5 (10 -5 =5)
        income=5
        {FLAG_VARIANT undead}
    [/side]

    [side]
        {PROTAGONIST_FORCES_ALLIED 2 ai undead}
        type=Ancient Lich
        id=Malifor
        name= _ "Malifor"
        profile=portraits/Malifor.png
        user_team_name= _ "Minions"
        gold=0
        income=-2
    [/side]

    [side]
        side=3
        no_leader=yes
        team_name=foe
        user_team_name=_"Knalgans"
        {GOLD4 700 800 900 1000}
        recruit=Thug,Trapper,Dwarvish Steelclad,Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Thunderguard,Dwarvish Guardsman,Dwarvish Stalwart,Dwarvish Scout,Dwarvish Pathfinder,Poacher,Footpad,Outlaw
        color=red
        # Since village number in this scenario is greatly reduced basic income increased by 6 (11 -5 =6 Villages)
        {INCOME4 12 14 16 18}
        {FLAG_VARIANT knalgan}
        [ai]
            turns=1,4-9,12-17
            recruitment_ignore_bad_combat=yes
        [/ai]
    [/side]

    [side]
        {PROTAGONIST_FORCES_ALLIED 4 ai undead}
        type=Dark Adept
        id=Deory
        name=Deory
        gender=male
        profile=portraits/humans/transparent/dark-adept.png
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_QUICK}
        [/modifications]
        user_team_name=_"Minions"
        gold=100
        recruit=Walking Corpse
    [/side]

    [event]
        name=prestart

        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Resist till the end of turns"
                show_turn_counter=yes
            [/objective]
            [objective]
                {ALTERNATIVE_OBJECTIVE_CAPTION}
                condition=win
                description=_ "Defeat enemy leader" +{OBJECTIVE_FOOTNOTE _"(bonus at beginning of a next level)"}
            [/objective]
            [objective]
                condition=lose
                description=_ "Destruction of Tallin"
            [/objective]
            [objective]
                condition=lose
                description=_ "Lose control over village at the chamber gate"
            [/objective]

            {GOLD_CARRYOVER_DEFAULT yes}
        [/objectives]

        # Draw map since we haven't any
        [switch]
            variable=malifor_keep
            [case]
                value="1"
                {BATTLEFIELD "{~add-ons/Northern_Rebirth_Remake/maps/Battlefield-07b-1.mask}"}
                {PLACE_IMAGE scenery/dwarven-doors-closed.png 16 3}
                {PLACE_IMAGE scenery/dwarven-doors-closed.png 18 3}
                {PLACE_IMAGE scenery/dwarven-doors-closed.png 20 6}
                {VARIABLE leader_x 10}
                {VARIABLE leader_y 33}
                {VARIABLE entrence_x 1}
                {VARIABLE entrence_y 3}
                {VARIABLE keep_x 8}
                {VARIABLE keep_y 4}
                {VARIABLE gate_village_x 19}
                {VARIABLE gate_village_y 2}
                {VARIABLE mage_attack_male_x 16}
                {VARIABLE mage_attack_male_y 7}
                {VARIABLE mage_attack_female_x 18}
                {VARIABLE mage_attack_female_y 7}
                {VARIABLE chamber_entrence_x 20}
                {VARIABLE chamber_entrence_y 6}
                {VARIABLE cover_fighter_x 17}
                {VARIABLE cover_fighter_y 7}
                {VARIABLE cover_scout_x 17}
                {VARIABLE cover_scout_y 5}
                {VARIABLE visibility_range_x "4-14,4-20"}
                {VARIABLE visibility_range_y "29-31,32-35"}
                {VARIABLE gate_assault_range_x "11,12,13,14-15,16-19,17,19"}
                {VARIABLE gate_assault_range_y "2-6,1-5,1-4,1-3,1-2,3,3"}
                {VARIABLE gate_area_x 17}
                {VARIABLE gate_area_y 2}
            [/case]
            [case]
                value="2"
                {BATTLEFIELD "{~add-ons/Northern_Rebirth_Remake/maps/Battlefield-07b-2.mask}"}
                {PLACE_IMAGE scenery/dwarven-doors-closed.png 4 4}
                {PLACE_IMAGE scenery/dwarven-doors-closed.png 1 9}
                {VARIABLE leader_x 10}
                {VARIABLE leader_y 33}
                {VARIABLE entrence_x 20}
                {VARIABLE entrence_y 2}
                {VARIABLE keep_x 13}
                {VARIABLE keep_y 4}
                {VARIABLE gate_village_x 3}
                {VARIABLE gate_village_y 2}
                {VARIABLE mage_attack_male_x 2}
                {VARIABLE mage_attack_male_y 6}
                {VARIABLE mage_attack_female_x 2}
                {VARIABLE mage_attack_female_y 8}
                {VARIABLE chamber_entrence_x 1}
                {VARIABLE chamber_entrence_y 9}
                {VARIABLE cover_fighter_x 3}
                {VARIABLE cover_fighter_y 7}
                {VARIABLE cover_scout_x 4}
                {VARIABLE cover_scout_y 5}
                {VARIABLE visibility_range_x "4-20,6-20,5-20,2-20"}
                {VARIABLE visibility_range_y "29-30,31-32,33,34-35"}
                {VARIABLE gate_assault_range_x "3-4,5-6,7,8,8,9,10"}
                {VARIABLE gate_assault_range_y "1-3,2-4,1-5,1,3-5,2-5,1-5"}
                {VARIABLE gate_area_x 4}
                {VARIABLE gate_area_y 2}
            [/case]
            [else]
                # I could draw something here too but I used default to save 3,7kb of *your* disk space (Now you can use your TB for everything you want!)
                {PLACE_IMAGE scenery/dwarven-doors-closed.png 16 5}
                {PLACE_IMAGE scenery/dwarven-doors-closed.png 18 5}
                {PLACE_IMAGE scenery/dwarven-doors-closed.png 20 7}
                {VARIABLE leader_x 11}
                {VARIABLE leader_y 34}
                {VARIABLE entrence_x 1}
                {VARIABLE entrence_y 1}
                {VARIABLE keep_x 8}
                {VARIABLE keep_y 4}
                {VARIABLE gate_village_x 19}
                {VARIABLE gate_village_y 3}
                {VARIABLE mage_attack_male_x 16}
                {VARIABLE mage_attack_male_y 8}
                {VARIABLE mage_attack_female_x 18}
                {VARIABLE mage_attack_female_y 8}
                {VARIABLE chamber_entrence_x 20}
                {VARIABLE chamber_entrence_y 7}
                {VARIABLE cover_fighter_x 17}
                {VARIABLE cover_fighter_y 8}
                {VARIABLE cover_scout_x 17}
                {VARIABLE cover_scout_y 6}
                {VARIABLE visibility_range_x "1-20"}
                {VARIABLE visibility_range_y "29-35"}
                {VARIABLE gate_assault_range_x "11,12-13,14,15-19,16,18"}
                {VARIABLE gate_assault_range_y "2-6,2-5,1-4,2-4,1,1"}
                {VARIABLE gate_area_x 17}
                {VARIABLE gate_area_y 3}
            [/else]
        [/switch]

        # Variables
        {VARIABLE tallin_victims 0}

        {RANDOM 1..5}
        {VARIABLE cavern_shape $random}
        {CLEAR_VARIABLE random}
    [/event]

    [event]
        name=start

        {TEAM_COLOR_OVERRIDE id=Malifor red}

        [switch]
            variable=malifor_keep
            [case]
                value="1"
                {TELEPORT_UNIT id="Malifor" 17 8}
            [/case]
            [case]
                value="2"
                {TELEPORT_UNIT id="Malifor" 2 7}
            [/case]
            [else]
                {TELEPORT_UNIT id="Malifor" 17 9}
            [/else]
        [/switch]

        {TELEPORT_UNIT id="Tallin" $entrence_x $entrence_y}

        [hide_unit]
            x,y=$entrence_x,$entrence_y
        [/hide_unit]

        {PUT_GUARDIAN 2 "Revenant" 4 13}
        {PUT_GUARDIAN 2 "Revenant" 10 13}
        {PUT_GUARDIAN 2 "Revenant" 12 13}
        {PUT_GUARDIAN 2 "Revenant" 18 13}
        {PUT_GUARDIAN 2 "Skeleton Archer" 6 12}
        {PUT_GUARDIAN 2 "Skeleton Archer" 8 12}
        {PUT_GUARDIAN 2 "Skeleton Archer" 14 12}
        {PUT_GUARDIAN 2 "Skeleton Archer" 16 12}

        {CAMERIN_DEAD (
            [unit]
                type=Royal Guard       
                side=3
                id=Rhodry
                role=Commander
                name= _ "Rhodry"
                unrenamable=yes
                canrecruit=yes
                profile=portraits/humans/transparent/swordsman-2.png
                x,y=$leader_x,$leader_y
                [modifications]
                    {TRAIT_RESILIENT}
                    {TRAIT_STRONG}
                    # This is to make him much more deadly. After all I don't want to reward player for a bad game in earlier scenarios...
                    [object]
                        silent=yes
                        duration=scenario
                        [effect]
                            apply_to=attack
                            range=melee
                            set_type=arcane
                        [/effect]
                    [/object]
                [/modifications]    
            [/unit]
        ) (
            [unit]
                type=Great Mage
                side=3
                id=Camerin
                role=Commander
                name= _ "Camerin"
                unrenamable=yes
                canrecruit=yes
                profile=portraits/Camerin.png
                x,y=$leader_x,$leader_y
                [modifications]
                    {TRAIT_LOYAL}
                    {TRAIT_STRONG}      
                [/modifications]    
            [/unit]
        )}

        {CLEAR_VARIABLE leader_x}
        {CLEAR_VARIABLE leader_y}

        # Place map specific objects.
        # Note: Specific not means only for this map, but where actually I can put some things
        [switch]
            variable=malifor_keep
            [case]
                value="1"
                # Take some villages
                [capture_village]
                    side=1
                    x=4,5,7,9,$gate_village_x
                    y=2,2,2,2,$gate_village_y
                [/capture_village]

                [capture_village]
                    side=3
                    x=5,8,12,17,17
                    y=32,35,35,33,35
                [/capture_village]

                # Place units
                {PUT_GUARDIAN 2 "Skeleton Archer" 15 1}
                {PUT_GUARDIAN 2 "Skeleton Archer" 19 1}
                {PUT_GUARDIAN 2 "Skeleton Archer" 15 3}
                {PUT_GUARDIAN 2 "Skeleton Archer" 19 3}

                {GENERIC_UNIT 3 "Dwarvish Fighter" 9 19}
                {GENERIC_UNIT 3 "Trapper" 13 19}

                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 5 34}
                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 7 32}
                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 10 31}
                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 13 32}
                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 15 34}
            [/case]
            [case]
                value="2"
                [capture_village]
                    side=1
                    x=$gate_village_x,12,14,16,17
                    y=$gate_village_y,1,1,1,2
                [/capture_village]

                [capture_village]
                    side=3
                    x=5,7,16,14,16
                    y=34,34,30,34,34
                [/capture_village]

                {PUT_GUARDIAN 2 "Skeleton Archer" 3 1}
                {PUT_GUARDIAN 2 "Skeleton Archer" 6 2}
                {PUT_GUARDIAN 2 "Skeleton Archer" 3 3}
                {PUT_GUARDIAN 2 "Skeleton Archer" 6 4}

                {GENERIC_UNIT 3 "Dwarvish Fighter" 10 19}
                {GENERIC_UNIT 3 "Trapper" 12 18}

                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 9 29}
                {PUT_KNALGAN_GUARD "Dwarvish Lord" 12 29}
            [/case]
            [else]
                [capture_village]
                    side=1
                    x=4,5,7,9,$gate_village_x
                    y=2,2,2,2,$gate_village_y
                [/capture_village]

                [capture_village]
                    side=3
                    x=6,8,14,16,17
                    y=32,35,35,32,34
                [/capture_village]

                {PUT_GUARDIAN 2 "Skeleton Archer" 15 2}
                {PUT_GUARDIAN 2 "Skeleton Archer" 19 2}
                {PUT_GUARDIAN 2 "Skeleton Archer" 15 4}
                {PUT_GUARDIAN 2 "Skeleton Archer" 19 4}

                {GENERIC_UNIT 3 "Dwarvish Fighter" 9 19}
                {GENERIC_UNIT 3 "Trapper" 13 19}

                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 7 34}
                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 8 31}
                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 11 30}
                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 14 31}
                {PUT_KNALGAN_GUARD "Dwarvish Steelclad" 15 34}
            [/else]
        [/switch]

        {GENERIC_UNIT 3 "Bandit" 7 16}
        {GENERIC_UNIT 3 "Bandit" 10 18}
        {GENERIC_UNIT 3 "Bandit" 15 18}
        {GENERIC_UNIT 3 "Dwarvish Fighter" 13 18}
        {GENERIC_UNIT 3 "Dwarvish Fighter" 7 18}
        {GENERIC_UNIT 3 "Dwarvish Thunderguard" 11 17}
        {GENERIC_UNIT 3 "Trapper" 10 17}
        {GENERIC_UNIT 3 "Dwarvish Guardsman" 11 21}
        {GENERIC_UNIT 3 "Dwarvish Guardsman" 13 17}
        {GENERIC_UNIT 3 "Dwarvish Guardsman" 11 19}

        {CAMERIN_DEAD (
            {SPEAKER_GENERIC (speaker=Rhodry) ( _ "Men lets make this monster pay for all his crimes!")}
            {SPEAKER_GENERIC (speaker=Malifor) ( _ "You lousy bumpkin you think you won! This is not the end yet! I can not be defeated! TALLIN!")}
        ) (
            {SPEAKER_GENERIC (speaker=Camerin) ( _ "Come on guys, lets fry this dried corpse in our fury! This is gonna be fun!")}
            {SPEAKER_GENERIC (speaker=Malifor) ( _ "You miserable conjurer you think you won! This is not the end yet! I can not be defeated! TALLIN!")}
        )}

        [unhide_unit]
            x,y=$entrence_x,$entrence_y
        [/unhide_unit]

        {MOVE_UNIT id=Tallin $keep_x $keep_y}

        {CLEAR_VARIABLE keep_x}
        {CLEAR_VARIABLE keep_y}

        # wmllint: local spelling Pliiizzzz
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "If you don't want to fall... Under my command... Leave now... Pliiizzzz... (<i>Laugh</i>)")}
        {SPEAKER_GENERIC (role=Commander) ( _ "When I see now what you became, Tallin I almost regret that I will release you from this state... bloody traitor...")}
        {CAMERIN_DEAD (
            {SPEAKER_GENERIC (speaker=Rhodry) ( _ "We just need to break through the remains of Malifors army and victory is ours! To battle!")}
        ) (
            {SPEAKER_GENERIC (speaker=Camerin) ( _ "Just blast the remains of Malifors army and victory is ours! To battle! And save some of those skellies for me!")}
        )}

        [recall]
            id=Friend
        [/recall]

        [if]
            [have_unit]
                side=1
                id=Friend
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Look at them... Friend... they cheated me... They cheated you... But now we know the truth... And we do not permit to be deceived again...")}
        [/then]
        [/if]
    [/event]

    [event]
        name=new turn
        first_time_only=no

        [if]
            [variable]
                name=deory_dead
                not_equals=1
            [/variable]
            [and]
                [variable]
                    name=deory_village_taken
                    not_equals=1
                [/variable]
            [/and]
        [then]
            {CLEAR_VARIABLE deory_villages}

            [store_locations]
                owner_side=4
                terrain=*^V*
                variable=deory_villages
            [/store_locations]
        [/then]
        [/if]
    [/event]

    [event]
        name=turn 5

        {MODIFY_AI_ADD_GOAL 3 (
            [goal]
                name=target_location
                id=capture_gate
                [criteria]
                    x=$gate_area_x
                    y=$gate_area_y
                [/criteria]
                value=20
            [/goal]
        )}

        [event]
            name=side 3 turn
            first_time_only=no

            [store_unit]
                [filter]
                    side=1
                    x=20,18-22,16-24,18-22
                    y=11,12,13-17,18
                [/filter]
                kill=no
                variable=assaulters
            [/store_unit]

            [if]
                [variable]
                    name=assaulters[1].x
                    greater_than=0
                [/variable]
            [then]
                [if]
                    [variable]
                        name=gate_assault
                        less_than=1
                    [/variable]
                [then]
                    {MODIFY_AI_ADD_ASPECT 3 aggression (
                        id=chamber_assault
                        value=1.0
                    )}
                    {VARIABLE gate_assault 1}
                [/then]
                [/if]
            [/then]
            [else]
                [if]
                    [variable]
                        name=gate_assault
                        greater_than=0
                    [/variable]
                [then]
                    {MODIFY_AI_DELETE_ASPECT 3 aggression chamber_assault}
                    {CLEAR_VARIABLE gate_assault}
                [/then]
                [/if]
            [/else]
            [/if]

            {CLEAR_VARIABLE assaulters}
        [/event]
    [/event]

    [event]
        name=turn 10

        {RANDOM 1..8}

        [switch]
            variable=random
            [case]
                value="1"
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "It must be a real joy for you... Most would leave such a party... Even if they would claim to be friends... (<i>Laugh</i>)")}
            [/case]
            [case]
                value="2"
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "STRUCK... STRUCK NOW... WITH DIVINE POWER...")}
            [/case]
            [case]
                value="3"
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Bring the brigade of light... At least...")}
            [/case]
            [case]
                value="4"
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Better get some reinforcements... I'm done with those...")}
            [/case]
            [case]
                value="5"
                {CAMERIN_DEAD (
                    {SPEAKER_GENERIC (speaker=Tallin) ( _ "Do not lose your head... (<i>Laugh</i>)")}
                ) (
                    {SPEAKER_GENERIC (speaker=Tallin) ( _ "Camerin... Do not lose your head... (<i>Laugh</i>)")}
                )}
            [/case]
            [case]
                value="6"
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "It's better to be dead sooner... It saves you a lot of time...")}
            [/case]
            [case]
                value="7"
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Where are those... famous dwarven hammers?... to heavy?...")}
            [/case]
            [else]
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "FIGHT TO YOUR DEATHS!... WE WILL FIGHT AFTER!...")}
            [/else]
        [/switch]
        {CLEAR_VARIABLE random}
    [/event]

    {LEADER_EXPERIENCE_DEAD}

    [event]
        name=time over

        [fire_event]
            name=dust
        [/fire_event]
    [/event]

    [event]
        name=last breath
        [filter]
            id=Deory
        [/filter]

        {SPEAKER_GENERIC (speaker=Deory) ( _ "Ahhh! Master, help me!")}
        {SPEAKER_GENERIC (speaker=Malifor) ( _ "Serves you right, you useless excuse for a slave.")}
        # Set variable for later use
        {VARIABLE deory_dead 1}
        {CLEAR_VARIABLE deory_village_taken}
    [/event]

    {LEADER_DEATH ( _ "Death is mine... At last...")}

    [event]
        name=moveto

        [filter]
            side=3
            x=$gate_village_x
            y=$gate_village_y
        [/filter]

        # This is in case that village at chamber gate would be captured by enemy leader what could break conversation...
        [if]
            [variable]
                name=unit.id
                not_equals=Camerin
            [/variable]
            [and]
                [variable]
                    name=unit.id
                    not_equals=Rhodry
                [/variable]
            [/and]
        [then]
            {SPEAKER_GENERIC (speaker=unit) ( _ "We have taken control of the chamber gates!")}

            {CAMERIN_DEAD (
                {SPEAKER_GENERIC (speaker=Rhodry) ( _ "Perfect! Now we will smite them in the name of the gods of light!")}
            ) (
                {SPEAKER_GENERIC (speaker=Camerin) ( _ "Now skellies will burn!")}
            )}
        [/then]
        [else]
            {CAMERIN_DEAD (
                {SPEAKER_GENERIC (speaker=Rhodry) ( _ "We have taken control of the chamber gates! Now we will smite them in the name of gods of light!")}
            ) (
                {SPEAKER_GENERIC (speaker=Camerin) ( _ "We have taken control of the chamber gates! Now skellies will burn!")}
            )}
        [/else]
        [/if]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>Laugh</i>)")}

        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    # Deory will complain if Tallin grab one of his villages
    [event]
        name=capture
        first_time_only=no

        [filter]
            side=1
        [/filter]

        [if]
            [variable]
                name=deory_dead
                not_equals=1
            [/variable]
            [and]
                [variable]
                    name=deory_village_taken
                    not_equals=1
                [/variable]
            [/and]
        [then]
            {VARIABLE captured_village_x $x1}
            {VARIABLE captured_village_y $y1}

            {FOREACH deory_villages i}

            [if]
                [variable]
                    name=captured_village_x
                    equals=$deory_villages[$i].x
                [/variable]
                [and]
                    [variable]
                        name=captured_village_y
                        equals=$deory_villages[$i].y
                    [/variable]
                [/and]
            [then]
                {VARIABLE deory_village_taken 1}
            [/then]
            [/if]

            {NEXT i}

            [if]
                [variable]
                    name=deory_village_taken
                    numerical_equals=1
                [/variable]
            [then]
                {SPEAKER_GENERIC (speaker=Deory) ( _ "Master! Tallin is taking my villages!")}
                {SPEAKER_GENERIC (speaker=Tallin) ( _ "Join the force...")}
                {SPEAKER_GENERIC (speaker=Malifor) ( _ "Agreed. And if you donâ€™t keep your mouth shut, I will personally shut it for you!")}
                {SPEAKER_GENERIC (speaker=Deory) ( _ "(<i>Gulp</i>)")}
            [/then]
            [else]
                [allow_undo]
                [/allow_undo]
            [/else]
            [/if]

            {CLEAR_VARIABLE captured_village_x}
            {CLEAR_VARIABLE captured_village_y}
        [/then]
        [else]
            [allow_undo]
            [/allow_undo]
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=1-20
            y=21-35
        [/filter]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Something wicked... is coming this way... Something wicked...")}
        {CAMERIN_DEAD (
            {SPEAKER_GENERIC (speaker=Rhodry) ( _ "Come here and fight with me Malifor's puppet! If you do not fear me...")}
        ) (
            {SPEAKER_GENERIC (speaker=Camerin) ( _ "Come meet my fireballs Malifor puppet! You don't scare me!")}
        )}
        [message]
            speaker=Tallin
            message= _ "In times past was a leader... parading on breaking ice.
Placing a trap to be a reaper... faking himself a sacrifice.
However how could he feel... the time his guards are to call
If death's trace can't be seen... conjuring his mortal fall!"
        [/message]
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=1-20
            y=29-35
            [not]
                type=Shadow,Nightgaunt,Skeleton,Deathblade,Revenant,Draug,Death Knight,Skeleton Archer,Bone Shooter,Banebow,Lich,Skeleton NR,Revenant NR
            [/not]
        [/filter]

        {KNALGAN_REINFORCEMENTS}
    [/event]

    [event]
        name=moveto

        [filter]
            side=1
            x=$visibility_range_x
            y=$visibility_range_y
            type=Skeleton,Deathblade,Revenant,Draug,Death Knight,Skeleton Archer,Bone Shooter,Banebow,Lich,Skeleton NR,Revenant NR
        [/filter]

        {KNALGAN_REINFORCEMENTS}
    [/event]

    [event]
        name=attack

        [filter]
            side=1
            type=Shadow,Nightgaunt,Skeleton,Deathblade,Revenant,Draug,Death Knight,Skeleton Archer,Bone Shooter,Banebow,Lich,Skeleton NR,Revenant NR
            x=1-20
            y=29-35
        [/filter]

        {KNALGAN_REINFORCEMENTS}
    [/event]

    [event]
        name=attack

        [filter_second]
            side=1
            type=Shadow,Nightgaunt,Skeleton,Deathblade,Revenant,Draug,Death Knight,Skeleton Archer,Bone Shooter,Banebow,Lich,Skeleton NR,Revenant NR
            x=1-20
            y=29-35
        [/filter_second]

        {KNALGAN_REINFORCEMENTS}
    [/event]

    [event]
        name=attack

        [filter]
            id=Friend
        [/filter]
        [filter_second]
            [not]
                role=Commander
            [/not]
        [/filter_second]

        {TALLIN_FRIEND_SPEAK second_unit}
    [/event]

    [event]
        name=attack

        [filter]
            [not]
                role=Commander
            [/not]
        [/filter]
        [filter_second]
            id=Friend
        [/filter_second]

        {TALLIN_FRIEND_SPEAK unit}
    [/event]

    [event]
        name=attack

        [filter]
            side=1
        [/filter]
        [filter_second]
            role=Guard
        [/filter_second]

        [if]
            [variable]
                name=knalgan_guards_charge
                not_equals=1
            [/variable]
        [then]
            {SPEAKER_GENERIC (speaker=second_unit) ( _ "GRIND THEM TO DUST!!! ATTACK!")}

            {KNALGAN_GUARDS_CHARGE}

            {VARIABLE knalgan_guards_charge 1}
        [/then]
        [/if]
    [/event]

    [event]
        name=attack

        [filter]
            side=1
        [/filter]
        [filter_second]
            role=Commander
        [/filter_second]

        [if]
            [variable]
                name=knalgan_guards_charge
                not_equals=1
            [/variable]
        [then]
            {SPEAKER_GENERIC (role=Guard) ( _ "PROTECT THE COMMANDER!!! ATTACK!")}

            {KNALGAN_GUARDS_CHARGE}

            {VARIABLE knalgan_guards_charge 1}
        [/then]
        [/if]

        {RHODRY_SPEAK second_unit}
    [/event]

    [event]
        name=attack

        [filter]
            role=Commander
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [if]
            [variable]
                name=knalgan_guards_charge
                not_equals=1
            [/variable]
        [then]
            {SPEAKER_GENERIC (role=Guard) ( _ "COVER THE COMMANDER!!! ATTACK!")}

            {KNALGAN_GUARDS_CHARGE}

            {VARIABLE knalgan_guards_charge 1}
        [/then]
        [/if]

        {RHODRY_SPEAK unit}
    [/event]

    [event]
        name=last breath

        [filter]
            [not]
                role=Commander
            [/not]
        [/filter]
        [filter_second]
            id=Tallin
            type=Bone Shooter,Banebow
        [/filter_second]        
        [filter_second_attack]
            range=ranged
        [/filter_second_attack]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "That's my bow... It's called... Peacemaker...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Ah I'm almost out of arrows. ... Would you help me, ... my friend? ...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>He cut bones out of the body with a dagger. Under his touch the bones split into numerous arrows.</i>)")}

        [object]
            [filter]
                id=Tallin
            [/filter]
            silent=yes
            duration=scenario
            [effect]
                apply_to=attack
                range=ranged
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_MAGICAL}
                [/set_specials]
            [/effect]
        [/object]
        [sound]
            name=magic-dark.ogg
        [/sound]
        [message]
            speaker=narrator
            message= _ "<span color='#fff21f'>Tallin gains magical ranged attacks for the remainder of this level!</span>"
            image=wesnoth-icon.png
        [/message]
        {TALLIN_INSANE_SPEAK}
        {VARIABLE tallin_speak 1}
    [/event]

    [event]
        name=last breath

        [filter]
            [not]
                role=Commander
            [/not]
        [/filter]
        [filter_second]
            id=Tallin
            type=Deathblade
        [/filter_second]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "It hurts badly? How I could make you ... suffer so much. ...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Curse you, my blunt blades! ... Sharpen it for me friend... So I could end your pain swiftly. ...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>He wrests a bone from the body and use it like it would be a whetstone.</i>)")}        

        [object]
            [filter]
                id=Tallin
            [/filter]
            silent=yes
            duration=scenario
            [effect]
                apply_to=attack
                range=melee
                increase_damage=3
            [/effect]
        [/object]
        [sound]
            name=magic-dark.ogg
        [/sound]
        [message]
            speaker=narrator
            message= _ "<span color='#fff21f'>Tallin gains +3 melee damage bonus for the remainder of this level!</span>"
            image=wesnoth-icon.png
        [/message]
        {TALLIN_INSANE_SPEAK}
        {VARIABLE tallin_speak 1}
    [/event]

    [event]
        name=last breath

        [filter]
            [not]
                role=Commander
            [/not]
        [/filter]
        [filter_second]
            id=Tallin
            type=Draug
        [/filter_second]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "It looks like this battle ... Completely drained you out. ...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "It is simple to avoid this situation my friend. ... You see, the weapon is the soul of a warrior, ... let it feast!...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>He pours blood on his axe.</i>)")}

        [object]
            [filter]
                id=Tallin
            [/filter]
            silent=yes
            duration=scenario
            [effect]
                apply_to=attack
                range=melee
                [set_specials]
                    mode=append
                    {WEAPON_SPECIAL_DRAIN}
                [/set_specials]
            [/effect]
        [/object]
        [sound]
            name=magic-dark.ogg
        [/sound]
        [message]
            speaker=narrator
            message= _ "<span color='#fff21f'>Tallin gains draining melee attacks for the remainder of this level!</span>"
            image=wesnoth-icon.png
        [/message]
        {TALLIN_INSANE_SPEAK}
        {VARIABLE tallin_speak 1}
    [/event]

    [event]
        name=die

        [filter]
            [not]
                role=Commander
            [/not]
        [/filter]
        [filter_second]
            id=Tallin
            type=Death Knight
        [/filter_second]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Ahh... What have I done! ... It was my friend! ...")}
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "(<i>Raises his arm above the body</i>) I will save you! ... Rise! ...")}

        [kill]
            id=$unit.id
        [/kill]
        [if]
            [variable]
                name=unit.race
                equals=dwarf
            [/variable]
        [then]
            [unit]
                side=1
                name=$unit.name
                id="Saved Friend"
                type=Walking Corpse
                variation=dwarf
                [modifications]
                    [object]
                        silent=yes
                        duration=forever
                        [effect]
                            apply_to=hitpoints
                            increase_total=6
                            heal_full=yes
                        [/effect]
                    [/object]
                [/modifications]
                x,y=$unit.x,$unit.y
            [/unit]
        [/then]
        [else]
            [unit]
                side=1
                name=$unit.name
                id="Saved Friend"
                type=Walking Corpse
                [modifications]
                    [object]
                        silent=yes
                        duration=forever
                        [effect]
                            apply_to=hitpoints
                            increase_total=6
                            heal_full=yes
                        [/effect]
                    [/object]
                [/modifications]
                x,y=$unit.x,$unit.y
            [/unit]
        [/else]
        [/if]
        [sound]
            name=zombie-hit-6.ogg
        [/sound]
        {TALLIN_INSANE_SPEAK}
        {VARIABLE tallin_speak 1}
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]
            [not]
                role=Commander
            [/not]
        [/filter]
        [filter_second]
            id=Tallin
        [/filter_second]

        # This is to not trigger this event if Tallin actually have done something already but not skip it
        [if]
            [variable] 
                name=tallin_speak
                not_equals=1
            [/variable]
            [and]
                [variable]
                    name=tallin_blood_speak
                    not_equals=1
                [/variable]
            [/and]
            [and]
                [variable]
                    name=tallin_victims
                    greater_than=3
                [/variable]
            [/and]
        [then]
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Ahh... Blood... I'm bleeding... I'm wounded!... A Miracle!... I'm alive!...")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Damn, ... It's not mine...")}
            {TALLIN_INSANE_SPEAK}
            {VARIABLE tallin_blood_speak 1}
        [/then]
        [else]
            {CLEAR_VARIABLE tallin_speak}
        [/else]
        [/if]
        {VARIABLE_OP tallin_victims add 1}
    [/event]

    [event]
        name=die

        [filter]
            [not]
                role=Commander
            [/not]
        [/filter]
        [filter_second]
            id=Friend
        [/filter_second]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Good $friend_name!... I will make you my chief corpse... (<i>Laugh</i>)")}
    [/event]

    [event]
        name=die

        [filter]
            id=Friend
        [/filter]
        [filter_second]
            [not]
                role=Commander
            [/not]
        [/filter_second]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "Ah... $friend_name... You should listen to me... (<i>Laugh</i>)")}
    [/event]

    [event]
        name=die

        [filter]
            id=Saved Friend
        [/filter]
        [filter_second]
            [not]
                role=Commander
            [/not]
        [/filter_second]

        [role]
            id=$second_unit.id
            role=Saved Friend Killer
        [/role]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "How could you... It was your friend... (<i>Laugh</i>)")}
        {SPEAKER_GENERIC (role=Saved Friend Killer) ( _ "It's time for you pal!")}
    [/event]

    [event]
        name=last breath

        [filter]
            role=Saved Friend Killer
        [/filter]

        # wmllint: local spelling meeeee
        {SPEAKER_GENERIC (speaker=Tallin) ( _ "YOU PROMISED!... Give it to meeeee... GIVE IT!...")}
        # wmllint: no spellcheck
        {SPEAKER_GENERIC (role=Saved Friend Killer) ( _ "Uuhhhh...")}
    [/event]


    [event]
        name=last breath

        [filter]
            role=Commander
        [/filter]

        {CAMERIN_DEAD (
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "Sweet dreams...")}
            {SPEAKER_GENERIC (speaker=Rhodry) ( _ "(<i>Spits with blood</i>) I sacrificed... Everything for something ... good, ... and you?...")}
            {SPEAKER_GENERIC (speaker=Tallin) ( _ "I always win...")}
            {SPEAKER_GENERIC (speaker=Rhodry) ( _ "Look there...")}
        ) (
            {SPEAKER_GENERIC (speaker=Camerin) ( _ "Look at all those stars...")}
            {SPEAKER_GENERIC (speaker=Camerin) ( _ "Oh my... My... I overdosed the fun...")}
        )}
    [/event]

    [event]
        name=die

        [filter]
            role=Commander
        [/filter]

        {VARIABLE assault_leader_killed $unit.name}
        {VARIABLE darkness_gaze 1}

        [fire_event]
            name=dust
        [/fire_event]
    [/event]

    [event]
        name=dust

        {SCROLL_TO $chamber_entrence_x $chamber_entrence_y}

        [delay]
            time=1000
        [/delay]

        [sound]
            name=explosion.ogg
        [/sound]

        [unit]
            type="Fog Clearer"
            id=Explosion
            side=1
            x=$chamber_entrence_x
            y=$chamber_entrence_y
            [modifications]
                [object]
                    silent=yes
                    duration=forever
                    [effect]
                        apply_to=new_animation

                        [extra_anim]
                            flag=blast

                            halo_auto_vflip=false
                            [halo_frame]
                                duration=840
                                halo="halo/flame-burst-[1~8].png:[100*7,140]"
                            [/halo_frame]
                        [/extra_anim]
                    [/effect]
                [/object]
            [/modifications]
        [/unit]

        {ANIMATE_UNIT Explosion blast ()}

        [kill]
            id=Explosion
        [/kill]

        [terrain]
            x=$chamber_entrence_x
            y=$chamber_entrence_y
            terrain=Uu
        [/terrain]

        [delay]
            time=800
        [/delay]

        {INCIDENTAL_MUSIC vengeful.ogg}

        [unit]
            type=Dwarvish Steelclad
            side=3
            id=Fighter
            experience=33
            x=$chamber_entrence_x
            y=$chamber_entrence_y
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]

        {MOVE_UNIT id="Fighter" $cover_fighter_x $cover_fighter_y}

        [unit]
            type=Outlaw
            side=3
            id=Scout
            experience=17
            x=$chamber_entrence_x
            y=$chamber_entrence_y
        [/unit]

        {MOVE_UNIT id="Scout" $cover_scout_x $cover_scout_y}

        [unit]
            type=White Mage
            side=3
            id=Father Morvin
            name= _ "Father Morvin"
            profile=portraits/Father_Morvin.png
            x=$chamber_entrence_x
            y=$chamber_entrence_y
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            {IS_LOYAL}
        [/unit]

        {MOVE_UNIT id="Father Morvin" $mage_attack_male_x $mage_attack_male_y}

        [unit]
            type=White Mage
            gender=female
            id=Sister Thera
            name= _ "Sister Thera"
            profile=portraits/Sister_Thera.png
            x=$chamber_entrence_x
            y=$chamber_entrence_y
            side=3
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        [/unit]

        {MOVE_UNIT id="Sister Thera" $mage_attack_female_x $mage_attack_female_y}
        {SPEAKER_GENERIC (speaker=Malifor) ( _ "What the...? <i>No!</i>")}
        # wmllint: no spellcheck
        {SPEAKER_GENERIC (speaker=Sister Thera) ( _ "HEEEEE-YAAAAA!!")}

        {DUST_ATTACK Fighter Malifor melee hammer yes 15 impact neutral}
        {DUST_ATTACK Malifor Fighter melee touch no 8 arcane chaotic}
        {DUST_ATTACK Fighter Malifor melee hammer yes 15 impact neutral}
        {DUST_ATTACK Malifor Fighter melee touch no 8 arcane chaotic}
        {DUST_ATTACK Malifor Fighter melee touch no 8 arcane chaotic}
        {DUST_ATTACK Malifor Fighter melee touch no 8 arcane chaotic}
        {DUST_ATTACK "Father Morvin" Malifor ranged lightbeam yes 9 arcane lawful}
        {DUST_ATTACK Malifor "Father Morvin" ranged "chill tempest" no 13 cold chaotic}
        {DUST_ATTACK "Father Morvin" Malifor ranged lightbeam yes 9 arcane lawful}
        {DUST_ATTACK Malifor "Father Morvin" ranged "chill tempest" no 13 cold chaotic}
        {DUST_ATTACK "Father Morvin" Malifor ranged lightbeam no 9 arcane lawful}
        {DUST_ATTACK Malifor "Father Morvin" ranged "chill tempest" yes 13 cold chaotic}
        {DUST_ATTACK Malifor "Father Morvin" ranged "chill tempest" no 13 cold chaotic}
        {DUST_ATTACK Malifor "Father Morvin" ranged "chill tempest" yes 13 cold chaotic}
        {DUST_ATTACK "Sister Thera" Malifor ranged lightbeam yes 9 arcane lawful}
        {DUST_ATTACK Malifor "Sister Thera" ranged "chill tempest" yes 13 cold chaotic}
        {DUST_ATTACK "Sister Thera" Malifor ranged lightbeam yes 9 arcane lawful}
        {DUST_ATTACK Malifor "Sister Thera" ranged "chill tempest" no 13 cold chaotic}
        {DUST_ATTACK "Sister Thera" Malifor ranged lightbeam yes 9 arcane lawful}

        {SPEAKER_GENERIC (speaker=Malifor) ( _ "CURSES ON YOU YOU BLASTED MAGES, CURSES ON YOU YOU BLASTED HUMANS, CURSES ON YOU YOU BLASTED DWARVES! MAY YOUR MISERABLE LIVES BE FULL OF TORTURE! MAY YOUR PEOPLE NEVER BE FREE! MAY ALL YOUR NEAR AND DEAR DESERT YOU! MAY A THUNDERBOLT HIT YOUR HEAD! MAYâ€“")}
        {SPEAKER_GENERIC (speaker=Sister Thera) ( _ "May you shut your ugly mouth and hurry up and die.")}
        {SPEAKER_GENERIC (speaker=Malifor) ( _ "MAY THE EARTH OPEN UP AND SWALLOW YOU! MAY ALL YOUR TEETH FALL OUT! MAY YOU BECOME A WEAK SKINNY OLD MAN! MAYâ€“")}

        [kill]
            id=Malifor
            animate=yes
        [/kill]

        {SPEAKER_GENERIC (speaker=Father Morvin) ( _ "Finally! He has been reduced to dust.")}

        [sound]
            name=lich-hit-1.ogg
        [/sound]

        {SPEAKER_GENERIC (speaker=Tallin) ( _ "The purpose!... Was lost...")}

        [if]
            [variable]
                name=assault_leader_killed
                not_equals=
            [/variable]
        [then]
            {SPEAKER_GENERIC (id=Fighter) ( _ "Hey, there goes the traitor Tallin!")}
        [/then]
        [else]
            {SPEAKER_GENERIC (role=Commander) ( _ "Hey, there flees the traitor, dready skelly Tallin!")}
        [/else]
        [/if]

        {MOVE_UNIT id=Tallin $entrence_x $entrence_y}

        [hide_unit]
            x,y=$entrence_x,$entrence_y
        [/hide_unit]

        {SPEAKER_GENERIC (speaker=Father Morvin) ( _ "Let it go. This poor tortured soul is just a hellish puppet. If it ever dares to trouble us in the future, however, we should not spare it.")}
        {SPEAKER_GENERIC (speaker=Sister Thera) ( _ "Besides, now when Malifors is gone it will probably turn in a dusty pile of bones anyway, so why bother chasing it?")}

        [if]
            [variable]
                name=assault_leader_killed
                not_equals=
            [/variable]
        [then]
            {CAMERIN_DEAD (
                {SPEAKER_GENERIC (id=Fighter) ( _ "This doll of doom just killed RHODRY. And we will just let it go? I can't believe it.")}
            ) (
                {SPEAKER_GENERIC (id=Fighter) ( _ "This doll of doom just killed CAMERIN. And we will just let it go? I can't believe it.")}
            )}

            {SPEAKER_GENERIC (id=Scout) ( _ "(<i>Looks at the bodies laying on the floor of a cavern... Lots of corpses...</i>) Go get it! I will wait here with the mages.")}
        [/then]
        [/if]

        [if]
            [variable]
                name=deory_dead
                not_equals=1
            [/variable]
        [then]
            [store_unit]
                [filter]
                    id=Deory
                [/filter]
                variable=deory
            [/store_unit]
        [/then]
        [/if]

        {CLEAR_VARIABLE malifor_keep}
        {CLEAR_VARIABLE friend_name}
        {CLEAR_VARIABLE entrence_x}
        {CLEAR_VARIABLE entrence_y}
        {CLEAR_VARIABLE chamber_entrence_x}
        {CLEAR_VARIABLE chamber_entrence_y}
        {CLEAR_VARIABLE gate_village_x}
        {CLEAR_VARIABLE gate_village_y}
        {CLEAR_VARIABLE gate_area_x}
        {CLEAR_VARIABLE gate_area_y}
        {CLEAR_VARIABLE visibility_range_x}
        {CLEAR_VARIABLE visibility_range_y}
        {CLEAR_VARIABLE gate_assault_range_x}
        {CLEAR_VARIABLE gate_assault_range_y}
        {CLEAR_VARIABLE deory_villages}
        {CLEAR_VARIABLE reinforcements}
        {CLEAR_VARIABLE knalgan_guards_charge}
        {CLEAR_VARIABLE tallin_insane_speak}
        {CLEAR_VARIABLE tallin_speak}
        {CLEAR_VARIABLE tallin_blood_speak}
        {CLEAR_VARIABLE tallin_friend_speak}
        {CLEAR_VARIABLE tallin_victims}
        {CLEAR_VARIABLE rhodry_speak}
        {CLEAR_VARIABLE mage_attack_male_x}
        {CLEAR_VARIABLE mage_attack_male_y}
        {CLEAR_VARIABLE mage_attack_female_x}
        {CLEAR_VARIABLE mage_attack_female_y}
        {CLEAR_VARIABLE cover_fighter_x}
        {CLEAR_VARIABLE cover_fighter_y}
        {CLEAR_VARIABLE cover_scout_x}
        {CLEAR_VARIABLE cover_scout_y}
        {CLEAR_VARIABLE gate_assault}

        {VICTORY_BONUS_DEFAULT yes}
    [/event]

    #undef DUST_ATTACK
    #undef PUT_GUARDIAN
    #undef PUT_KNALGAN_GUARD
    #undef CAMERIN_DEAD
    #undef KNALGAN_REINFORCEMENTS
    #undef KNALGAN_GUARDS_CHARGE
    #undef TALLIN_INSANE_SPEAK
    #undef TALLIN_FRIEND_SPEAK
    #undef RHODRY_SPEAK
[/scenario]
