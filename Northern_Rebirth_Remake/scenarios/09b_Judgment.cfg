#textdomain wesnoth-Northern_Rebirth_Remake

[scenario]
    id=09b_Judgment
    name= _ "Judgment"

    {SCENARIO_MUSIC "the_deep_path.ogg"}
    {EXTRA_SCENARIO_MUSIC "heroes_rite.ogg"}
    {EXTRA_SCENARIO_MUSIC "siege_of_laurelmor.ogg"}

    {DEEP_UNDERGROUND}
    next_scenario=10b_Eternal_Enemy
    # Turn number reduced by 8
    {TURNS4 26 24 22 20}
    victory_when_enemies_defeated=no
    map_data="{~add-ons/Northern_Rebirth_Remake/maps/09b_Judgment.map}"

    #define PUT_PRISON_GUARD X Y
        [unit]
            type=Shadow
            role=Prison Guard
            [modifications]
                [object]
                    silent=yes
                    [effect]
                        apply_to=attack
                        range=melee
                        set_type=arcane
                    [/effect]
                [/object]
            [/modifications]
            x={X}
            y={Y}
            side=6
        [/unit]
    #enddef

    #define PUT_FLAMING_DEATH X Y
        [unit]
            type=Deathblade
            role=Flaming Death
            [modifications]
                [object]
                    silent=yes
                    [effect]
                        apply_to=attack
                        range=melee
                        set_type=fire
                    [/effect]
                    [effect]
                        apply_to=movement_costs 
                        replace=false
                        [movement_costs]
                            cave=30
                            swamp_water=30
                            deep_water=30
                            shallow_water=30
                        [/movement_costs]
                    [/effect]
                [/object]
            [/modifications]
            x={X}
            y={Y}
            side=6
        [/unit]
    #enddef

    #define OBJECTIVES_UPDATE OBJECTIVE
        [objectives]
            side=1
            silent=yes
            [objective]
                condition=win
                description={OBJECTIVE}
            [/objective]
            [objective]
                description= _ "Death of Tallin"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}
            {GOLD_CARRYOVER_DEFAULT yes}
        [/objectives]
    #enddef

    #define PRISON_GUARDS_ALERT
        [if]
            [variable]
                name=prison_break
                less_than=1
            [/variable]
        [then]
            [store_unit]
                [filter]
                    role=Prison Guard
                [/filter]
                kill=yes
                variable=guarding_units
            [/store_unit]

            {FOREACH guarding_units i}

            {VARIABLE guarding_units[$i].side 5}

            [unstore_unit]
                variable=guarding_units[$i]
            [/unstore_unit]

            {NEXT i}

            {CLEAR_VARIABLE guarding_units}
            {VARIABLE prison_break 1}
        [/then]
        [/if]
    #enddef

    #define STORE_ASSAULTERS
        [store_unit]
            [filter]
                side=1
                x=8-22,9-21
                y=1-3,4-7
            [/filter]
            kill=no
            variable=assaulters
        [/store_unit]
    #enddef

    #define HAVE_ASSAULTERS
        [variable]
            name=assaulters[0].x
            greater_than=0
        [/variable]
    #enddef

    #define MOVE START_X START_Y END_X END_Y
        [if]
            [have_unit]
                side=5
                role=Flaming Death
                x={START_X}
                y={START_Y}
            [/have_unit]
        [then]
            [store_unit]
                [filter]
                    side=5
                    x={START_X}
                    y={START_Y}
                [/filter]
                variable=move_unit
                kill=yes
            [/store_unit]
            # Make sure that this unit can be moved
            [if]
                [variable]
                    name=move_unit.moves
                    greater_than=0
                [/variable]
            [then]
                [move_unit_fake]
                    type=$move_unit.type
                    side=$move_unit.side
                    x={START_X},{END_X}
                    y={START_Y},{END_Y}
                [/move_unit_fake]

                # Drain moves
                {VARIABLE move_unit.moves 0}
                {VARIABLE move_unit.x {END_X}}
                {VARIABLE move_unit.y {END_Y}}
            [/then]
            [/if]

            [unstore_unit]
                variable=move_unit
            [/unstore_unit]

            {CLEAR_VARIABLE move_unit}
        [/then]
        [/if]
    #enddef

    #define TAKE_KEY_POSITION THREAT
        [switch]
            variable=threat
            [case]
                value=1
                {MOVE 9 3 13 3}
                {MOVE 10 3 14 3}
                {MOVE 10 4 15 4}
            [/case]
            [case]
                value=2
                {MOVE 14 6 14 3}
                {MOVE 15 6 15 4}
                {MOVE 16 6 16 3}
            [/case]
            [case]
                value=3
                {MOVE 21 3 17 3}
                {MOVE 20 3 16 3}
                {MOVE 20 4 15 4}
            [/case]
            [case]
                value=4
                {MOVE 9 3 13 3}
                {MOVE 10 3 14 3}
                {MOVE 10 4 15 4}
                {MOVE 14 6 16 3}
                {MOVE 16 6 17 3}
            [/case]
            [case]
                value=5
                {MOVE 21 3 17 3}
                {MOVE 20 3 16 3}
                {MOVE 20 4 15 4}
                {MOVE 14 6 13 3}
                {MOVE 16 6 14 3}
            [/case]
            [case]
                value=6
                {MOVE 9 3 13 3}
                {MOVE 10 4 14 3}
                {MOVE 21 3 17 3}
                {MOVE 20 3 16 3}
                {MOVE 20 4 15 4}
            [/case]
            [case]
                value=7
                {MOVE 9 3 13 3}
                {MOVE 10 4 14 3}
                {MOVE 21 3 17 3}
                {MOVE 20 4 16 3}
                {MOVE 15 6 15 4}
            [/case]
        [/switch]

        {VARIABLE threat {THREAT}}
    #enddef

    #define TAKE_DEFENCE_POSITION THREAT
        {VARIABLE threat {THREAT}}

        [switch]
            variable=threat
            [case]
                value=1
                {MOVE 13 3 9 3}
                {MOVE 14 3 10 3}
                {MOVE 15 4 10 4}
            [/case]
            [case]
                value=2
                {MOVE 14 3 14 6}
                {MOVE 15 4 15 6}
                {MOVE 16 3 16 6}
            [/case]
            [case]
                value=3
                {MOVE 17 3 21 3}
                {MOVE 16 3 20 3}
                {MOVE 15 4 20 4}
            [/case]
            [case]
                value=4
                {MOVE 13 3 9 3}
                {MOVE 14 3 10 3}
                {MOVE 15 4 10 4}
                {MOVE 16 3 14 6}
                {MOVE 17 3 16 6}
            [/case]
            [case]
                value=5
                {MOVE 17 3 21 3}
                {MOVE 16 3 20 3}
                {MOVE 15 4 20 4}
                {MOVE 13 3 14 6}
                {MOVE 14 3 16 6}
            [/case]
            [case]
                value=6
                {MOVE 13 3 9 3}
                {MOVE 14 3 10 4}
                {MOVE 17 3 21 3}
                {MOVE 16 3 20 3}
                {MOVE 15 4 20 4}
            [/case]
            [case]
                value=7
                {MOVE 13 3 9 3}
                {MOVE 14 3 10 4}
                {MOVE 17 3 21 3}
                {MOVE 16 3 20 4}
                {MOVE 15 4 15 6}
            [/case]
        [/switch]
    #enddef

    #define HAVE_OPENED_PRISON_GATE GATE
        [variable]
            name={GATE}
            greater_than=2
        [/variable]
    #enddef

    #define HAVE_FOUND_PRISON_GATE GATE1 GATE2 GATE3
        [variable]
            name={GATE1}
            greater_than=0
        [/variable]
        [and]
            [variable]
                name={GATE2}
                greater_than=0
            [/variable]
            [or]
                [variable]
                    name={GATE3}
                    greater_than=0
                [/variable]
            [/or]
        [/and]
    #enddef

    #define GAIN_PRISON_GATE NAME GATE_X GATE_Y WING1 WING2 X Y
        [event]
            name=moveto
            first_time_only=no

            [filter]
                side=1
                x={X}
                y={Y}
            [/filter]

            [if]
                [variable]
                    name={NAME}
                    less_than=3
                [/variable]
            [then]
                {VARIABLE {WING1} 1}

                [if]
                    [variable]
                        name={WING1}
                        greater_than=0
                    [/variable]
                    [and]
                        [variable]
                            name={WING2}
                            greater_than=0
                        [/variable]
                    [/and]
                [then]
                    # Ready to open
                    {VARIABLE {NAME} 2}
                [/then]
                [else]
                    [if]
                        [variable]
                            name={WING1}
                            greater_than=0
                        [/variable]
                        [or]
                            [variable]
                                name={WING2}
                                greater_than=0
                            [/variable]
                        [/or]
                    [then]
                        # Found sealed
                        {VARIABLE {NAME} 1}
                    [/then]
                    [/if]
                [/else]
                [/if]

                [if]
                    [variable]
                        name=prison_objectives
                        less_than=2
                    [/variable]
                    [and]
                        {HAVE_FOUND_PRISON_GATE water_gate air_gate earth_gate}
                        [or]
                            {HAVE_FOUND_PRISON_GATE earth_gate water_gate air_gate}
                        [/or]
                        [or]
                            {HAVE_FOUND_PRISON_GATE air_gate earth_gate water_gate}
                        [/or]
                    [/and]
                [then]
                    {OBJECTIVES_UPDATE ( _ "Capture two villages to open a prison gate")}

                    {VARIABLE prison_objectives 2}
                [/then]
                [/if]

                [if]
                    [variable]
                        name={NAME}
                        numerical_equals=2
                    [/variable]
                [then]
                    # Message open door
                    [if]
                        [variable]
                            name=found_prison_gate
                            less_than=2
                        [/variable]
                    [then]
                        {FOUND_INFORMATION unit}

                        [if]
                            [variable]
                                name=$unit.id
                                equals=Tallin
                            [/variable]
                            [or]
                                [variable]
                                    name=$unit.race
                                    equals=human
                                [/variable]
                            [/or]
                            [or]
                                [variable]
                                    name=$unit.type
                                    equals=Lich
                                [/variable]
                            [/or]
                        [then]
                            {SPEAKER_GENERIC (speaker=unit) ( _ "We control one of the prison gates.")}
                        [/then]
                        [else]
                            {SPEAKER_TALLIN_ARMORED ( _ "We can open one of the prison gates.")}
                        [/else]
                        [/if]

                        [if]
                            [variable]
                                name=prison_guards_discovered
                                less_than=1
                            [/variable]
                        [then]
                            {SPEAKER_TALLIN_ARMORED ( _ "The necromancers talked about some Prison Guards. They didn't join our party yet but if we open the gate we will surely became worth dealing with.")}

                            {VARIABLE prison_guards_discovered 1}
                        [/then]
                        [/if]

                        {VARIABLE found_prison_gate 2}
                    [/then]
                    [/if]

                    {SCROLL_TO {GATE_X} {GATE_Y}}

                    {PLACE_IMAGE scenery/dwarven-doors-closed.png {GATE_X} {GATE_Y}}

                    [redraw][/redraw]

                    [delay]
                        time=1000
                    [/delay]

                    [message]
                        speaker=narrator
                        message= _ "These are prison gates that can be opened. After this action the unit will lose all remaining move points in this turn."
                        image=scenery/dwarven-doors-closed.png
                        [option]
                            message= _ "(<i>Open it</i>)"
                            [command]
                                [store_unit]
                                    [filter]
                                        id=$unit.id
                                    [/filter]
                                    kill=yes
                                    variable=assaulter
                                [/store_unit]

                                {VARIABLE assaulter.moves 0}

                                [unstore_unit]
                                    variable=assaulter
                                [/unstore_unit]

                                {CLEAR_VARIABLE assaulter}

                                [terrain]
                                    x={GATE_X}
                                    y={GATE_Y}
                                    terrain=Uu
                                [/terrain]

                                {PRISON_GUARDS_ALERT}

                                [if]
                                    [variable]
                                        name=prison_break
                                        less_than=2
                                    [/variable]
                                [then]
                                    [store_unit]
                                        [filter]
                                            id=Chieftain
                                        [/filter]
                                        kill=yes
                                        variable=chieftain_flame
                                    [/store_unit]

                                    {VARIABLE chieftain_flame.side 5}

                                    [unstore_unit]
                                        variable=chieftain_flame
                                    [/unstore_unit]

                                    {CLEAR_VARIABLE chieftain_flame}

                                    [store_unit]
                                        [filter]
                                            role=Flaming Death
                                        [/filter]
                                        kill=yes
                                        variable=flaming_units
                                    [/store_unit]

                                    {FOREACH flaming_units i}

                                    {VARIABLE flaming_units[$i].side 5}

                                    [unstore_unit]
                                        variable=flaming_units[$i]
                                    [/unstore_unit]

                                    {NEXT i}

                                    {CLEAR_VARIABLE flaming_units}

                                    {VARIABLE assemble_flames 1}
                                    {VARIABLE prison_break 2}
                                    {VARIABLE prison_guards_discovered 1}

                                    [capture_village]
                                        side=5
                                        x=15
                                        y=1
                                    [/capture_village]

                                    {SPEAKER_TALLIN_ARMORED ( _ "This way surely must lead to a place of great importance. We must act with haste.")}

                                    {OBJECTIVES_UPDATE ( _ "Explore the area behind the gates")}
                                    [modify_turns]
                                        add=8
                                    [/modify_turns]
                                [/then]
                                [/if]

                                {VARIABLE {NAME} 3}
                            [/command]
                        [/option]
                        [option]
                            message= _ "(<i>Leave it</i>)"
                        [/option]
                    [/message]
                [/then]
                [else]
                    [if]
                        {HAVE_FOUND_PRISON_GATE water_gate air_gate earth_gate}
                        [or]
                            {HAVE_FOUND_PRISON_GATE earth_gate water_gate air_gate}
                        [/or]
                        [or]
                            {HAVE_FOUND_PRISON_GATE air_gate earth_gate water_gate}
                        [/or]
                        [and]
                            [variable]
                                name=found_prison_gate
                                less_than=1
                            [/variable]
                        [/and]
                    [then]
                        # Message about founded doors
                        {FOUND_INFORMATION unit}

                        [if]
                            [variable]
                                name=$unit.id
                                equals=Tallin
                            [/variable]
                            [or]
                                [variable]
                                    name=$unit.race
                                    equals=human
                                [/variable]
                            [/or]
                            [or]
                                [variable]
                                    name=$unit.type
                                    equals=Lich
                                [/variable]
                            [/or]
                        [then]
                            {SPEAKER_GENERIC (speaker=unit) ( _ "We have found a way into the Prison.")}
                            {SPEAKER_TALLIN_ARMORED ( _ "It seems that we need to control the other village to open it.")}
                        [/then]
                        [else]
                            {SPEAKER_TALLIN_ARMORED ( _ "We have found a way into the Prison but it seems that we need to control the other village to open it.")}
                        [/else]
                        [/if]

                        {VARIABLE found_prison_gate 1}
                    [/then]
                    [/if]
                [/else]
                [/if]
            [/then]
            [else]
                [allow_undo][/allow_undo]
            [/else]
            [/if]
        [/event]
    #enddef

    #define LOSE_PRISON_GATE NAME WING X Y
        [event]
            name=moveto
            first_time_only=no

            [filter]
                side=2,3,4,5
                x={X}
                y={Y}
            [/filter]

            [if]
                [variable]
                    name={NAME}
                    less_than=3
                [/variable]
            [then]
                [if]
                    [variable]
                        name={NAME}
                        greater_than=0
                    [/variable]
                [then]
                    {VARIABLE_OP {NAME} sub 1}
                [/then]
                [/if]

                [if]
                    [variable]
                        name={WING}
                        greater_than=0
                    [/variable]
                [then]
                    {VARIABLE_OP {WING} sub 1}
                [/then]
                [/if]
            [/then]
            [/if]
        [/event]
    #enddef

    #define RECRUIT_CORPSE SIDE TYPE NAME
        [event]
            name=prerecruit
            first_time_only=no

            [filter]
                side={SIDE}
                type={TYPE}
            [/filter]

            [if]
                [variable]
                    name={NAME}
                    less_than=3
                [/variable]
            [then]
                [kill]
                    id=$unit.id
                [/kill]

                [unit]
                    side={SIDE}
                    type={TYPE}
                    variation=swimmer
                    moves=0
                    attacks_left=0
                    x,y=$unit.x,$unit.y
                [/unit]
            [/then]
            [else]
                [if]
                    [variable]
                        name={NAME}
                        numerical_equals=3
                    [/variable]
                [then]
                    [kill]
                        id=$unit.id
                    [/kill]

                    [unit]
                        side={SIDE}
                        type={TYPE}
                        variation=bat
                        moves=0
                        attacks_left=0
                        x,y=$unit.x,$unit.y
                    [/unit]
                [/then]
                [else]
                    {VARIABLE {NAME} 0}
                [/else]
                [/if]
            [/else]
            [/if]

            {VARIABLE_OP {NAME} add 1}
        [/event]
    #enddef

    #define NECROMANCER_DEATH SIDE SIDE1 SIDE2
        [event]
            name=last breath

            [filter]
                side={SIDE}
                canrecruit=yes
            [/filter]

            [if]
                [have_unit]
                    side={SIDE1}
                    canrecruit=yes
                [/have_unit]
                [or]
                    [have_unit]
                        side={SIDE2}
                        canrecruit=yes
                    [/have_unit]
                [/or]
            [then]
                {SPEAKER_GENERIC (speaker=unit) ( _ "Excellent Tallin! Your rage makes us stronger!")}
            [/then]
            [else]
                {SPEAKER_GENERIC (speaker=unit) ( _ "Excellent Tallin! Soon your outstanding combat skills will serve us!")}
            [/else]
            [/if]
        [/event]

        [event]
            name=die

            [filter]
                side={SIDE}
                canrecruit=yes
            [/filter]

            [if]
                [have_unit]
                    side={SIDE1}
                    canrecruit=yes
                [/have_unit]
                [and]
                    [have_unit]
                        side={SIDE2}
                        canrecruit=yes
                    [/have_unit]
                [/and]
            [then]
                [gold]
                    side={SIDE1}
                    {QUANTITY4 amount 50 65 70 95}
                [/gold]
                [gold]
                    side={SIDE2}
                    {QUANTITY4 amount 50 65 70 95}
                [/gold]
            [/then]
            [else]
                [if]
                    [have_unit]
                        side={SIDE1}
                        canrecruit=yes
                    [/have_unit]
                [then]
                    [gold]
                        side={SIDE1}
                        {QUANTITY4 amount 100 130 140 190}
                    [/gold]
                [/then]
                [/if]

                [if]
                    [have_unit]
                        side={SIDE2}
                        canrecruit=yes
                    [/have_unit]
                [then]
                    [gold]
                        side={SIDE2}
                        {QUANTITY4 amount 100 130 140 190}
                    [/gold]
                [/then]
                [/if]
            [/else]
            [/if]

            [if]
                [variable]
                    name=unit.gender
                    not_equals=male
                [/variable]
            [then]
                [message]
                    speaker=narrator
                    message= _ "Strange. The Body of a necromancer doesn't look like it would ever belong to her..."
                    image=misc/empty.png
                [/message]
            [/then]
            [else]
                [message]
                    speaker=narrator
                    message= _ "Strange. The Body of a necromancer doesn't look like it would ever belong to him..."
                    image=misc/empty.png
                [/message]
            [/else]
            [/if]

            [if]
                [variable]
                    name=necromancer_death
                    less_than=1
                [/variable]
            [then]
                [if]
                    [variable]
                        name=prison_objectives
                        greater_than=2
                    [/variable]
                [then]
                    {SPEAKER_TALLIN_ARMORED ( _ "It's some kind of trick. We should not waste our time fighting, and capture the Prison of Souls instead.")}
                [/then]
                [else]
                    [if]
                        [variable]
                            name=prison_objectives
                            greater_than=1
                        [/variable]
                    [then]
                        {SPEAKER_TALLIN_ARMORED ( _ "It's some kind of trick. We should not waste our time fighting with them, find the gate and use it.")}
                    [/then]
                    [else]
                        {SPEAKER_TALLIN_ARMORED ( _ "That is only some kind of trick. We are wasting time here. There must be a way to break into the Prison itself.")}

                        {OBJECTIVES_UPDATE ( _ "Find a way to break into the Prison of Souls")}

                        {VARIABLE prison_objecrives 1}
                    [/else]
                    [/if]
                [/else]
                [/if]

                {VARIABLE necromancer_death 1}
            [/then]
            [/if]
        [/event]
    #enddef

    #define AI_NECROMANCERS
        [ai]
            aggression=1.0
            caution=-5.0
            grouping="offensive"
            recruitment_ignore_bad_combat=yes
            [goal]
                name=protect_location
                [criteria]
                    x=5
                    y=13
                [/criteria]
                protect_radius=3
                value=10
            [/goal]
            [goal]
                name=protect_location
                [criteria]
                    x=15
                    y=11
                [/criteria]
                protect_radius=3
                value=10
            [/goal]
            [goal]
                name=protect_location
                [criteria]
                    x=26
                    y=12
                [/criteria]
                protect_radius=3
                value=10
            [/goal]
        [/ai]
    #enddef

    [side]
        {PROTAGONIST_FORCES}
        {GOLD4 250 220 200 180}
        user_team_name={S_UNDEAD}
        shroud=yes
        fog=yes
        {FLAG_VARIANT undead}
    [/side]

    [side]
        type=Necromancer
        id=Saeniver
        gender=female
        name= _ "Saeniver"
        canrecruit=yes
        side=2
        team_name=foe
        user_team_name= _ "Necromancers"
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_QUICK}
        [/modifications]
        {GOLD4 75 100 150 175}
        {FLAG_VARIANT undead}
        {AI_NECROMANCERS}
        recruit=Walking Corpse,Ghoul,Dark Adept
    [/side]

    [side]
        type=Necromancer
        id=Daveneth
        gender=male
        name= _ "Daveneth"
        canrecruit=yes
        side=3
        team_name=foe
        user_team_name= _ "Necromancers"
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_RESILIENT}
        [/modifications]
        {GOLD4 75 100 150 175}
        {FLAG_VARIANT undead}
        {AI_NECROMANCERS}
        recruit=Walking Corpse,Ghoul,Dark Adept
    [/side]

    [side]
        type=Necromancer
        id=Vaeddyn
        gender=male
        name= _ "Vaeddyn"
        canrecruit=yes
        side=4
        team_name=foe
        user_team_name= _ "Necromancers"
        [modifications]
            {TRAIT_LOYAL}
            {TRAIT_STRONG}
        [/modifications]
        {GOLD4 75 100 150 175}
        {FLAG_VARIANT undead}
        {AI_NECROMANCERS}
        recruit=Walking Corpse,Ghoul,Dark Adept
    [/side]

    [side]
        no_leader=yes
        side=5
        team_name=foe
        user_team_name= _ "Guards"
        gold=0
        {FLAG_VARIANT undead}
        [ai]
            aggression=1.0
            recruitment_pattern=fighter
        [/ai]
        recruit=Deathblade
    [/side]

    [side]
        controller=ai
        type=Death Knight
        id=Chieftain
        canrecruit=yes
        side=6
        team_name=foe
        user_team_name= " "
        hidden=yes
        gold=0
        [modifications]
            [object]
                silent=yes
                # Do not ever use replace if you want to have easy way to get back original state
                [effect]
                    apply_to=movement_costs 
                    replace=false
                    [movement_costs]
                        cave=30
                        swamp_water=30
                        deep_water=30
                        shallow_water=30
                    [/movement_costs]
                [/effect]
            [/object]
        [/modifications]
        [ai]
            ai_algorithm=idle_ai
        [/ai]
        color=black
    [/side]

    [event]
        name=prestart

        [objectives]
            side=1
            [objective]
                condition=win
                description=_ "Defeat the enemy leaders"
            [/objective]
            [objective]
                description= _ "Death of Tallin"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}
            {GOLD_CARRYOVER_DEFAULT yes}
        [/objectives]

        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 Ghoul 3}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 3 Ghoul 3}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 Ghoul 3}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 Deathblade 5}

        #ifdef EASY
            {LIMIT_RECRUITS 2 "Dark Adept" 3}
            {LIMIT_RECRUITS 3 "Dark Adept" 3}
            {LIMIT_RECRUITS 4 "Dark Adept" 3}
        #endif

        #ifdef NORMAL
            {LIMIT_RECRUITS 2 "Dark Adept" 4}
            {LIMIT_RECRUITS 3 "Dark Adept" 4}
            {LIMIT_RECRUITS 4 "Dark Adept" 4}
        #endif

        #ifdef HARD
            {LIMIT_RECRUITS 2 "Dark Adept" 6}
            {LIMIT_RECRUITS 3 "Dark Adept" 6}
            {LIMIT_RECRUITS 4 "Dark Adept" 6}
        #endif

        #ifdef NIGHTMARE
            {LIMIT_RECRUITS 2 "Dark Adept" 8}
            {LIMIT_RECRUITS 3 "Dark Adept" 8}
            {LIMIT_RECRUITS 4 "Dark Adept" 8}
        #endif
    [/event]

    [event]
        name=start

        {PLACE_IMAGE scenery/monolith1.png 4 14}
        {PLACE_IMAGE scenery/monolith1.png 17 12}
        {PLACE_IMAGE scenery/monolith3.png 7 13}
        {PLACE_IMAGE scenery/monolith3.png 24 12}
        {PLACE_IMAGE scenery/monolith2.png 13 12}
        {PLACE_IMAGE scenery/monolith2.png 27 14}
        {PLACE_IMAGE scenery/monolith4.png 14 1}
        {PLACE_IMAGE scenery/monolith4.png 16 1}

        {PUT_FLAMING_DEATH 13 3}
        {PUT_FLAMING_DEATH 14 3}
        {PUT_FLAMING_DEATH 15 4}
        {PUT_FLAMING_DEATH 16 3}
        {PUT_FLAMING_DEATH 17 3}

        {PUT_PRISON_GUARD 11 14}
        {PUT_PRISON_GUARD 19 14}
        {PUT_PRISON_GUARD 11 17}
        {PUT_PRISON_GUARD 19 17}
        {PUT_PRISON_GUARD 14 18}
        {PUT_PRISON_GUARD 16 18}

        [if]
            [variable]
                name=deory_dead
                not_equals=1
            [/variable]
        [then]
            {CLEAR_VARIABLE deory.canrecruit}
            {VARIABLE deory.side 2}
            {VARIABLE deory.x 14}
            {VARIABLE deory.y 15}
            {VARIABLE deory.hitpoints $deory.max_hitpoints}
            {VARIABLE deory.moves $deory.max_moves}
            {VARIABLE deory.attacks_left 1}
            
            [unstore_unit]
                variable=deory
            [/unstore_unit]

            {CLEAR_VARIABLE deory}
        [/then]
        [/if]

        [capture_village]
            side=2
            x=13,17
            y=11,11
        [/capture_village]
        [capture_village]
            side=3
            x=4,7
            y=13,12
        [/capture_village]
        [capture_village]
            side=4
            x=24,27
            y=11,13
        [/capture_village]

        {VARIABLE corpse_type1 0}
        {VARIABLE corpse_type2 0}
        {VARIABLE corpse_type3 0}

        {SPEAKER_GENERIC (speaker=Saeniver) ( _ "Tallin? It's really you, but you are alive. How it is possible?")}

        [if]
            [variable]
                name=deory_dead
                not_equals=1
            [/variable]
        [then]
            [if]
                [variable]
                    name=deory_village_taken
                    greater_than=0
                [/variable]
            [then]
                {SPEAKER_GENERIC (speaker=Deory) ( _ "Ta... Tallin? He's here? Mistress!!! This is all because of him! I couldn't! I just couldn't protect the master! White mages! Mages! He... He was taking my villages! And I...")}

                {CLEAR_VARIABLE deory_village_taken}
            [/then]
            [else]
                [if]
                    [variable]
                        name=assault_leader_killed
                        not_equals=
                    [/variable]
                [then]
                    {SPEAKER_GENERIC (speaker=Deory) ( _ "Ta... Tallin? He's here? Mistress!!! This is all because of him! I couldn't! I just couldn't protect the master! White mages! Mages! He... He just fled before them! He didn't kill them! And I...")}
                [/then]
                [else]
                    {SPEAKER_GENERIC (speaker=Deory) ( _ "Ta... Tallin? He's here? Mistress!!! This is all because of him! I couldn't! I just couldn't protect the master! White mages! Mages! He... He just did not want to win! He didn't kill them! And I...")}
                [/else]
                [/if]
            [/else]
            [/if]

            [sound]
                name=staff.wav
            [/sound]

            {SPEAKER_GENERIC (speaker=Deory) ( _ "Auu!")}
            {SPEAKER_GENERIC (speaker=Vaeddyn) ( _ "The Chaplain of darkness is truly grateful that you share your experience unspoken, adept.")}
        [/then]
        [/if]

        {SPEAKER_GENERIC (speaker=Saeniver) ( _ "They say a mother always will recognize her own children. That is if I had any children I would like them to be like you. Malifor asked me to create a powerful servant and here you are. You not only survived but it seems that you sustained your powers. Despite the fact that you are living. That is what a good ritual means. It is said that you can recognize a necromancer by his creations.")}
        {SPEAKER_GENERIC (speaker=Vaeddyn) ( _ "Chaplain, indeed Malifor the Great <i>*asked*</i> you and that because of your <i>*superior*</i> magic skills.")}
        # po: Warden of the deep, Warden like chief in staff not a guard.
        {SPEAKER_GENERIC (speaker=Daveneth) ( _ "Warden of the deep, we all know that it could be spontaneous. Tallin was just an adequate candidate to be the speaker of the dead. His will. The Strong belief that he has a mission. That he is righteous. That all who want to take that from him deserve severe punishment... Do not forget where we are. The Prison of Souls. Malifor built this.")}
        {SPEAKER_GENERIC (speaker=Saeniver) ( _ "Keeper of the shadows, with all respect your theories are so boring that they would crumble the paper they would be written on. So keep it to yourself. As for Malifor lets get some facts straight, he did not even use the potential of this place at all. Actually for a long time I can not recall anything of use that he was working on. Those vast armies of skeletons he kept without any need in the center of Knalga. Those prisoners captured and imprisoned and later forgotten until they died or escaped.")}
        {SPEAKER_GENERIC (speaker=Daveneth) ( _ "Saeniver, I remember you as an Adept. You respected the opinion of others and those who were greater than you. This place increased Malifor's power enormously. Since it allows for raising absolutely loyal, but more independent servants without the necessity of constantly renewing spells. Unfortunately it also broke his mind. It came to his attention that all undead that stay here for a longer time soon became not suitable for any task other than guarding this place. Of course they need some more preparation...")}
        {SPEAKER_GENERIC (speaker=Daveneth) ( _ "He realized to late that this affected him too. He stopped using it. But the damage was already done and it could not be reversed. That is why those who maintain the Prison can not be transformed.")}
        {SPEAKER_GENERIC (speaker=Saeniver) ( _ "Fine story. Malifor was great. So it is great that someone finally destroyed him before his insanity brought doom to us all. And that is the point Daveneth. You were the Keeper of shadows for a long time, that is true, but I am the Chaplain of darkness now. So do not be sentimental.")}
        {SPEAKER_GENERIC (speaker=Vaeddyn) ( _ "Simplicity is a key to success. That is what happens if someone tends to make things complicated. Isn't it Chaplain?")}
        {SPEAKER_GENERIC (speaker=Saeniver) ( _ "For you, Warden, it surely is since your best spell is dagger-in-sleeve. So maybe you'd better practice a bit before you forget in which sleeve you have it.")}
        {SPEAKER_GENERIC (speaker=Daveneth) ( _ "It's a Rod, Chaplain.")}
        {SPEAKER_GENERIC (speaker=Saeniver) ( _ "This famous Rod? So this brought you to life. Interesting. Then you also bring me a useful gift. I really couldn't dream of a finer son than you...")}
        {SPEAKER_TALLIN_ARMORED ( _ "They say that only those pure at heart can use this item. It seems that it is useless for you then.")}
        {SPEAKER_GENERIC (speaker=Saeniver) ( _ "Tallin. Do not be naive. Who's telling you these silly stories. Some powerful magic items just tend to choose their users. That's all. Anyway you will be using it. You see. Do you remember that bony arrow that killed you? This place will kill you just like that because of its nature. More over since the Prison holds such great power when we raise you again it will change the nature of that item, binding it to you. How do you like it?")}
        {SPEAKER_TALLIN_ARMORED ( _ "I'm eager to embrace you... Mother!")}
        {SPEAKER_GENERIC (speaker=Saeniver) ( _ "Oh Tallin that is what I am talking about! Never retreat, never surrender! Even outnumbered, overpowered! I feel like the air is freezing from the heat of your fury! Give us your hate! Your rage! Simply entertain us! We don't really have anything more interesting to do!")}
    [/event]

    [event]
        name=side 5 turn refresh
        first_time_only=no

        [if]
            [variable]
                name=prison_break
                less_than=3
            [/variable]
        [then]
            [if]
                {HAVE_OPENED_PRISON_GATE water_gate}
                [and]
                    [not]
                        {HAVE_OPENED_PRISON_GATE air_gate}
                    [/not]
                [/and]
                [and]
                    [not]
                        {HAVE_OPENED_PRISON_GATE earth_gate}
                    [/not]
                [/and]
            [then]
                {STORE_ASSAULTERS}

                [if]
                    [not]
                        {HAVE_ASSAULTERS}
                    [/not]
                [then]
                    {TAKE_DEFENCE_POSITION 1}
                [/then]
                [/if]
            [/then]
            [/if]

            [if]
                {HAVE_OPENED_PRISON_GATE air_gate}
                [and]
                    [not]
                        {HAVE_OPENED_PRISON_GATE water_gate}
                    [/not]
                [/and]
                [and]
                    [not]
                        {HAVE_OPENED_PRISON_GATE earth_gate}
                    [/not]
                [/and]
            [then]
                {STORE_ASSAULTERS}

                [if]
                    [not]
                        {HAVE_ASSAULTERS}
                    [/not]
                [then]
                    {TAKE_DEFENCE_POSITION 2}
                [/then]
                [/if]
            [/then]
            [/if]

            [if]
                {HAVE_OPENED_PRISON_GATE earth_gate}
                [and]
                    [not]
                        {HAVE_OPENED_PRISON_GATE water_gate}
                    [/not]
                [/and]
                [and]
                    [not]
                        {HAVE_OPENED_PRISON_GATE air_gate}
                    [/not]
                [/and]
            [then]
                {STORE_ASSAULTERS}

                [if]
                    [not]
                        {HAVE_ASSAULTERS}
                    [/not]
                [then]
                    {TAKE_DEFENCE_POSITION 3}
                [/then]
                [/if]
            [/then]
            [/if]

            [if]
                {HAVE_OPENED_PRISON_GATE water_gate}
                [and]
                    {HAVE_OPENED_PRISON_GATE air_gate}
                [/and]
                [and]
                    [not]
                        {HAVE_OPENED_PRISON_GATE earth_gate}
                    [/not]
                [/and]
            [then]
                {STORE_ASSAULTERS}

                [if]
                    [not]
                        {HAVE_ASSAULTERS}
                    [/not]
                [then]
                    [if]
                        [variable]
                            name=threat
                            not_equals=4
                        [/variable]
                    [then]
                        {TAKE_KEY_POSITION 4}
                    [/then]
                    [else]
                        {TAKE_DEFENCE_POSITION 4}
                    [/else]
                    [/if]
                [/then]
                [/if]
            [/then]
            [/if]

            [if]
                {HAVE_OPENED_PRISON_GATE air_gate}
                [and]
                    {HAVE_OPENED_PRISON_GATE earth_gate}
                [/and]
                [and]
                    [not]
                        {HAVE_OPENED_PRISON_GATE water_gate}
                    [/not]
                [/and]
            [then]
                {STORE_ASSAULTERS}

                [if]
                    [not]
                        {HAVE_ASSAULTERS}
                    [/not]
                [then]
                    [if]
                        [variable]
                            name=threat
                            not_equals=5
                        [/variable]
                    [then]
                        {TAKE_KEY_POSITION 5}
                    [/then]
                    [else]
                        {TAKE_DEFENCE_POSITION 5}
                    [/else]
                    [/if]
                [/then]
                [/if]
            [/then]
            [/if]

            [if]
                {HAVE_OPENED_PRISON_GATE water_gate}
                [and]
                    {HAVE_OPENED_PRISON_GATE earth_gate}
                [/and]
                [and]
                    [not]
                        {HAVE_OPENED_PRISON_GATE air_gate}
                    [/not]
                [/and]
            [then]
                {STORE_ASSAULTERS}

                [if]
                    [not]
                        {HAVE_ASSAULTERS}
                    [/not]
                [then]
                    [if]
                        [variable]
                            name=threat
                            not_equals=6
                        [/variable]
                    [then]
                        {TAKE_KEY_POSITION 6}
                    [/then]
                    [else]
                        {TAKE_DEFENCE_POSITION 6}
                    [/else]
                    [/if]
                [/then]
                [/if]
            [/then]
            [/if]

            [if]
                {HAVE_OPENED_PRISON_GATE water_gate}
                [and]
                    {HAVE_OPENED_PRISON_GATE air_gate}
                [/and]
                [and]
                    {HAVE_OPENED_PRISON_GATE earth_gate}
                [/and]
                [variable]
                    name=water_gate
                    greater_than=2
                [/variable]
                [and]
                    [variable]
                        name=air_gate
                        greater_than=2
                    [/variable]
                [/and]
                [and]
                    [variable]
                        name=earth_gate
                        greater_than=2
                    [/variable]
                [/and]
            [then]
                {STORE_ASSAULTERS}

                [if]
                    [not]
                        {HAVE_ASSAULTERS}
                    [/not]
                [then]
                    [if]
                        [variable]
                            name=threat
                            not_equals=7
                        [/variable]
                    [then]
                        {TAKE_KEY_POSITION 7}
                    [/then]
                    [else]
                        {TAKE_DEFENCE_POSITION 7}
                    [/else]
                    [/if]
                [/then]
                [/if]
            [/then]
            [/if]
        [/then]
        [/if]
    [/event]

    [event]
        name=new turn
        first_time_only=no

        [if]
            [variable]
                name=assemble_flames
                numerical_equals=1
            [/variable]
        [then]
            {CLEAR_VARIABLE assemble_flames}
        [/then]
        [/if]
    [/event]

    [event]
        name=prerecruit
        first_time_only=no

        [filter]
            side=5
        [/filter]

        [role]
            id=$unit.id
            role=Flaming Death
        [/role]

        [object]
            silent=yes
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=attack
                range=melee
                set_type=fire
            [/effect]
            [effect]
                apply_to=movement_costs 
                replace=false
                [movement_costs]
                    cave=30
                    swamp_water=30
                    deep_water=30
                [/movement_costs]
            [/effect]
         [/object]

         [if]
             [variable]
                 name=assemble_flames
                 numerical_equals=1
             [/variable]
         [then]
             {CLEAR_VARIABLE assemble_flames}
         [/then]
         [/if]
    [/event]

    {RECRUIT_CORPSE 2 "Walking Corpse" corpse_type1}
    {RECRUIT_CORPSE 3 "Walking Corpse" corpse_type2}
    {RECRUIT_CORPSE 4 "Walking Corpse" corpse_type3}

    # This is to not get lich with Necromancer role
    {UPDATE_ROLE_LICH}

    [event]
        name=attack

        [filter]
            side=1
        [/filter]
        [filter_second]
            side=6
        [/filter_second]

        {PRISON_GUARDS_ALERT}
    [/event]

    [event]
        name=attack

        [filter]
            side=1
        [/filter]
        [filter_second]
            side=5
            [not]
                type=Shadow,Nightgaunt
            [/not]
        [/filter_second]

        [if]
            [variable]
                name=prison_break
                less_than=3
            [/variable]
        [then]
            {VARIABLE prison_break 3}
        [/then]
        [/if]
    [/event]

    [event]
        name=attack

        [filter]
            side=5
            [not]
                type=Shadow,Nightgaunt
            [/not]
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [if]
            [variable]
                name=prison_break
                less_than=3
            [/variable]
        [then]
            {VARIABLE prison_break 3}
        [/then]
        [/if]
    [/event]

    {GAIN_PRISON_GATE water_gate 5 12 water_gate1 water_gate2 4 13}
    {GAIN_PRISON_GATE water_gate 5 12 water_gate2 water_gate1 17 11}
    {GAIN_PRISON_GATE air_gate 15 10 air_gate1 air_gate2 7 12}
    {GAIN_PRISON_GATE air_gate 15 10 air_gate2 air_gate1 24 11}
    {GAIN_PRISON_GATE earth_gate 26 11 earth_gate1 earth_gate2 13 11}
    {GAIN_PRISON_GATE earth_gate 26 11 earth_gate2 earth_gate1 27 13}

    {LOSE_PRISON_GATE water_gate water_gate1 4 13}
    {LOSE_PRISON_GATE water_gate water_gate2 17 11}
    {LOSE_PRISON_GATE air_gate air_gate1 7 12}
    {LOSE_PRISON_GATE air_gate air_gate2 24 11}
    {LOSE_PRISON_GATE earth_gate earth_gate1 13 11}
    {LOSE_PRISON_GATE earth_gate earth_gate2 27 13}

    [event]
        name=moveto
   
        [filter]
            side=1
      
            [filter_location]
                [filter]
                    side=6
                [/filter]
         
                radius=1
            [/filter_location]
       [/filter]

       [if]
           [variable]
               name=prison_guards_discovered
               less_than=1
           [/variable]
       [then]
           {FOUND_INFORMATION unit}

           {SPEAKER_TALLIN_ARMORED ( _ "So these are those famous guards. It does not seem that they do anything.")}

           [if]
               [have_unit]
                   side=1
                   race=human
                   [not]
                       id=Tallin
                   [/not]
               [/have_unit]
               [or]
                   [have_unit]
                       side=1
                       type=Lich
                   [/have_unit]
               [/or]
           [then]
               {SPEAKER_ART ( _ "They will not attack us, although they would like to, unless we threaten them or the Prison. Be aware my lord, they are the most dangerous to undead.")}
           [/then]
           [else]
               {SPEAKER_TALLIN_ARMORED ( _ "Might be we deserve their attention. I'm wondering, is there something special about them.")}
           [/else]
           [/if]

           {VARIABLE prison_guards_discovered 1}
       [/then]
       [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            side=1
            x=15
            y=1
        [/filter]

        [if]
            [have_unit]
                side=5
                canrecruit=yes
            [/have_unit]
        [then]
            [if]
                [variable]
                    name=prison_break
                    less_than=4
                [/variable]
            [then]
                {FOUND_INFORMATION unit}
                {SPEAKER_TALLIN_ARMORED ( _ "Yes we can't get there until the guards' chieftain is not destroyed.")}

                {VARIABLE prison_break 4}
            [/then]
            [/if]

            [if]
                [variable]
                    name=prison_captured
                    less_than=1
                [/variable]
            [then]
                {VARIABLE prison_captured 1}
            [/then]
            [/if]
        [/then]
        [else]
            [fire_event]
                name=judgment
            [/fire_event]
        [/else]
        [/if]
    [/event]

    [event]
        name=moveto
        first_time_only=no

        [filter]
            [not]
                side=1
            [/not]
            x=15
            y=1
        [/filter]

        [if]
            [variable]
                name=prison_captured
                greater_than=0
            [/variable]
        [then]
            {CLEAR_VARIABLE prison_captured}
        [/then]
        [/if]
    [/event]

    [event]
        name=moveto
   
        [filter]
            side=1
      
            [filter_location]
                [filter]
                    side=5
                    role=Flaming Death
                [/filter]
         
                radius=3
            [/filter_location]
      
            [or]
                side=5
                role=Flaming Death      

               [filter_location]
                   [filter]
                       side=1
                   [/filter]
            
                   radius=3
               [/filter_location]
            [/or]
        [/filter]

        {SPEAKER_GENERIC (id=Chieftain) ( _ "Finally... Replacement...")}
        {SPEAKER_TALLIN_ARMORED ( _ "Yeah. It's high time to put you out of duty.")}

        {OBJECTIVES_UPDATE ( _ "Destroy guards' leader")}
    [/event]

    [event]
        name=last breath

        [filter]
            id=Deory
        [/filter]

        [if]
            [have_unit]
                side=2
                canrecruit=yes
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Deory) ( _ "Mistress save me!")}
        [/then]
        [/if]
    [/event]

    [event]
        name=die

        [filter]
            id=Deory
        [/filter]
        [filter_second]
            [not]
                type=Walking Corpse,Soulless
            [/not]
        [/filter_second]

        [if]
            [have_unit]
                side=2
                canrecruit=yes
            [/have_unit]
        [then]
            {SPEAKER_GENERIC (speaker=Saeniver) ( _ "How could I afford wasting such a nice adept?")}

            [kill]
                id=$unit.id
            [/kill]
            [unit]
                side=2
                type=Ghoul
                x,y=$unit.x,$unit.y
            [/unit]
            [sound]
                name=zombie-hit-1.ogg
            [/sound]
        [/then]
        [/if]
    [/event]

    {NECROMANCER_DEATH 2 3 4}
    {NECROMANCER_DEATH 3 2 4}
    {NECROMANCER_DEATH 4 2 3}

    [event]
        name=die
        first_time_only=no

        [filter]
            side=5
            role=Flaming Death
        [/filter]

        [if]
            [variable]
                name=assemble_flames
                not_equals=1
            [/variable]
        [then]
            [modify_side]
                side=5
                gold=200
            [/modify_side]

            {VARIABLE assemble_flames 1}
        [/then]
        [/if]
    [/event]

    [event]
        name=die

        [filter]
            side=5
            canrecruit=yes
        [/filter]

        [if]
            [variable]
                name=prison_captured
                greater_than=0
            [/variable]
        [then]
            [fire_event]
                name=judgment
            [/fire_event]
        [/then]
        [else]
            {OBJECTIVES_UPDATE ( _ "Take control over the prison")}
        [/else]
        [/if]        
    [/event]

    # This is to end game immediately after leader death
    {IMPORTANT_CHARACTER_DIED Tallin}

    [event]
        name=judgment

        {QUAKE "rumble.ogg"}

        [if]
            [have_unit]
                side=2
                canrecruit=yes
            [/have_unit]
        [then]
            [kill]
                id=Saeniver
                fire_event=no
                animate=yes
            [/kill]
        [/then]
        [/if]

        [if]
            [have_unit]
                side=3
                canrecruit=yes
            [/have_unit]
        [then]
            [kill]
                id=Daveneth
                fire_event=no
                animate=yes
            [/kill]
        [/then]
        [/if]

        [if]
            [have_unit]
                side=4
                canrecruit=yes
            [/have_unit]
        [then]
            [kill]
                id=Vaeddyn
                fire_event=no
                animate=yes
            [/kill]
        [/then]
        [/if]

        {QUAKE "rumble.ogg"}

        {UNIT 1 "Necromancer" 15 2 (
            name= _ "Saeniver"
            id=Saeniver
            gender=female
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT 1 "Necromancer" 14 1 (
            name= _ "Daveneth"
            id=Daveneth
            gender=male
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
            {IS_LOYAL}
        )}
        {UNIT 1 "Necromancer" 16 1 (
            name= _ "Vaeddyn"
            id=Vaeddyn
            gender=male
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
            {IS_LOYAL}
        )}

        {SPEAKER_GENERIC (speaker=Vaeddyn) ( _ "You are truly powerful but are you aware of what damage you have done by leaving this place without any control. Do you know what could happen now...")}
        {SPEAKER_TALLIN_ARMORED ( _ "Gazes onto mages. Although it seemed to be impossible In the darkness of his helmet were two points so dark that it seemed that you'd turn blind by watching them.")}
        {SPEAKER_GENERIC (speaker=Saeniver) ( _ "(<i>Takes a bow</i>) Mighty lord Tallin you are victorious and prove to be our master. We offer you our help!")}
        {SPEAKER_TALLIN_ARMORED ( _ "For what would I need servants if I have enough of absolutely reliable soldiers?")}
        {SPEAKER_GENERIC (speaker=Daveneth) ( _ "Well you could use our wisdom and knowledge my lord.")}
        {SPEAKER_TALLIN_ARMORED ( _ "Wisdom? You are nothing but mere thieves, who just play with the lock but have no idea what is behind the doors.")}
        {SPEAKER_GENERIC (speaker=Vaeddyn) ( _ "We are powerful mages!... My lord...")}
        {SPEAKER_TALLIN_ARMORED ( _ "Power? I have more each time I bring justice. The more complicated, rare or hard my task is, the more I get. And for some reason I share this emotion. Every inch of this place screams to me. filling me with pain... Drown then in this morass. And you know what? I think this could almost make me feel joy.")}
        {SPEAKER_GENERIC (speaker=Saeniver) ( _ "Tallin... My lord... We will serve you as loyal as we served Malifor or even more... We trust you know the value of loyalty.")}
        [message]
            caption= _ "Speaker"
            speaker=Tallin
            [option]
                message= _ "Spare necromancers (<i>Gain three loyal necromancers</i>)"
                [command]
                    {SPEAKER_TALLIN_ARMORED ( _ "Lets move.")}
                    {SPEAKER_GENERIC (speaker=Saeniver) ( _ "Thank you my lord you are truly great...")}
                    {SPEAKER_TALLIN_ARMORED ( _ "Just shut up. Stand up and fight.")}
                    [message]
                        speaker=narrator
                        message= _ "You have gained three loyal necromancers."
                        image=wesnoth-icon.png
                    [/message]
                [/command]
            [/option]
            [option]
                message= _ "Kill necromancers (<i>Ghouls recruitment</i>)"
                [command]
                    {SPEAKER_TALLIN_ARMORED ( _ "Throw them into quag.")}
                    {SPEAKER_GENERIC (speaker=Saeniver) ( _ "No beast so fierce but knows some touch of pity.")}
                    {SPEAKER_TALLIN_ARMORED ( _ "But I know none, and therefore am no beast.")}
                    [kill]
                        id=Saeniver
                        fire_event=no
                        animate=no
                    [/kill]
                    [kill]
                        id=Daveneth
                        fire_event=no
                        animate=no
                    [/kill]
                    [kill]
                        id=Vaeddyn
                        fire_event=no
                        animate=no
                    [/kill]
                    [allow_recruit]
                        side=1
                        type=Ghoul
                    [/allow_recruit]
                    [message]
                        speaker=narrator
                        message= _ "Now you can recruit ghouls."
                        image=wesnoth-icon.png
                    [/message]
                [/command]
            [/option]
            image=portraits/humans/transparent/lieutenant.png
        [/message]

        # Clear level variables
        {CLEAR_VARIABLE corpse_type1}
        {CLEAR_VARIABLE corpse_type2}
        {CLEAR_VARIABLE corpse_type3}
        {CLEAR_VARIABLE water_gate}
        {CLEAR_VARIABLE water_gate1}
        {CLEAR_VARIABLE water_gate2}
        {CLEAR_VARIABLE air_gate}
        {CLEAR_VARIABLE air_gate1}
        {CLEAR_VARIABLE air_gate2}
        {CLEAR_VARIABLE earth_gate}
        {CLEAR_VARIABLE earth_gate1}
        {CLEAR_VARIABLE earth_gate2}
        {CLEAR_VARIABLE prison_break}
        {CLEAR_VARIABLE prison_objectives}
        {CLEAR_VARIABLE prison_captured}
        {CLEAR_VARIABLE necromancer_death}
        {CLEAR_VARIABLE found_prison_gate}
        {CLEAR_VARIABLE prison_guards_discovered}
        {CLEAR_VARIABLE threat}
        {CLEAR_VARIABLE assaulters}
        {CLEAR_ROLE_ART}

        {VICTORY_BONUS_DEFAULT yes}
    [/event]

    #undef PUT_PRISON_GUARD
    #undef PUT_FLAMING_DEATH
    #undef PRISON_GUARDS_ALERT
    #undef STORE_ASSAULTERS
    #undef HAVE_ASSAULTERS
    #undef HAVE_OPENED_PRISON_GATE
    #undef HAVE_FOUND_PRISON_GATE
    #undef GAIN_PRISON_GATE
    #undef LOSE_PRISON_GATE
    #undef RECRUIT_CORPSE
    #undef NECROMANCER_DEATH
    #undef OBJECTIVES_UPDATE
    #undef MOVE
    #undef AI_NECROMANCERS
[/scenario]
